<!-- templates/mypage/orderDetail.html -->
<style>
  .to-top {
    display: none !important;
  }

  :root {
    scrollbar-gutter: stable;
  }
</style>
<div th:fragment="items">

  <div style="text-align:left; font-weight:600; margin-bottom:4px">

    <!-- 주문날짜 / 주문번호 -->
    <div style="font-weight:600; margin-bottom:4px;">
      [[${#temporals.format(order.regDate,'yyyy.MM.dd HH:mm')}]]
      &nbsp;·&nbsp;
      주문번호 [[${order.orderId}]]
    </div>

    <hr style="margin:12px 0">
    <!-- 주문상품 정보 -->
    <h4 style="margin:0 0 8px">주문상품 정보</h4>

    <!-- 항목별 결과 -->
    <section class="mt-3">
      <div id="resItems" class="mt-2"></div>
      <div class="d-flex align-items-center py-2 border-bottom" th:each="d : ${order.details}">
        <img class="rounded me-3" th:src="${d.product.imgPath+d.product.imgName}" alt=""
          style="width:56px;height:56px;object-fit:cover">
        <div class="flex-grow-1">
		        <div class="fw-semibold name">
		            [[${d.product.name}]]
		
					<span th:if="${order.status == 'CONFIRMED'}">
					    <!-- 리뷰 작성 여부 -->
					    <span th:if="${d.reviewWritten == 'Y'}" class="badge bg-success ms-2">
					        리뷰작성완료
					    </span>
					
					    <!-- 미작성 시 리뷰 작성 버튼 -->
						<a th:if="${d.reviewWritten != 'Y' 
						           and order.status == 'CONFIRMED' 
						           and order.regDate.plusDays(7).isAfter(T(java.time.LocalDateTime).now())
                      }"
						   th:href="@{/main/etc/review/new(productId=${d.product.id}, orderDetailId=${d.orderDetailId})}"
						   class="btn btn-sm btn-outline-primary ms-2">
						   리뷰작성
						</a>
					</span>
		        </div>
          <div class="small text-muted">
            개당 <span class="unit">[[${#numbers.formatInteger(d.sellPrice, 3, 'COMMA')}]]</span>
            <span th:if="${order.status=='REQUESTED' and d.refundDetail != null}"
              th:text="'· 환불요청 '+${d.refundDetail.quantity}"></span>
            <span th:if="${order.status=='REFUNDED' and d.refundDetail != null}"
              th:text="'· 환불승인 '+${d.refundDetail.refundQty}"></span>
          </div>
        </div>
        <div class="text-end">
          <div class="fw-semibold subtotal">[[${d.quantity}]]개 [[${#numbers.formatInteger(d.totalPrice, 1, 'COMMA')}]]
          </div>
        </div>
      </div>

    </section>

    <hr style="margin:12px 0">

    <!-- 배송지 정보 -->
    <h4 style="margin:14px 0 8px">배송지</h4>

    <div th:if="${order.shippingSnapshot != null}">
      <div style="font-weight:600" th:text="${order.shippingSnapshot.addressName}">배송지명</div>
      <div>
        <span th:text="${order.shippingSnapshot.recipient}">받는분</span>
        &nbsp;/&nbsp;
        <span th:text="${order.shippingSnapshot.phone}">010...</span>
      </div>
      <div>
        (<span th:text="${order.shippingSnapshot.zonecode}">00000</span>)
        <span th:text="${order.shippingSnapshot.roadAddress}">도로명</span>
        <span th:text="${order.shippingSnapshot.detailAddress}">상세</span>
      </div>
      <div class="text-muted"
        th:if="${order.shippingSnapshot.memo != null and !#strings.isEmpty(order.shippingSnapshot.memo)}">
        요청사항: <span th:text="${order.shippingSnapshot.memo}"></span>
      </div>
    </div>

    <hr style="margin:12px 0">
    <!-- 결제내역이 있다면 -->
    <div th:if="${payments != null and !payments.isEmpty()}">
      <ul style="list-style:none; padding:0; margin:0; display:grid; gap:6px">
        <li th:each="p : ${payments}">
          결제번호 [[${p.paymentId}]]<br>
          결제 금액 : [[${#numbers.formatInteger(p.amount, 1, 'COMMA')}]]원
        </li>
      </ul>
    </div>
    