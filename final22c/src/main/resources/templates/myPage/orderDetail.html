<!-- templates/mypage/orderDetail.html -->
<div th:fragment="items">
  <div style="text-align:left; font-weight:600; margin-bottom:4px">

    <!-- 주문날짜 / 주문번호 -->
    <div style="font-weight:600; margin-bottom:4px;">
      [[${#temporals.format(order.regDate,'yyyy.MM.dd HH:mm')}]]
      &nbsp;·&nbsp;
      주문번호 [[${order.orderId}]]
    </div>

    <hr style="margin:12px 0">

    <!-- 주문상품 정보 -->
    <h4 style="margin:0 0 8px">주문상품 정보</h4>

    <ul style="list-style:none; padding:0; margin:0; display:grid; gap:8px">
      <li th:each="d : ${order.details}"
          style="display:flex; justify-content:space-between; align-items:center; gap:8px; border-bottom:1px solid #eee; padding:6px 0;">

        <!-- ✅ 상품명: 상품 있을 때만 상세로 링크 -->
        <span style="flex:1">
          <a th:if="${d.product != null}"
             th:href="@{|/main/content/${d.product.id}|}"
             th:text="${d.product.name}"
             style="text-decoration:underline"></a>
          <span th:if="${d.product == null}">상품</span>
        </span>

        <span>[[${d.quantity}]]개</span>

        <!-- 금액: 주문 시점 가격을 쓰려면 d.totalPrice 사용 권장 -->
        <span th:if="${d.product != null}">
          [[${#numbers.formatInteger(d.product.sellPrice * d.quantity, 0)}]]원
          <!-- 또는 더 정확히:
          [[${#numbers.formatInteger(d.totalPrice, 0)}]]원
          -->
        </span>
      </li>
    </ul>

    <hr style="margin:12px 0">

    <!-- 배송지 정보 -->
    <h4 style="margin:14px 0 8px">배송지</h4>
    <div th:if="${order.shippingSnapshot != null}">
      <div style="font-weight:600" th:text="${order.shippingSnapshot.addressName}">배송지명</div>
      <div>
        <span th:text="${order.shippingSnapshot.recipient}">받는분</span>
        &nbsp;/&nbsp;
        <span th:text="${order.shippingSnapshot.phone}">010...</span>
      </div>
      <div>
        (<span th:text="${order.shippingSnapshot.zonecode}">00000</span>)
        <span th:text="${order.shippingSnapshot.roadAddress}">도로명</span>
        <span th:text="${order.shippingSnapshot.detailAddress}">상세</span>
      </div>
      <div class="text-muted"
           th:if="${order.shippingSnapshot.memo != null and !#strings.isEmpty(order.shippingSnapshot.memo)}">
        요청사항: <span th:text="${order.shippingSnapshot.memo}"></span>
      </div>
    </div>

    <hr style="margin:12px 0">

    <!-- 결제내역 -->
    <div th:if="${payments != null and !payments.isEmpty()}">
      <ul style="list-style:none; padding:0; margin:0; display:grid; gap:6px">
        <li th:each="p : ${payments}" th:with="isPointOnly=${p.amount == 0 or p.tid == null}">
          결제번호 [[${p.paymentId}]]<br>
          <span th:if="${isPointOnly}">결제 수단 : 마일리지 전액 결제</span>
          <span th:unless="${isPointOnly}">결제 수단 : 카카오페이</span><br>
          총 결제 금액 : [[${#numbers.formatInteger(p.amount, 0)}]]원
        </li>
      </ul>
    </div>
  </div>
</div>
