<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layout/adminLayout}">

<th:block layout:fragment="css">
    <style>
        .page-title {
            font-size: 1.75rem;
            font-weight: 700;
        }

        .stat-controls {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
            padding: 6px 0;
        }

        /* 컨트롤 크기 업 */
        .stat-controls .form-control.form-control-sm,
        .stat-controls .form-select.form-select-sm {
            height: 38px;
            padding: 6px 10px;
            font-size: 0.95rem;
        }

        .stat-controls .btn.btn-sm {
            padding: .45rem .7rem;
            font-size: .95rem;
        }

        .cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 14px;
        }

        .cards .card .h2 {
            font-variant-numeric: tabular-nums;
            font-size: 1.6rem;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .table thead th,
        .table td {
            text-align: right
        }

        .table thead th:first-child,
        .table td:first-child {
            text-align: left
        }

        .stat-controls {
            justify-content: space-between;
        }

        /* 헤더 우측 컨트롤이 한 줄로 붙도록(폭 좁을 땐 자연스럽게 줄바꿈) */
        #headerCtrls {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        /* 헤더 내부의 select/btn 높이를 카드 헤더와 맞춤 */
        #headerCtrls .form-select.form-select-sm,
        #headerCtrls .btn.btn-sm {
            height: 34px;
        }

        /* 섹션 헤더 우측 컨트롤: 버튼 줄바꿈 방지 + 최소 너비 보장 */
        #headerCtrls .btn {
            white-space: nowrap;
            /* 글자 줄바꿈 금지 */
            word-break: keep-all;
            /* 한글 단어 쪼개짐 방지 */
            display: inline-flex;
            /* 세로 중앙정렬 */
            align-items: center;
        }

        /* '적용' 버튼 둘 다 동일하게 폭 보장(원하면 값 더 키워도 됨) */
        #btnProdApply,
        #btnBrandApply {
            min-width: 56px;
            /* '적용'이 절대 두 줄로 안 깨짐 */
        }

        /* 혹시 이전에 고정 height로 눌린 경우를 방지 */
        #headerCtrls .btn.btn-sm {
            height: auto;
            /* 높이는 자동 */
            line-height: 1.2;
            /* 가독성 */
            padding: .45rem .7rem;
            /* stat-controls와 톤 맞춤 */
        }
    </style>
</th:block>

<div layout:fragment="content" class="container py-3">
    <h2 class="mb-2">매출 통계</h2>
    <div class="stat-controls mb-3">
        <!-- 왼쪽: 기존 기간 컨트롤 그대로 -->
        <div class="d-flex align-items-center gap-2 flex-wrap">
            <div class="btn-group" role="group" id="unitTabs">
                <button class="btn btn-outline-secondary btn-sm active" data-unit="DAY">일간</button>
                <button class="btn btn-outline-secondary btn-sm" data-unit="WEEK">주간</button>
                <button class="btn btn-outline-secondary btn-sm" data-unit="MONTH">월간</button>
                <button class="btn btn-outline-secondary btn-sm" data-unit="YEAR">연간</button>
            </div>

            <div id="pickerArea" class="d-flex align-items-center gap-2">
                <input id="pick-day-date" type="date" class="form-control form-control-sm" style="width: 160px;">
                <input id="pick-week-month" type="month" class="form-control form-control-sm d-none"
                    style="width: 160px;">
                <select id="pick-month-year" class="form-select form-select-sm d-none" style="width: 120px;"></select>
            </div>

            <button id="btnSearch" class="btn btn-primary btn-sm">조회</button>
        </div>

        <!-- 오른쪽: 보기 라디오만 -->
        <div class="d-flex align-items-center gap-2 flex-wrap">
            <div class="btn-group" role="group" aria-label="보기">
                <input type="radio" class="btn-check" name="scope" id="scope-all" value="ALL" checked>
                <label class="btn btn-outline-dark btn-sm" for="scope-all">전체</label>

                <input type="radio" class="btn-check" name="scope" id="scope-brand" value="BRAND">
                <label class="btn btn-outline-dark btn-sm" for="scope-brand">브랜드</label>

                <input type="radio" class="btn-check" name="scope" id="scope-product" value="PRODUCT">
                <label class="btn btn-outline-dark btn-sm" for="scope-product">상품</label>
            </div>
        </div>
    </div>


    <!-- 합계 카드: 라벨만 교체 -->
    <div class="cards mb-3">
        <div class="card">
            <div class="card-body">
                <div>매출액</div>
                <div id="revSum" class="h2">0</div>
            </div>
        </div>
        <div class="card">
            <div class="card-body">
                <div>지출액</div>
                <div id="cogsSum" class="h2">0</div>
            </div>
        </div>
        <div class="card">
            <div class="card-body">
                <div>순이익</div>
                <div id="profitSum" class="h2">0</div>
            </div>
        </div>
    </div>

    <section class="card mb-3">
        <div class="card-header h5 mb-0 d-flex align-items-center justify-content-between">
            <span id="seriesTitle">전체 매출 추이 (매출액 / 지출액 / 순이익)</span>

            <!-- 섹션 헤더 우측 컨트롤 -->
            <div id="headerCtrls" class="d-flex align-items-center gap-2 flex-wrap">
                <!-- 상품 스코프일 때 -->
                <div id="scopeProductCtrls" class="d-flex align-items-center gap-2 d-none">
                    <select id="selProdBrand" class="form-select form-select-sm" style="min-width:140px">
                        <option value="">브랜드</option>
                    </select>
                    <select id="selProdCapacity" class="form-select form-select-sm" style="min-width:120px" disabled>
                        <option value="">용량</option>
                    </select>
                    <select id="selProd" class="form-select form-select-sm" style="min-width:220px" disabled>
                        <option value="">상품</option>
                    </select>
                    <button id="btnProdApply" class="btn btn-primary btn-sm" disabled>적용</button>
                </div>

                <!-- 브랜드 스코프일 때 -->
                <div id="scopeBrandCtrls" class="d-flex align-items-center gap-2 d-none">
                    <select id="selBrand" class="form-select form-select-sm" style="min-width:160px">
                        <option value="">브랜드</option>
                    </select>
                    <button id="btnBrandApply" class="btn btn-primary btn-sm" disabled>적용</button>
                </div>
            </div>
        </div>

        <div class="card-body">
            <canvas id="unifiedSeries" height="120"></canvas>
        </div>
    </section>
</div>

<th:block layout:fragment="script">
    <script>
        /* ========= 공통(상단) : 여기 블록은 기존과 동일 ========= */
        const BASE = '/admin/salesStats/api';       // 모든 통계 API의 공통 베이스 경로

        // 색상: 매출액=빨강, 지출액=파랑, 순이익=초록
        const SALES = '#dc2626';   // 매출액 (red-600)
        const EXP = '#2563eb';   // 지출액 (blue-600)
        const PROF = '#16a34a';   // 순이익 (green-600)

        Chart.defaults.locale = 'ko-KR';                // Chart.js의 숫자/날짜 로케일을 한국어로 설정
        const KR = new Intl.NumberFormat('ko-KR'),      // 숫자 포매터(3자리 콤마 등)
            KRW = n => `${KR.format(n ?? 0)}원`;        // 원 단위로 문자열 포맷팅하는 헬퍼

        const STATE = { unit: 'DAY', from: null, to: null, scope: 'ALL', _weekYm: null };            // 현재 선택된 단위/조회기간 상태(전역 공유)

        // 기간 선택기 DOM 참조(일/월/연)
        const $day = document.getElementById('pick-day-date');          // 일간용 date input
        const $wmon = document.getElementById('pick-week-month');       // 주간용 month input(달 선택)
        const $year = document.getElementById('pick-month-year');       // 월간용 year select(연 선택)

        // 유틸: Date -> 'yyyy-MM-dd' 문자열
        const d2s = d => d.toISOString().slice(0, 10);                  // ISO 문자열 앞부분만 잘라 'YYYY-MM-DD'로 반환

        // 유틸: 'yyyy-MM-dd' 기준 n일 더한 'yyyy-MM-dd' 반환
        const addDays = (s, n) => { const d = new Date(s); d.setDate(d.getDate() + n); return d2s(d); };

        const $btnSearch = document.getElementById('btnSearch');

        // 단위에 따라 보일 입력 컨트롤 전환
        function showPicker(u) {
            document.getElementById('pick-day-date').classList.toggle('d-none', u !== 'DAY');           // 일간만 date 표시
            document.getElementById('pick-week-month').classList.toggle('d-none', u !== 'WEEK');        // 주간만 month 표시
            document.getElementById('pick-month-year').classList.toggle('d-none', u !== 'MONTH');       // 월간만 year 표시

            $btnSearch.classList.toggle('d-none', u === 'YEAR');
        }

        // 초기화 즉시실행 함수(IIFE): 오늘 날짜 기반으로 피커 값/STATE 기본 세팅
        (function initPickers() {
            const today = new Date();           // 오늘
            $day.value = d2s(today);            // 일간 date input에 오늘 채움
            // 해당 월의 1일을 'YYYY-MM'으로 세팅(주간 조회는 특정 '월'을 고르게 함)
            $wmon.value = d2s(new Date(today.getFullYear(), today.getMonth(), 1)).slice(0, 7);

            // 월간용 연도 셀렉트 옵션 생성(현재연도-5 ~ 현재연도+1)
            const yNow = today.getFullYear(); $year.innerHTML = '';
            for (let y = yNow - 5; y <= yNow + 1; y++) {
                const o = document.createElement('option'); o.value = y; o.textContent = y; $year.appendChild(o);
            }
            $year.value = String(yNow);             // 기본값: 올해

            applyDayRange($day.value);              // 기본 STATE: 일간(선택일 -3 ~ +3일)
            showPicker(STATE.unit);
        })();

        // 단위별 기간 계산(STATE 업데이트)
        function applyDayRange(d) {                     // 일간: 선택일 기준 -3~+3일
            STATE.unit = 'DAY';
            STATE.from = addDays(d, -3);
            STATE.to = addDays(d, +3);
        }

        function applyWeekRange(ym) {                   // 주간: 특정 월의 1일 ~ 말일
            const [y, m] = ym.split('-').map(Number);
            STATE.unit = 'WEEK';
            STATE.from = d2s(new Date(y, m - 1, 1));    // 그 달 1일
            STATE.to = d2s(new Date(y, m, 0));          // 그 달 말일(다음달 0일)
            STATE._weekYm = ym;                         // 주차 라벨 계산에 사용할 월 보관
        }

        function applyMonthRange(y) {                   // 월간: 해당 연도 1/1 ~ 12/31
            STATE.unit = 'MONTH';
            STATE.from = `${y}-01-01`;
            STATE.to = `${y}-12-31`;
        }

        function applyYearRange() {                     // 연간: 최근 5년(과거→현재)
            const y = new Date().getFullYear();
            STATE.unit = 'YEAR';
            STATE.from = `${y - 4}-01-01`;
            STATE.to = `${y}-12-31`;
        }

        // 단위별 그래프 X축 라벨 기대값 생성(결측치를 0으로 채우기 위한 기준)
        function expectedLabels(unit) {
            if (unit === 'DAY') {                       // 일간: from..to 모든 날짜
                const out = [], d0 = new Date(STATE.from), d1 = new Date(STATE.to);
                for (let d = new Date(d0); d <= d1; d.setDate(d.getDate() + 1)) out.push(d2s(d));
                return out;
            }

            if (unit === 'WEEK') {                      // 주간: 1~5주 고정 라벨(월 단위 주버킷)
                return ['1주', '2주', '3주', '4주', '5주'];
            }

            if (unit === 'MONTH') {                     // 월간: 1~12월 라벨('YYYY-MM')
                return Array.from({ length: 12 }, (_, i) => `${STATE.from.slice(0, 4)}-${String(i + 1).padStart(2, '0')}`);
            }

            if (unit === 'YEAR') {                      // 연간: 최근 5년 (좌→우: 과거→현재)
                const yTo = +STATE.to.slice(0, 4);
                return Array.from({ length: 5 }, (_, i) => String(yTo - 4 + i));
            }

            return [];
        }

        // 'yyyy-MM-dd'가 해당 월의 몇 번째 주(0~4)에 속하는지 계산(주간 집계를 위해)
        function weekBucket(dateStr) {
            const [y, m, d] = dateStr.split('-').map(Number);
            const first = new Date(y, m - 1, 1);                                // 그 달 1일
            const cur = new Date(y, m - 1, d);                                  // 해당 날짜
            const diff = Math.floor((cur - first) / (1000 * 60 * 60 * 24));     // 1일 단위 차이
            return Math.min(4, Math.floor(diff / 7));                           // 0~4(=1~5주)
        }

        // 서버 rows를 기대 라벨에 맞춰 정규화(결측치는 0 채움, 주간은 5버킷 재집계)
        function normalizeSeries(rows) {
            const m = new Map();                            // dateKey -> {revenue,cogs,profit}
            rows.forEach(r => m.set(String(r.date), {
                revenue: +r.revenue || 0, cogs: +r.cogs || 0, profit: +r.profit || 0
            }));

            const labels = expectedLabels(STATE.unit);          // 단위별 기대 라벨

            if (STATE.unit === 'WEEK') {                        // 주간: 날짜키들을 5주 버킷으로 합산
                const buckets = Array.from({ length: 5 }, () => ({ revenue: 0, cogs: 0, profit: 0 }));
                for (const [k, v] of m) {
                    const idx = weekBucket(k);                  // 0~4 인덱스
                    buckets[idx].revenue += v.revenue;
                    buckets[idx].cogs += v.cogs;
                    buckets[idx].profit += v.profit;
                }
                return {
                    labels,
                    revenue: buckets.map(b => b.revenue),
                    cogs: buckets.map(b => b.cogs),
                    profit: buckets.map(b => b.profit)
                };
            }

            // 일/월/연: 라벨 순서대로 값 매핑(없으면 0)
            const revenue = [], cogs = [], profit = [];
            labels.forEach(l => {
                const v = m.get(l) || { revenue: 0, cogs: 0, profit: 0 };
                revenue.push(v.revenue); cogs.push(v.cogs); profit.push(v.profit);
            });

            return { labels, revenue, cogs, profit };
        }

        let unifiedChart;                         // 통합 차트 인스턴스
        const $title = document.getElementById('seriesTitle');
        const $canvas = document.getElementById('unifiedSeries');

        // 우측 라디오/선택 영역
        const scopeRadios = document.querySelectorAll('input[name="scope"]');
        const boxProd = document.getElementById('scopeProductCtrls');
        const boxBrand = document.getElementById('scopeBrandCtrls');
        const selProdBrand = document.getElementById('selProdBrand');
        const selProdCapacity = document.getElementById('selProdCapacity');
        const selProd = document.getElementById('selProd');
        const selBrand = document.getElementById('selBrand');

        // 브랜드 옵션 최초 1회 로드(두 셀렉트 공용)
        async function loadBrandOptionsOnce() {
            const list = await fetch(`${BASE}/brand/options`, { headers: { Accept: 'application/json' } }).then(r => r.json());
            const opts = '<option value="">브랜드</option>' + (list || []).map(b => `<option value="${b.brandNo}">${b.brandName}</option>`).join('');
            selProdBrand.innerHTML = opts;
            selBrand.innerHTML = opts;
        }
        loadBrandOptionsOnce();

        // 상품 선택 체인
        selProdBrand.addEventListener('change', async e => {
            selProdCapacity.disabled = true; selProdCapacity.innerHTML = '<option value="">용량</option>';
            selProd.disabled = true; selProd.innerHTML = '<option value="">상품</option>';
            const bno = e.target.value; if (!bno) return;
            const caps = await fetch(`${BASE}/product/capacities?brandNo=${bno}`, { headers: { Accept: 'application/json' } }).then(r => r.json());
            selProdCapacity.innerHTML = '<option value="">용량</option>' + (caps || []).map(c => `<option>${c}</option>`).join('');
            selProdCapacity.disabled = false;
        });
        selProdCapacity.addEventListener('change', async e => {
            selProd.disabled = true; selProd.innerHTML = '<option value="">상품</option>';
            const bno = selProdBrand.value, cap = e.target.value; if (!bno || !cap) return;
            const prods = await fetch(`${BASE}/product/byBrandCapacity?brandNo=${bno}&capacity=${encodeURIComponent(cap)}`, { headers: { Accept: 'application/json' } }).then(r => r.json());
            selProd.innerHTML = '<option value="">상품</option>' + (prods || []).map(p => `<option value="${p.id}">${p.name}</option>`).join('');
            selProd.disabled = false;
        });

        // 제목 스위치
        function setTitle() {
            if (STATE.scope === 'ALL') $title.textContent = '전체 매출 추이 (매출액 / 지출액 / 순이익)';
            if (STATE.scope === 'PRODUCT') $title.textContent = '상품 매출 추이 (선택 상품)';
            if (STATE.scope === 'BRAND') $title.textContent = '브랜드 매출 추이 (선택 브랜드)';
        }

        // 합계 카드
        function renderCards(s) {
            const sum = a => a.reduce((x, y) => x + (+y || 0), 0);
            revSum.textContent = KRW(sum(s.revenue));
            cogsSum.textContent = KRW(sum(s.cogs));
            profitSum.textContent = KRW(sum(s.profit));
        }

        // 통합 차트 렌더
        function renderUnified(datasets, labels) {
            if (unifiedChart) unifiedChart.destroy();
            unifiedChart = new Chart($canvas, {
                type: 'line',
                data: { labels, datasets },
                options: {
                    responsive: true,
                    interaction: { mode: 'index', intersect: false },
                    scales: { y: { beginAtZero: true, ticks: { callback: v => KR.format(v) } } },
                    plugins: { tooltip: { callbacks: { label: ctx => `${ctx.dataset.label}: ${KRW(ctx.parsed.y || 0)}` } } }
                }
            });
        }

        // scope=ALL 데이터 로드/렌더
        async function drawAll() {
            const rows = await fetch(`${BASE}/series?from=${STATE.from}&to=${STATE.to}&unit=${STATE.unit}`, { headers: { Accept: 'application/json' } }).then(r => r.json());
            const s = normalizeSeries(rows);
            renderCards(s);
            renderUnified([
                { label: '매출액', data: s.revenue, borderColor: SALES, backgroundColor: SALES, borderWidth: 2, pointRadius: 2, tension: 0, fill: false },
                { label: '지출액', data: s.cogs, borderColor: EXP, backgroundColor: EXP, borderWidth: 2, pointRadius: 2, tension: 0, fill: false },
                { label: '순이익', data: s.profit, borderColor: PROF, backgroundColor: PROF, borderWidth: 2, pointRadius: 2, tension: 0, fill: false }
            ], s.labels);
        }

        // scope=PRODUCT
        async function drawProduct() {
            const pid = selProd.value;
            // 선택 없으면 차트/카드만 비워준다(또는 안내 레이블)
            if (!pid) { renderUnified([], expectedLabels(STATE.unit)); renderCards({ revenue: [0], cogs: [0], profit: [0] }); return; }
            const u = new URL(`${location.origin}${BASE}/product/series`);
            u.searchParams.set('productId', pid);
            u.searchParams.set('from', STATE.from);
            u.searchParams.set('to', STATE.to);
            u.searchParams.set('unit', STATE.unit);
            const rows = await fetch(u, { headers: { Accept: 'application/json' } }).then(r => r.json());
            const s = normalizeSeries(rows);
            renderCards(s);
            renderUnified([
                { label: '매출액', data: s.revenue, borderColor: SALES, backgroundColor: SALES, borderWidth: 2, pointRadius: 2, tension: 0, fill: false },
                { label: '지출액', data: s.cogs, borderColor: EXP, backgroundColor: EXP, borderWidth: 2, pointRadius: 2, tension: 0, fill: false },
                { label: '순이익', data: s.profit, borderColor: PROF, backgroundColor: PROF, borderWidth: 2, pointRadius: 2, tension: 0, fill: false }
            ], s.labels);
        }

        // scope=BRAND
        async function drawBrand() {
            const bno = selBrand.value;
            if (!bno) { renderUnified([], expectedLabels(STATE.unit)); renderCards({ revenue: [0], cogs: [0], profit: [0] }); return; }
            const u = new URL(`${location.origin}${BASE}/brand/series`);
            u.searchParams.set('brandNo', bno);
            u.searchParams.set('from', STATE.from);
            u.searchParams.set('to', STATE.to);
            u.searchParams.set('unit', STATE.unit);
            const rows = await fetch(u, { headers: { Accept: 'application/json' } }).then(r => r.json());
            const s = normalizeSeries(rows);
            renderCards(s);
            renderUnified([
                { label: '매출액', data: s.revenue, borderColor: SALES, backgroundColor: SALES, borderWidth: 2, pointRadius: 2, tension: 0, fill: false },
                { label: '지출액', data: s.cogs, borderColor: EXP, backgroundColor: EXP, borderWidth: 2, pointRadius: 2, tension: 0, fill: false },
                { label: '순이익', data: s.profit, borderColor: PROF, backgroundColor: PROF, borderWidth: 2, pointRadius: 2, tension: 0, fill: false }
            ], s.labels);
        }

        // 라디오 전환 시 UI 토글 + 재로드
        scopeRadios.forEach(r => {
            r.addEventListener('change', async e => {
                STATE.scope = e.target.value;     // ALL | PRODUCT | BRAND
                setTitle();
                boxProd.classList.toggle('d-none', STATE.scope !== 'PRODUCT');
                boxBrand.classList.toggle('d-none', STATE.scope !== 'BRAND');
                await reloadUnified();
            });
        });

        // 통합 리로더(기간/단위 변경, 조회버튼, 라디오 변경 모두 이 함수 호출)
        async function reloadUnified() {
            if (STATE.scope === 'ALL') return drawAll();
            if (STATE.scope === 'PRODUCT') return drawProduct();
            if (STATE.scope === 'BRAND') return drawBrand();
        }

        // === 기존 unit 탭/피커/조회 버튼 이벤트는 그대로 두되, 마지막 호출을 reloadUnified로만 바꿔주면 된다 ===
        document.querySelectorAll('#unitTabs [data-unit]').forEach(btn => {
            btn.addEventListener('click', e => {
                document.querySelectorAll('#unitTabs [data-unit]').forEach(b => b.classList.remove('active'));
                e.currentTarget.classList.add('active');
                const u = e.currentTarget.dataset.unit; STATE.unit = u;
                showPicker(u);
                if (u === 'DAY') applyDayRange(document.getElementById('pick-day-date').value);
                if (u === 'WEEK') applyWeekRange(document.getElementById('pick-week-month').value);
                if (u === 'MONTH') applyMonthRange(document.getElementById('pick-month-year').value);
                if (u === 'YEAR') applyYearRange();
                reloadUnified();
            });
        });
        document.getElementById('pick-day-date').addEventListener('change', e => { if (STATE.unit === 'DAY') { applyDayRange(e.target.value); reloadUnified(); } });
        document.getElementById('pick-week-month').addEventListener('change', e => { if (STATE.unit === 'WEEK') { applyWeekRange(e.target.value); reloadUnified(); } });
        document.getElementById('pick-month-year').addEventListener('change', e => { if (STATE.unit === 'MONTH') { applyMonthRange(e.target.value); reloadUnified(); } });
        document.getElementById('btnSearch').addEventListener('click', reloadUnified);

        // ✅ 적용 버튼 참조
        const btnProdApply = document.getElementById('btnProdApply');
        const btnBrandApply = document.getElementById('btnBrandApply');

        // ✅ 선택값에 따라 버튼 활성화
        selProd.addEventListener('change', () => {
            btnProdApply.disabled = !selProd.value;
        });
        selBrand.addEventListener('change', () => {
            btnBrandApply.disabled = !selBrand.value;
        });

        // ✅ 적용 버튼 클릭 시에만 그래프 갱신
        btnProdApply.addEventListener('click', reloadUnified);
        btnBrandApply.addEventListener('click', reloadUnified);

        scopeRadios.forEach(r => {
            r.addEventListener('change', async e => {
                STATE.scope = e.target.value;
                setTitle();
                boxProd.classList.toggle('d-none', STATE.scope !== 'PRODUCT');
                boxBrand.classList.toggle('d-none', STATE.scope !== 'BRAND');
                await reloadUnified();
            });
        });

        // 초기 세팅
        (function init() {
            // 기존 초기화 코드(피커 today 세팅 등) 그대로 유지한다고 가정
            setTitle();
            reloadUnified();
        })();
    </script>

</th:block>

</html>