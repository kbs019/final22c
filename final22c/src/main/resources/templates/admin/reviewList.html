<html layout:decorate="~{/layout/adminLayout}">

<div layout:fragment="content">
	<h2>리뷰관리</h2>
	<div id="list" class="list-wrap mx-auto" style="max-width: 800px;" aria-live="polite" th:each="re : ${re}">
	    <article class="card mb-2 p-2">
	        <div class="row g-2 align-items-start">
	            <!-- 오른쪽: 텍스트 영역 -->
	            <div class="col">
					<div class="title mb-1 d-flex justify-content-between align-items-center">
					    <span>[[${re.product.name}]]</span>
					    <span class="meta">
					        [[${re.product.brand.brandName}]] 
					        <span class="rating">★ [[${re.rating}]]</span>
					        <span class="ms-2 date">[[${#temporals.format(re.createDate, 'yyyy-MM-dd HH:mm')}]]</span>
					    </span>
					</div>
					<hr>
				<div class="content mb-1 d-flex justify-content-between align-items-center">
				    <span>[[${re.content}]]</span>
				    <a class="btn btn-sm btn-primary ms-2"
				       th:href="@{/review/{id}/edit(id=${re.reviewId})}">
				        숨김
				    </a>
				</div>
	            </div>
	        </div>
	    </article>
	</div>
	
<nav aria-label="Page navigation">
  <ul class="pagination justify-content-center">

    <li class="page-item" th:classappend="${re.first} ? 'disabled'">
      <a class="page-link" th:href="@{/admin/reviewList(page=${re.number - 1})}">Previous</a>
    </li>

    <li class="page-item" th:each="i : ${#numbers.sequence(0, re.totalPages - 1)}"
        th:classappend="${i == re.number} ? 'active'">
      <a class="page-link" th:href="@{/admin/reviewList(page=${i})}" th:text="${i + 1}">1</a>
    </li>

    <li class="page-item" th:classappend="${re.last} ? 'disabled'">
      <a class="page-link" th:href="@{/admin/reviewList(page=${re.number + 1})}">Next</a>
    </li>

  </ul>
</nav>
<button id="filterBadBtn" class="btn btn-danger">비속어 필터</button>

<table class="table mt-3">
    <thead>
        <tr>
            <th>리뷰 ID</th>
            <th>작성자</th>
            <th>내용</th>
        </tr>
    </thead>
    <tbody id="badReviewList"></tbody>
</table>
</div>
<script layout:fragment="script" type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
    const btn = document.getElementById("filterBadBtn"); // btn 선언
    if (!btn) {
        console.error("버튼을 찾을 수 없습니다.");
        return;
    }

    btn.addEventListener("click", function() {
        console.log("버튼 클릭됨"); // 확인용
        fetch("/admin/review/filterBad")
            .then(res => {
                if (!res.ok) throw new Error("네트워크 오류");
                return res.json();
            })
            .then(data => {
                const tbody = document.getElementById("badReviewList");
                tbody.innerHTML = "";
                data.forEach(r => {
                    tbody.innerHTML += `
                        <tr>
                            <td>${r.reviewId}</td>
                            <td>${r.username}</td>
                            <td>${r.content}</td>
                        </tr>
                    `;
                });
            })
            .catch(err => console.error(err));
    });
});
</script>
</html>