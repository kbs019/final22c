<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>비밀번호 재설정</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5" style="max-width: 500px;">
  <h2 class="text-center mb-4">비밀번호 재설정</h2>
  <!-- 성공 메시지 -->
  <div th:if="${msg}" class="alert alert-success" role="alert">
    [[${msg}]]
  </div>
  <form method="post" action="/user/resetPw">
    <!-- ✅ userName은 hidden으로 전달 -->
    <input type="hidden" name="userName" th:value="${userName}"/>

    <div class="mb-3">
      <label for="newPassword" class="form-label">새 비밀번호</label>
      <input type="password" class="form-control" id="newPassword" name="newPassword" placeholder="새 비밀번호 입력" required>
    </div>
    <div class="mb-3">
      <label for="confirmPassword" class="form-label">비밀번호 확인</label>
      <input type="password" class="form-control" id="confirmPassword" placeholder="비밀번호 재입력" required>
    </div>
    <button type="submit" class="btn btn-success w-100">비밀번호 변경</button>
  </form>
</div>

<script>
  // 비밀번호 확인 체크
  document.querySelector("form").addEventListener("submit", function (e) {
    const pw = document.getElementById("newPassword").value;
    const pw2 = document.getElementById("confirmPassword").value;
    if (pw !== pw2) {
      e.preventDefault();
      alert("비밀번호가 일치하지 않습니다.");
    }
  });
  
  document.querySelector("form").addEventListener("submit", function(e) {
      e.preventDefault(); // 기본 submit 막기
      const formData = new FormData(this);

      fetch('/user/resetPw', {
          method: 'POST',
          body: formData
      }).then(res => {
          if(res.ok){
              alert("비밀번호가 성공적으로 변경되었습니다.");
              window.location.href = "user/login"; // 필요 시 로그인 페이지 이동
          }
      });
  });
</script>
</body>
</html>