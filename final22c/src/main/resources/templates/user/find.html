<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<div class="container mt-5" style="max-width: 500px;">
  <h2 class="text-center mb-4">아이디 / 비밀번호 찾기</h2>
  
  <!-- Nav 탭 -->
  <ul class="nav nav-tabs mb-3" id="findTab" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="id-tab" data-bs-toggle="tab" data-bs-target="#findId" type="button" role="tab">
        아이디 찾기
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="pw-tab" data-bs-toggle="tab" data-bs-target="#findPw" type="button" role="tab">
        비밀번호 찾기
      </button>
    </li>
  </ul>

  <!-- Tab 내용 -->
  <div class="tab-content">
    <!-- 아이디 찾기 -->
    <div class="tab-pane fade show active" id="findId" role="tabpanel">
      <form method="post" action="/user/findId">
        <div class="mb-3">
          <label for="findName" class="form-label">이름</label>
          <input type="text" class="form-control" id="findName" name="name" placeholder="이름 입력" required>
        </div>
        <div class="mb-3">
          <label for="findEmail" class="form-label">이메일</label>
          <input type="email" class="form-control" id="findEmail" name="email" placeholder="이메일 입력" required>
        </div>
        <button type="submit" class="btn btn-primary w-100">아이디 찾기</button>
      </form>
    </div>

	<!-- 비밀번호 찾기 -->
	<div class="tab-pane fade" id="findPw" role="tabpanel">
	  <!-- Step 1: 아이디 + 이메일 -->
	  <form id="findPwForm" method="post" action="/user/findPw" onsubmit="return sendAuthCode(event)">
	    <div class="mb-3">
	      <label for="findIdField" class="form-label">아이디</label>
	      <input type="text" class="form-control" id="findIdField" name="userName" placeholder="아이디 입력" required>
	    </div>
	    <div class="mb-3">
	      <label for="findPwEmail" class="form-label">이메일</label>
	      <input type="email" class="form-control" id="findPwEmail" name="email" placeholder="이메일 입력" required>
	    </div>
	    <button type="submit" class="btn btn-primary w-100">인증번호 받기</button>
	  </form>

	  <!-- Step 2: 인증번호 입력 (초기엔 숨김) -->
	  <form id="authCodeForm" method="post" action="/user/verifyAuthCode" class="mt-3 d-none" onsubmit="return verifyAuthCode(event)">
	    <div class="mb-3">
	      <label for="authCode" class="form-label">인증번호</label>
	      <input type="text" class="form-control" id="authCode" name="authCode" placeholder="6자리 숫자 입력" required>
	    </div>
	    <button type="submit" class="btn btn-success w-100">인증 확인</button>
	  </form>
	</div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
function sendAuthCode(e) {
  e.preventDefault();
  const form = document.getElementById("findPwForm");

  fetch(form.action, {
    method: "POST",
    body: new FormData(form)
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      alert("인증번호가 이메일로 발송되었습니다.");
      document.getElementById("authCodeForm").classList.remove("d-none");
    } else {
      alert("아이디와 이메일이 일치하지 않습니다.");
    }
  });
  return false;
}

function verifyAuthCode(e) {
  e.preventDefault();
  const form = document.getElementById("authCodeForm");

  fetch(form.action, {
    method: "POST",
    body: new FormData(form)
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      alert("인증이 완료되었습니다. 비밀번호 재설정 화면으로 이동합니다.");
      window.location.href = "/user/resetPwForm"; // ✅ 새 비밀번호 입력 페이지로 이동
    } else {
      alert("인증번호가 올바르지 않습니다.");
    }
  });
  return false;
}
</script>