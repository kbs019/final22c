<div th:fragment="buyFragment">
    <div class="my-3 py-3 border-bottom">
        <h3 th:text="${perfume.sellPrice}"></h3>
        <h5 th:text="${perfume.price}"></h5>
    </div>
    <div class="my-3 py-3 border-bottom">
        <div>
            <h3 th:text="${perfume.perfumeName}"></h3>
        </div>
        <div th:text="${perfume.brand}"></div>
    </div>
    <div class="my-3 py-3 border-bottom">
        <div>배송 정보</div>
        <div>
            <h5>배송비 3,000 원</h5>
        </div>
        <div>
            <h5>예상 배송일 1~3 일</h5>
        </div>
    </div>
    <div class="my-3 py-3 border-bottom">
        <div>구매 확정 시, 결제금액의 5% 적립</div>
        <form id="buy-form" method="post">
            <!-- 상품번호 히든으로 전달 -->
            <input type="hidden" name="perfumeNo" th:value="${perfume.perfumeNo}">

            <!-- CSRF (Spring Security 사용 시) -->
            <!-- <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"> -->
            
            <div class="d-flex align-items-center gap-2" id="buy-qty-wrap">
                <button type="button" class="btn btn-outline-secondary btn-sm btn-minus">-</button>
    
                <!-- 수량 입력: min=1, max=재고 -->
                <input type="number" class="form-control text-center qty-input" style="width:80px;"
                    name="quantity" th:attr="max=${perfume.count}" min="1" value="1">
    
                <button type="button" class="btn btn-outline-secondary btn-sm btn-plus">+</button>
    
                <div class="ms-3">
                    <div class="fw-semibold">합계: <span class="total-amount">0</span> 원</div>
                    <div class="text-muted small">적립 예정(5%): <span class="reward-amount">0</span> P</div>
                </div>
            </div>

            <div class="mt-3 d-flex gap-2">
                <!-- 장바구니 버튼 -->
                <button type="submit" class="btn btn-outline-secondary" formaction="/cart/add" formmethod="post" id="btn-add-cart">장바구니</button>

                <!-- 바로결제(주문 요약/결제 페이지로) -->
                <button type="submit" class="btn btn-secondary" formaction="/checkout/test" formmethod="post" id="btn-buy-now">바로 결제</button>
            </div>
        </form>
    </div>
</div>