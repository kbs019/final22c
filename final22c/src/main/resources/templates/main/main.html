<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">
<head>
  <title>22°C | Main</title>
  <th:block layout:fragment="css">
    <link rel="stylesheet" th:href="@{/css/main.css}">
  </th:block>
</head>
<body>
<th:block layout:fragment="content">
  <div class="page-wrap">

    <!-- 배너 -->
    <section class="mb-4 mb-md-5">
      <div class="main-banner ratio ratio-21x9 rounded-4 overflow-hidden shadow-sm">
        <img th:if="${bannerUrl}" th:src="${bannerUrl}" alt="메인 배너" class="w-100 h-100 object-fit-cover">
      </div>
    </section>

    <!-- Pick -->
    <section class="mb-5">
      <div class="d-flex align-items-end justify-content-between mb-2">
        <h2 class="section-title">Pick</h2>
        <div class="small text-muted">에디터 추천</div>
      </div>

      <!-- 바깥 화살표 + 캐러셀 : 화살표는 캐러셀 밖에 위치 -->
      <div class="pick-rail row align-items-center gx-2 gx-md-3">
        <!-- 왼쪽 바깥 화살표 (배경 없음, 아이콘만) -->
        <div class="col-auto d-none d-sm-flex">
          <button class="btn-arrow-minimal" type="button"
                  data-bs-target="#pickCarousel" data-bs-slide="prev" aria-label="이전">
            <span class="arrow left"></span>
          </button>
        </div>

        <!-- 캐러셀 본체 -->
        <div class="col">
          <div id="pickCarousel" class="carousel slide pick-carousel" data-bs-ride="false">
            <!-- 인디케이터 -->
            <div class="carousel-indicators">
              <button type="button" data-bs-target="#pickCarousel" data-bs-slide-to="0"
                      class="active" aria-current="true" aria-label="1"></button>
              <button type="button" data-bs-target="#pickCarousel" data-bs-slide-to="1"
                      aria-label="2" th:if="${#lists.size(pickSlides) > 1}"></button>
              <button type="button" data-bs-target="#pickCarousel" data-bs-slide-to="2"
                      aria-label="3" th:if="${#lists.size(pickSlides) > 2}"></button>
            </div>

            <div class="carousel-inner">
              <div class="carousel-item" th:classappend="${iter.index == 0} ? ' active'"
                   th:each="slide, iter : ${pickSlides}">
                <div class="row g-3 g-md-4 justify-content-center">
                  <!-- 한 슬라이드에 4장 -->
                  <div class="col-6 col-md-3 pick-narrow" th:each="p : ${slide}">
                    <!-- p는 제품 DTO이므로 바로 p.id 사용 -->
                    <a th:if="${p != null}"
                       th:href="@{|/main/content/${p.id}|}"
                       class="card product-card h-100 shadow-sm">
                      <!-- 납작 방지를 위해 4:5 비율 -->
                      <div class="ratio ratio-4x5 product-thumb rounded-3">
                        <img th:src="${p.imgPath + p.imgName}" th:alt="${p.name}">
                      </div>
                      <div class="card-body p-2 p-md-3">
                        <div class="product-name text-truncate" th:text="${p.name}">제품명</div>
                        <div class="product-price mt-1">
                          <span class="sell"
                                th:text="${#numbers.formatInteger(p.sellPrice, 3, 'COMMA')} + '원'">0원</span>
                          <small class="text-muted ms-1 text-decoration-line-through"
                                 th:if="${p.sellPrice < p.price}"
                                 th:text="${#numbers.formatInteger(p.price, 3, 'COMMA')} + '원'"></small>
                        </div>
                      </div>
                    </a>
                  </div>
                </div>
              </div><!-- /carousel-item -->
            </div>
          </div>
        </div>

        <!-- 오른쪽 바깥 화살표 (배경 없음, 아이콘만) -->
        <div class="col-auto d-none d-sm-flex">
          <button class="btn-arrow-minimal" type="button"
                  data-bs-target="#pickCarousel" data-bs-slide="next" aria-label="다음">
            <span class="arrow right"></span>
          </button>
        </div>
      </div>
    </section>

    <!-- ALL BEST -->
    <section class="mb-5">
      <h2 class="section-title mb-3">All Best</h2>
      <div class="row row-cols-2 row-cols-md-5 g-3 g-md-4">
        <div class="col" th:each="it : ${allBest}">
          <!-- it.product 가 있을 때만 링크/카드 렌더링 -->
          <a th:if="${it != null and it.product != null}"
             th:href="@{|/main/content/${it.product.id}|}"
             class="card product-card h-100 shadow-sm">
            <div class="rank-badge" th:text="${it.rank}">1</div>
            <div class="ratio ratio-1x1 product-thumb">
              <img th:src="${it.product.imgPath + it.product.imgName}"
                   th:alt="${it.product.name}"
                   class="w-100 h-100 object-fit-cover">
            </div>
            <div class="card-body p-2 p-md-3">
              <div class="product-name text-truncate" th:text="${it.product.name}">제품명</div>
              <div class="product-price mt-1">
                <span class="sell"
                      th:text="${#numbers.formatInteger(it.product.sellPrice, 3, 'COMMA')} + '원'">0원</span>
              </div>
            </div>
          </a>
        </div>
      </div>
    </section>

    <!-- WOMAN BEST -->
    <section class="mb-5">
      <h2 class="section-title mb-3">Woman Best</h2>
      <div class="row row-cols-2 row-cols-md-5 g-3 g-md-4">
        <div class="col" th:each="it : ${womanBest}">
          <a th:if="${it != null and it.product != null}"
             th:href="@{|/main/content/${it.product.id}|}"
             class="card product-card h-100 shadow-sm">
            <div class="rank-badge" th:text="${it.rank}">1</div>
            <div class="ratio ratio-1x1 product-thumb">
              <img th:src="${it.product.imgPath + it.product.imgName}"
                   th:alt="${it.product.name}"
                   class="w-100 h-100 object-fit-cover">
            </div>
            <div class="card-body p-2 p-md-3">
              <div class="product-name text-truncate" th:text="${it.product.name}">제품명</div>
              <div class="product-price mt-1">
                <span class="sell"
                      th:text="${#numbers.formatInteger(it.product.sellPrice, 3, 'COMMA')} + '원'">0원</span>
              </div>
            </div>
          </a>
        </div>
      </div>
    </section>

    <!-- MAN BEST -->
    <section class="mb-1">
      <h2 class="section-title mb-3">Man Best</h2>
      <div class="row row-cols-2 row-cols-md-5 g-3 g-md-4">
        <div class="col" th:each="it : ${manBest}">
          <a th:if="${it != null and it.product != null}"
             th:href="@{|/main/content/${it.product.id}|}"
             class="card product-card h-100 shadow-sm">
            <div class="rank-badge" th:text="${it.rank}">1</div>
            <div class="ratio ratio-1x1 product-thumb">
              <img th:src="${it.product.imgPath + it.product.imgName}"
                   th:alt="${it.product.name}"
                   class="w-100 h-100 object-fit-cover">
            </div>
            <div class="card-body p-2 p-md-3">
              <div class="product-name text-truncate" th:text="${it.product.name}">제품명</div>
              <div class="product-price mt-1">
                <span class="sell"
                      th:text="${#numbers.formatInteger(it.product.sellPrice, 3, 'COMMA')} + '원'">0원</span>
              </div>
            </div>
          </a>
        </div>
      </div>
    </section>

  </div>
</th:block>

<th:block layout:fragment="script">
  <script>
    // 캐러셀은 수동 탐색(자동 롤링 X)
    const pickCarousel = document.querySelector('#pickCarousel');
    if (pickCarousel) {
      const c = new bootstrap.Carousel(pickCarousel, { interval: false, ride: false, pause: true });
    }
  </script>
</th:block>
</body>
</html>
