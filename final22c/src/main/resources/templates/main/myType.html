<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>22Â°C - ë‚˜ë§Œì˜ í–¥ìˆ˜ ì°¾ê¸°</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --soft-pink: #fdf2f8;
            --soft-blue: #eff6ff;
            --soft-green: #f0fdf4;
            --gradient-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .survey-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header-section {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 20px;
            background: var(--gradient-bg);
            border-radius: 20px;
            color: white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .header-section h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header-section p {
            font-size: 1.1rem;
            opacity: 0.9;
            margin: 0;
        }

        .question-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            border: 1px solid rgba(0,0,0,0.04);
            display: none;
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.6s ease;
        }

        .question-card.active {
            display: block;
            transform: translateY(0);
            opacity: 1;
        }

        .question-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 20px;
            text-align: center;
        }

        .option-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 25px;
        }

        .option-card {
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .option-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s ease;
        }

        .option-card:hover::before {
            left: 100%;
        }

        .option-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            background: #ffffff;
        }

        .option-card.selected {
            border-color: var(--secondary-color);
            background: var(--soft-blue);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.2);
        }

        .option-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--secondary-color);
        }

        .option-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--primary-color);
        }

        .option-desc {
            font-size: 0.9rem;
            color: #6c757d;
            line-height: 1.4;
        }

        .progress-section {
            margin: 30px 0;
            text-align: center;
        }

        .progress-bar-custom {
            background: #e9ecef;
            height: 8px;
            border-radius: 50px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            background: var(--gradient-bg);
            height: 100%;
            border-radius: 50px;
            transition: width 0.8s ease;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .progress-text {
            font-size: 0.9rem;
            color: #6c757d;
            font-weight: 500;
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
        }

        .btn-custom {
            padding: 12px 30px;
            border-radius: 50px;
            font-weight: 600;
            border: none;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-prev {
            background: #6c757d;
            color: white;
        }

        .btn-prev:hover {
            background: #545b62;
            transform: translateX(-5px);
        }

        .btn-next {
            background: var(--gradient-bg);
            color: white;
        }

        .btn-next:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-next:disabled {
            background: #dee2e6 !important;
            color: #6c757d !important;
            cursor: not-allowed !important;
            transform: none !important;
            opacity: 0.6 !important;
        }

        .result-section {
            display: none;
            text-align: center;
            padding: 40px 20px;
        }

        .result-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .result-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        .recommended-perfumes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .perfume-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            border: 1px solid #f1f3f4;
        }

        .perfume-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .perfume-image {
            width: 80px;
            height: 80px;
            background: var(--soft-pink);
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }

        .perfume-name {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--primary-color);
        }

        .perfume-brand {
            color: #6c757d;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .perfume-notes {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 10px;
            font-size: 0.8rem;
            color: #495057;
        }

        .fade-in {
            animation: fadeInUp 0.6s ease forwards;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .loading-spinner {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(255, 255, 255, 0.95);
            justify-content: center;
            align-items: center;
            z-index: 9999;
            flex-direction: column;
        }

        .loading-spinner div {
            text-align: center;
        }

        .loading-spinner .spinner {
            margin: 0 auto 20px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--secondary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .option-grid {
                grid-template-columns: 1fr;
            }
            
            .header-section h1 {
                font-size: 2rem;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="survey-container">
        <!-- í—¤ë” ì„¹ì…˜ -->
        <div class="header-section fade-in">
            <h1><i class="fas fa-magic"></i> ë‚˜ë§Œì˜ í–¥ìˆ˜ ì°¾ê¸°</h1>
            <p>ëª‡ ê°€ì§€ ì§ˆë¬¸ìœ¼ë¡œ ë‹¹ì‹ ì—ê²Œ ì™„ë²½í•œ í–¥ìˆ˜ë¥¼ ì°¾ì•„ë“œë ¤ìš”</p>
        </div>

        <!-- ì§„í–‰ë¥  í‘œì‹œ -->
        <div class="progress-section">
            <div class="progress-text">
                <span id="current-step">1</span> / <span id="total-steps">7</span>
            </div>
            <div class="progress-bar-custom">
                <div class="progress-fill" id="progress-fill" style="width: 14.3%"></div>
            </div>
        </div>

        <!-- ì§ˆë¬¸ ì„¹ì…˜ë“¤ -->
        <div id="questions-container">
            <!-- ì§ˆë¬¸ 1: ì„±ë³„ -->
            <div class="question-card active" data-question="1">
                <h3 class="question-title">ì„±ë³„ì„ ì„ íƒí•´ì£¼ì„¸ìš”</h3>
                <div class="option-grid" data-type="demographics">
                    <div class="option-card" data-value="female">
                        <div class="option-icon"><i class="fas fa-venus"></i></div>
                        <div class="option-title">ì—¬ì„±</div>
                        <div class="option-desc">ìš°ì•„í•˜ê³  ì„¸ë ¨ëœ</div>
                    </div>
                    <div class="option-card" data-value="male">
                        <div class="option-icon"><i class="fas fa-mars"></i></div>
                        <div class="option-title">ë‚¨ì„±</div>
                        <div class="option-desc">ì¹´ë¦¬ìŠ¤ë§ˆ ìˆëŠ”</div>
                    </div>
                </div>
            </div>

            <!-- ì§ˆë¬¸ 2: ì„ í˜¸í•˜ëŠ” ë¶„ìœ„ê¸° -->
            <div class="question-card" data-question="2">
                <h3 class="question-title">ì–´ë–¤ ë¶„ìœ„ê¸°ë¥¼ ì¢‹ì•„í•˜ì‹œë‚˜ìš”?</h3>
                <div class="option-grid" data-type="mood">
                    <div class="option-card" data-value="romantic">
                        <div class="option-icon"><i class="fas fa-heart"></i></div>
                        <div class="option-title">ë¡œë§¨í‹±</div>
                        <div class="option-desc">ë‹¬ì½¤í•˜ê³  ê°ì„±ì ì¸</div>
                    </div>
                    <div class="option-card" data-value="professional">
                        <div class="option-icon"><i class="fas fa-briefcase"></i></div>
                        <div class="option-title">í”„ë¡œí˜ì…”ë„</div>
                        <div class="option-desc">ê¹”ë”í•˜ê³  ì‹ ë¢°ê° ìˆëŠ”</div>
                    </div>
                    <div class="option-card" data-value="casual">
                        <div class="option-icon"><i class="fas fa-leaf"></i></div>
                        <div class="option-title">ìºì£¼ì–¼</div>
                        <div class="option-desc">í¸ì•ˆí•˜ê³  ìì—°ìŠ¤ëŸ¬ìš´</div>
                    </div>
                    <div class="option-card" data-value="luxurious">
                        <div class="option-icon"><i class="fas fa-crown"></i></div>
                        <div class="option-title">ëŸ­ì…”ë¦¬</div>
                        <div class="option-desc">ê³ ê¸‰ìŠ¤ëŸ½ê³  ë…íŠ¹í•œ</div>
                    </div>
                </div>
            </div>

            <!-- ì§ˆë¬¸ 3: ì„ í˜¸í•˜ëŠ” ê³„ì ˆê° -->
            <div class="question-card" data-question="3">
                <h3 class="question-title">ì–´ë–¤ ê³„ì ˆê°ì„ ì„ í˜¸í•˜ì‹œë‚˜ìš”?</h3>
                <div class="option-grid" data-type="season">
                    <div class="option-card" data-value="spring">
                        <div class="option-icon" style="color: #10b981;"><i class="fas fa-seedling"></i></div>
                        <div class="option-title">ë´„</div>
                        <div class="option-desc">ìƒí¼í•˜ê³  ìƒê¸° ë„˜ì¹˜ëŠ”</div>
                    </div>
                    <div class="option-card" data-value="summer">
                        <div class="option-icon" style="color: #f59e0b;"><i class="fas fa-sun"></i></div>
                        <div class="option-title">ì—¬ë¦„</div>
                        <div class="option-desc">ì‹œì›í•˜ê³  ìƒì¾Œí•œ</div>
                    </div>
                    <div class="option-card" data-value="autumn">
                        <div class="option-icon" style="color: #d97706;"><i class="fas fa-leaf"></i></div>
                        <div class="option-title">ê°€ì„</div>
                        <div class="option-desc">ë”°ëœ»í•˜ê³  ê¹Šì´ ìˆëŠ”</div>
                    </div>
                    <div class="option-card" data-value="winter">
                        <div class="option-icon" style="color: #3b82f6;"><i class="fas fa-snowflake"></i></div>
                        <div class="option-title">ê²¨ìš¸</div>
                        <div class="option-desc">ì‹ ë¹„ë¡­ê³  ê°•ë ¬í•œ</div>
                    </div>
                </div>
            </div>

            <!-- ì§ˆë¬¸ 4: í–¥ì˜ ê°•ë„ -->
            <div class="question-card" data-question="4">
                <h3 class="question-title">í–¥ì˜ ê°•ë„ëŠ” ì–´ëŠ ì •ë„ë¥¼ ì„ í˜¸í•˜ì‹œë‚˜ìš”?</h3>
                <div class="option-grid" data-type="intensity">
                    <div class="option-card" data-value="light">
                        <div class="option-icon"><i class="fas fa-feather"></i></div>
                        <div class="option-title">ë¼ì´íŠ¸</div>
                        <div class="option-desc">ì€ì€í•˜ê³  ë¶€ë“œëŸ¬ìš´<br><small class="text-muted">(ì˜¤ë“œì½”ë¡±, ì˜¤ë“œëœ¨ì™ˆë ›)</small></div>
                    </div>
                    <div class="option-card" data-value="medium">
                        <div class="option-icon"><i class="fas fa-balance-scale"></i></div>
                        <div class="option-title">ë¯¸ë””ì›€</div>
                        <div class="option-desc">ì ë‹¹íˆ ëŠê»´ì§€ëŠ”<br><small class="text-muted">(ì˜¤ë“œëœ¨ì™ˆë ›, ì˜¤ë“œí¼í“¸)</small></div>
                    </div>
                    <div class="option-card" data-value="strong">
                        <div class="option-icon"><i class="fas fa-fire"></i></div>
                        <div class="option-title">ìŠ¤íŠ¸ë¡±</div>
                        <div class="option-desc">ì§„í•˜ê³  ì˜¤ë˜ê°€ëŠ”<br><small class="text-muted">(ì˜¤ë“œí¼í“¸, í¼í“¸)</small></div>
                    </div>
                </div>
            </div>

            <!-- ì§ˆë¬¸ 5: ì„ í˜¸í•˜ëŠ” ë…¸íŠ¸ ê³„ì—´ (8ê°œ ë©”ì¸ë…¸íŠ¸) -->
            <div class="question-card" data-question="5">
                <h3 class="question-title">ì–´ë–¤ í–¥ ê³„ì—´ì„ ê°€ì¥ ì¢‹ì•„í•˜ì‹œë‚˜ìš”?</h3>
                <div class="option-grid" data-type="notes">
                    <div class="option-card" data-value="floral">
                        <div class="option-icon" style="color: #ec4899;"><i class="fas fa-seedling"></i></div>
                        <div class="option-title">í”Œë¡œë„</div>
                        <div class="option-desc">ì¥ë¯¸, ììŠ¤ë¯¼, í”¼ì˜¤ë‹ˆ</div>
                    </div>
                    <div class="option-card" data-value="citrus">
                        <div class="option-icon" style="color: #f59e0b;"><i class="fas fa-lemon"></i></div>
                        <div class="option-title">ì‹œíŠ¸ëŸ¬ìŠ¤</div>
                        <div class="option-desc">ë ˆëª¬, ì˜¤ë Œì§€, ìëª½</div>
                    </div>
                    <div class="option-card" data-value="woody">
                        <div class="option-icon" style="color: #92400e;"><i class="fas fa-tree"></i></div>
                        <div class="option-title">ìš°ë””</div>
                        <div class="option-desc">ìƒŒë‹¬ìš°ë“œ, ì‹œë”, ë‚˜ë¬´í–¥</div>
                    </div>
                    <div class="option-card" data-value="spicy">
                        <div class="option-icon" style="color: #dc2626;"><i class="fas fa-pepper-hot"></i></div>
                        <div class="option-title">ìŠ¤íŒŒì´ì‹œ</div>
                        <div class="option-desc">í›„ì¶”, ê³„í”¼, ìƒê°•</div>
                    </div>
                    <div class="option-card" data-value="vanilla">
                        <div class="option-icon" style="color: #fbbf24;"><i class="fas fa-birthday-cake"></i></div>
                        <div class="option-title">ë°”ë‹ë¼</div>
                        <div class="option-desc">ë‹¬ì½¤í•˜ê³  í¬ê·¼í•œ</div>
                    </div>
                    <div class="option-card" data-value="fruity">
                        <div class="option-icon" style="color: #f472b6;"><i class="fas fa-apple-alt"></i></div>
                        <div class="option-title">í‘¸ë£¨í‹°</div>
                        <div class="option-desc">ê³¼ì¼ì˜ ë‹¬ì½¤í•¨</div>
                    </div>
                    <div class="option-card" data-value="herbal">
                        <div class="option-icon" style="color: #10b981;"><i class="fas fa-leaf"></i></div>
                        <div class="option-title">í—ˆë²Œ</div>
                        <div class="option-desc">í—ˆë¸Œ, ë¯¼íŠ¸, ê·¸ë¦°ë…¸íŠ¸</div>
                    </div>
                    <div class="option-card" data-value="gourmand">
                        <div class="option-icon" style="color: #8b5cf6;"><i class="fas fa-cookie-bite"></i></div>
                        <div class="option-title">êµ¬ë¥´ë§</div>
                        <div class="option-desc">ì´ˆì½œë¦¿, ì»¤í”¼, ìºëŸ¬ë©œ</div>
                    </div>
                </div>
            </div>

            <!-- ì§ˆë¬¸ 6: ê°œì„± í‘œí˜„ -->
            <div class="question-card" data-question="6">
                <h3 class="question-title">í–¥ìˆ˜ë¡œ ì–´ë–¤ ê°œì„±ì„ í‘œí˜„í•˜ê³  ì‹¶ë‚˜ìš”?</h3>
                <div class="option-grid" data-type="personality">
                    <div class="option-card" data-value="gentle">
                        <div class="option-icon" style="color: #ec4899;"><i class="fas fa-dove"></i></div>
                        <div class="option-title">ë¶€ë“œëŸ¬ìš´</div>
                        <div class="option-desc">ë”°ëœ»í•˜ê³  í¬ê·¼í•œ ëŠë‚Œ</div>
                    </div>
                    <div class="option-card" data-value="confident">
                        <div class="option-icon" style="color: #dc2626;"><i class="fas fa-crown"></i></div>
                        <div class="option-title">ìì‹ ê° ë„˜ì¹˜ëŠ”</div>
                        <div class="option-desc">ê°•ë ¬í•˜ê³  ë§¤ë ¥ì ì¸</div>
                    </div>
                    <div class="option-card" data-value="mysterious">
                        <div class="option-icon" style="color: #6366f1;"><i class="fas fa-moon"></i></div>
                        <div class="option-title">ì‹ ë¹„ë¡œìš´</div>
                        <div class="option-desc">ë…íŠ¹í•˜ê³  í¥ë¯¸ë¡œìš´</div>
                    </div>
                    <div class="option-card" data-value="fresh">
                        <div class="option-icon" style="color: #059669;"><i class="fas fa-wind"></i></div>
                        <div class="option-title">ìƒì¾Œí•œ</div>
                        <div class="option-desc">ê¹¨ë—í•˜ê³  ìƒë™ê° ìˆëŠ”</div>
                    </div>
                </div>
            </div>

            <!-- ì§ˆë¬¸ 7: ì‚¬ìš© ì‹œê¸° -->
            <div class="question-card" data-question="7">
                <h3 class="question-title">ì£¼ë¡œ ì–¸ì œ í–¥ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì‹œë‚˜ìš”?</h3>
                <div class="option-grid" data-type="usage">
                    <div class="option-card" data-value="daily">
                        <div class="option-icon"><i class="fas fa-calendar-day"></i></div>
                        <div class="option-title">ë°ì¼ë¦¬</div>
                        <div class="option-desc">ë§¤ì¼ í¸ì•ˆí•˜ê²Œ</div>
                    </div>
                    <div class="option-card" data-value="work">
                        <div class="option-icon"><i class="fas fa-building"></i></div>
                        <div class="option-title">ì§ì¥/í•™êµ</div>
                        <div class="option-desc">ì—…ë¬´ë‚˜ í•™ì—… ì¤‘ì—</div>
                    </div>
                    <div class="option-card" data-value="date">
                        <div class="option-icon"><i class="fas fa-wine-glass"></i></div>
                        <div class="option-title">ë°ì´íŠ¸/ëª¨ì„</div>
                        <div class="option-desc">íŠ¹ë³„í•œ ë§Œë‚¨ì—ì„œ</div>
                    </div>
                    <div class="option-card" data-value="special">
                        <div class="option-icon"><i class="fas fa-gem"></i></div>
                        <div class="option-title">íŠ¹ë³„í•œ ë‚ </div>
                        <div class="option-desc">ì¤‘ìš”í•œ ìˆœê°„ì—</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ -->
        <div class="navigation-buttons">
            <button class="btn-custom btn-prev" id="btn-prev" style="display: none;">
                <i class="fas fa-chevron-left"></i> ì´ì „
            </button>
            <div></div>
            <button class="btn-custom btn-next" id="btn-next" disabled>
                ë‹¤ìŒ <i class="fas fa-chevron-right"></i>
            </button>
        </div>

        <!-- ë¡œë”© í™”ë©´ -->
        <div class="loading-spinner" id="loading">
            <div>
                <div class="spinner"></div>
                <div class="mt-3">ë‹¹ì‹ ë§Œì˜ í–¥ìˆ˜ë¥¼ ì°¾ê³  ìˆì–´ìš”...</div>
            </div>
        </div>

        <!-- ê²°ê³¼ ì„¹ì…˜ -->
        <div class="result-section" id="result-section">
            <div class="result-card fade-in">
                <div class="result-title" id="result-title">ë‹¹ì‹ ì—ê²Œ ì¶”ì²œí•˜ëŠ” í–¥ìˆ˜</div>
                <div id="result-description" class="mb-4"></div>
                
                <div class="recommended-perfumes" id="recommended-perfumes">
                    <!-- ì¶”ì²œ í–¥ìˆ˜ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>

                <div class="mt-4">
                    <button class="btn-custom btn-next" onclick="restartSurvey()">
                        <i class="fas fa-redo"></i> ë‹¤ì‹œ í…ŒìŠ¤íŠ¸í•˜ê¸°
                    </button>
                    <a href="/main/list" class="btn-custom btn-next ms-3">
                        ì „ì²´ ìƒí’ˆ ë³´ê¸° <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        class PerfumeSurvey {
            constructor() {
                this.currentStep = 1;
                this.totalSteps = 7;
                this.answers = {};
                this.init();
            }

            getIconByNote(noteId) {
                const iconMap = {
                    1: 'ğŸŒ¶ï¸', // ìŠ¤íŒŒì´ì‹œ
                    2: 'ğŸŒ³',  // ìš°ë””
                    3: 'ğŸŒ¿',  // í—ˆë²Œ
                    4: 'ğŸ',  // í‘¸ë£¨í‹°
                    5: 'ğŸ«',  // êµ¬ë¥´ë§
                    6: 'ğŸŒ¸',  // í”Œë¡œë„
                    7: 'ğŸ‹',  // ì‹œíŠ¸ëŸ¬ìŠ¤
                    8: 'ğŸ°'   // ë°”ë‹ë¼
                };
                return iconMap[noteId] || 'ğŸ¯';
            }

            // â˜… ìƒˆë¡œ ì¶”ê°€: í–¥ì˜ ê°•ë„ì— ë”°ë¥¸ grade ID í•„í„°ë§
            getGradeIdsByIntensity(intensity) {
                const gradeMapping = {
                    // ë¼ì´íŠ¸: ì˜¤ë“œì½”ë¡±(2), ì˜¤ë“œëšœì™ˆë ›(4)
                    'light': [2, 4],
                    // ë¯¸ë””ì›€: ì˜¤ë“œí¼í“¸(3), ì˜¤ë“œëšœì™ˆë ›(4)  
                    'medium': [3, 4],
                    // ìŠ¤íŠ¸ë¡±: í¼í“¸(1), ì˜¤ë“œí¼í“¸(3)
                    'strong': [1, 3]
                };
                return gradeMapping[intensity] || [];
            }

            getGradeNamesByIntensity(intensity) {
                const gradeNameMapping = {
                    'light': ['ì˜¤ë“œ ì½”ë¡±', 'ì˜¤ë“œ ëšœì™ˆë ›'],
                    'medium': ['ì˜¤ë“œ í¼í“¸', 'ì˜¤ë“œ ëšœì™ˆë ›'], 
                    'strong': ['í¼í“¸', 'ì˜¤ë“œ í¼í“¸']
                };
                return gradeNameMapping[intensity] || [];
            }

            init() {
                this.bindEvents();
                this.updateProgress();
            }

            bindEvents() {
                document.querySelectorAll('.option-card').forEach(card => {
                    card.addEventListener('click', () => {
                        this.handleOptionSelect(card);
                    });
                });

                document.getElementById('btn-next').addEventListener('click', () => {
                    this.nextStep();
                });

                document.getElementById('btn-prev').addEventListener('click', () => {
                    this.prevStep();
                });
            }

            handleOptionSelect(optionCard) {
                const questionCard = optionCard.closest('.question-card');
                const questionType = optionCard.closest('.option-grid').dataset.type;
                const value = optionCard.dataset.value;

                questionCard.querySelectorAll('.option-card').forEach(card => {
                    card.classList.remove('selected');
                });

                optionCard.classList.add('selected');

                this.answers[questionType] = value;

                const nextBtn = document.getElementById('btn-next');
                nextBtn.disabled = false;
                nextBtn.style.opacity = '1';
                nextBtn.style.cursor = 'pointer';
            }

            nextStep() {
                if (this.currentStep < this.totalSteps) {
                    this.hideCurrentStep();
                    this.currentStep++;
                    this.showCurrentStep();
                    this.updateProgress();
                    this.updateNavigation();
                } else {
                    this.showResults();
                }
            }

            prevStep() {
                if (this.currentStep > 1) {
                    this.hideCurrentStep();
                    this.currentStep--;
                    this.showCurrentStep();
                    this.updateProgress();
                    this.updateNavigation();
                }
            }

            hideCurrentStep() {
                const currentCard = document.querySelector(`[data-question="${this.currentStep}"]`);
                if (currentCard) currentCard.classList.remove('active');
            }

            showCurrentStep() {
                const currentCard = document.querySelector(`[data-question="${this.currentStep}"]`);
                if (currentCard) {
                    setTimeout(() => currentCard.classList.add('active'), 100);
                }
            }

            updateProgress() {
                const progressFill = document.getElementById('progress-fill');
                const currentStepEl = document.getElementById('current-step');
                
                const percentage = (this.currentStep / this.totalSteps) * 100;
                progressFill.style.width = percentage + '%';
                currentStepEl.textContent = this.currentStep;
            }

            updateNavigation() {
                const btnPrev = document.getElementById('btn-prev');
                const btnNext = document.getElementById('btn-next');

                btnPrev.style.display = this.currentStep > 1 ? 'inline-flex' : 'none';

                const currentCard = document.querySelector(`[data-question="${this.currentStep}"]`);
                const hasAnswer = currentCard && currentCard.querySelector('.option-card.selected');
                btnNext.disabled = !hasAnswer;

                if (this.currentStep === this.totalSteps) {
                    btnNext.innerHTML = 'ê²°ê³¼ ë³´ê¸° <i class="fas fa-magic"></i>';
                } else {
                    btnNext.innerHTML = 'ë‹¤ìŒ <i class="fas fa-chevron-right"></i>';
                }
            }

            showResults() {
                document.getElementById('loading').style.display = 'flex';
                document.querySelector('.navigation-buttons').style.display = 'none';
                document.getElementById('questions-container').style.display = 'none';

                setTimeout(() => {
                    this.generateRecommendations();
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('result-section').style.display = 'block';
                }, 500);
            }

            generateRecommendations() {
                const recommendations = this.getRecommendationsByAnswers();
                
                this.fetchRecommendedPerfumes(recommendations.mainNoteIds, this.answers.intensity)
                    .then(perfumes => {
                        document.getElementById('result-title').textContent = recommendations.title;
                        document.getElementById('result-description').textContent = recommendations.description;
                        
                        const perfumesContainer = document.getElementById('recommended-perfumes');
                        perfumesContainer.innerHTML = '';

                        if (perfumes && perfumes.length > 0) {
                            perfumes.forEach(perfume => {
                                const perfumeCard = document.createElement('div');
                                perfumeCard.className = 'perfume-card';
                                perfumeCard.innerHTML = `
                                    <div class="perfume-image">
                                        <img src="${perfume.imageUrl || '/images/default-perfume.png'}" 
                                             alt="${perfume.name}" style="width: 60px; height: 60px; object-fit: contain;">
                                    </div>
                                    <div class="perfume-name">${perfume.name}</div>
                                    <div class="perfume-brand">${perfume.brand || ''}</div>
                                    <div class="perfume-notes">
                                        <div class="small text-primary">${perfume.gradeName || ''}</div>
                                        <div>${perfume.mainNote || ''}</div>
                                    </div>
                                    <div class="fw-bold text-primary">${(perfume.price || 0).toLocaleString()}ì›</div>
                                    <a href="/main/content/${perfume.id}" class="btn btn-sm btn-outline-primary mt-2">
                                        ìì„¸íˆ ë³´ê¸°
                                    </a>
                                `;
                                perfumesContainer.appendChild(perfumeCard);
                            });
                        } else {
                            this.showSamplePerfumes(recommendations, perfumesContainer);
                        }
                    })
                    .catch(() => {
                        this.showSamplePerfumes(recommendations, document.getElementById('recommended-perfumes'));
                    });
            }

            // â˜… ìˆ˜ì •ëœ ë©”ì†Œë“œ: intensity ì •ë³´ë¥¼ APIë¡œ ì „ë‹¬ (gradeIds ì‚¬ìš©)
            async fetchRecommendedPerfumes(mainNoteIds, intensity) {
                try {
                    const params = new URLSearchParams();
                    mainNoteIds.forEach(id => params.append('mainNoteIds', id));
                    
                    // â˜… ê°•ë„ì— ë”°ë¥¸ grade ID í•„í„°ë§ ì¶”ê°€
                    if (intensity) {
                        const allowedGradeIds = this.getGradeIdsByIntensity(intensity);
                        allowedGradeIds.forEach(gradeId => params.append('gradeIds', gradeId));
                    }
                    
                    params.append('size', '6');
                    
                    const response = await fetch(`/api/products/recommendations?${params.toString()}`);
                    if (!response.ok) throw new Error('API í˜¸ì¶œ ì‹¤íŒ¨');
                    
                    const data = await response.json();
                    if (data.success && data.items && data.items.length > 0) {
                        return data.items;
                    } else {
                        throw new Error('ì¶”ì²œ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤');
                    }
                } catch {
                    return [];
                }
            }

            showSamplePerfumes(recommendations, container) {
                // â˜… ìƒ˜í”Œ í–¥ìˆ˜ë„ ê°•ë„ì— ë”°ë¼ í•„í„°ë§
                const allowedGradeIds = this.getGradeIdsByIntensity(this.answers.intensity);
                const allowedGradeNames = this.getGradeNamesByIntensity(this.answers.intensity);
                const intensityText = this.getIntensityText(this.answers.intensity);
                
                recommendations.perfumes.forEach(perfume => {
                    const perfumeCard = document.createElement('div');
                    perfumeCard.className = 'perfume-card';
                    
                    if (perfume.isCategory) {
                        const mainNoteParam = Array.isArray(perfume.mainNoteId) ? 
                            perfume.mainNoteId.join(',') : perfume.mainNoteId;
                        
                        // â˜… URLì— gradeIds í•„í„° ì¶”ê°€
                        let url = `/main/list?mainNoteIds=${mainNoteParam}`;
                        if (allowedGradeIds.length > 0) {
                            const gradeParam = allowedGradeIds.join(',');
                            url += `&gradeIds=${gradeParam}`;
                        }
                        
                        perfumeCard.innerHTML = `
                            <div class="perfume-image" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                                ${perfume.icon}
                            </div>
                            <div class="perfume-name">${perfume.name}</div>
                            <div class="perfume-brand">${perfume.brand}</div>
                            <div class="perfume-notes">
                                <div class="small text-primary">${intensityText}</div>
                                <div>${perfume.notes}</div>
                            </div>
                            <a href="${url}" class="btn btn-sm btn-primary mt-2">
                                <i class="fas fa-search"></i> ìƒí’ˆ ë³´ëŸ¬ê°€ê¸°
                            </a>
                        `;
                    } else {
                        perfumeCard.innerHTML = `
                            <div class="perfume-image">
                                <img src="${perfume.imageUrl || '/images/default-perfume.png'}" 
                                     alt="${perfume.name}" style="width: 60px; height: 60px; object-fit: contain;">
                            </div>
                            <div class="perfume-name">${perfume.name}</div>
                            <div class="perfume-brand">${perfume.brand}</div>
                            <div class="perfume-notes">
                                <div class="small text-primary">${perfume.gradeName || ''}</div>
                                <div>${perfume.notes}</div>
                            </div>
                            <div class="fw-bold text-primary">${parseInt(perfume.price || 0).toLocaleString()}ì›</div>
                            <a href="/main/content/${perfume.id}" class="btn btn-sm btn-outline-primary mt-2">
                                ìì„¸íˆ ë³´ê¸°
                            </a>
                        `;
                    }
                    container.appendChild(perfumeCard);
                });

                document.getElementById('result-title').textContent = recommendations.title;
                document.getElementById('result-description').textContent = recommendations.description;
            }

            // â˜… ìƒˆë¡œ ì¶”ê°€: ê°•ë„ë³„ í…ìŠ¤íŠ¸ ë°˜í™˜
            getIntensityText(intensity) {
                const intensityMap = {
                    'light': 'ë¼ì´íŠ¸ (ì€ì€í•œ í–¥)',
                    'medium': 'ë¯¸ë””ì›€ (ì ë‹¹í•œ í–¥)',
                    'strong': 'ìŠ¤íŠ¸ë¡± (ì§„í•œ í–¥)'
                };
                return intensityMap[intensity] || '';
            }

            getRecommendationsByAnswers() {
                const mainNoteMapping = {
                    'floral': 6, 'citrus': 7, 'woody': 2, 'spicy': 1,
                    'vanilla': 8, 'fruity': 4, 'herbal': 3, 'gourmand': 5
                };

                const { demographics, mood, season, intensity, notes, personality } = this.answers;
                
                let primaryMainNote = mainNoteMapping[notes] || 6;
                let additionalNotes = new Set();

                if (mood === 'romantic') {
                    if (primaryMainNote !== 6) additionalNotes.add(6);
                    if (primaryMainNote !== 8) additionalNotes.add(8);
                } else if (mood === 'professional') {
                    if (primaryMainNote !== 2) additionalNotes.add(2);
                    if (primaryMainNote !== 7) additionalNotes.add(7);
                } else if (mood === 'casual') {
                    if (primaryMainNote !== 7) additionalNotes.add(7);
                    if (primaryMainNote !== 3) additionalNotes.add(3);
                } else if (mood === 'luxurious') {
                    if (primaryMainNote !== 1) additionalNotes.add(1);
                    if (primaryMainNote !== 5) additionalNotes.add(5);
                }

                if (season === 'spring') {
                    if (primaryMainNote !== 6) additionalNotes.add(6);
                    if (primaryMainNote !== 4) additionalNotes.add(4);
                } else if (season === 'summer') {
                    if (primaryMainNote !== 7) additionalNotes.add(7);
                    if (primaryMainNote !== 3) additionalNotes.add(3);
                } else if (season === 'autumn') {
                    if (primaryMainNote !== 2) additionalNotes.add(2);
                    if (primaryMainNote !== 5) additionalNotes.add(5);
                } else if (season === 'winter') {
                    if (primaryMainNote !== 8) additionalNotes.add(8);
                    if (primaryMainNote !== 1) additionalNotes.add(1);
                }

                if (personality === 'gentle') {
                    if (primaryMainNote !== 6) additionalNotes.add(6);
                    if (primaryMainNote !== 8) additionalNotes.add(8);
                } else if (personality === 'confident') {
                    if (primaryMainNote !== 1) additionalNotes.add(1);
                    if (primaryMainNote !== 2) additionalNotes.add(2);
                } else if (personality === 'fresh') {
                    if (primaryMainNote !== 7) additionalNotes.add(7);
                    if (primaryMainNote !== 3) additionalNotes.add(3);
                } else if (personality === 'mysterious') {
                    if (primaryMainNote !== 5) additionalNotes.add(5);
                    if (primaryMainNote !== 1) additionalNotes.add(1);
                }

                const recommendedMainNotes = [primaryMainNote, ...Array.from(additionalNotes).slice(0, 2)];
                
                const mainNoteNames = {
                    1: 'ìŠ¤íŒŒì´ì‹œ', 2: 'ìš°ë””', 3: 'í—ˆë²Œ', 4: 'í‘¸ë£¨í‹°',
                    5: 'êµ¬ë¥´ë§', 6: 'í”Œë¡œë„', 7: 'ì‹œíŠ¸ëŸ¬ìŠ¤', 8: 'ë°”ë‹ë¼'
                };

                const selectedNoteNames = recommendedMainNotes.map(id => mainNoteNames[id]).join(', ');
                const intensityText = this.getIntensityText(intensity);
                
                let title = "ë‹¹ì‹ ë§Œì˜ ì‹œê·¸ë‹ˆì²˜ í–¥ìˆ˜";
                let description = `${selectedNoteNames} ê³„ì—´ì˜ ${intensityText} í–¥ìˆ˜ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ë‹¹ì‹ ì—ê²Œ ì–´ìš¸ë¦¬ëŠ” í–¥ìˆ˜ë“¤ì„ ì„ ë³„í–ˆì–´ìš”.`;

                // â˜… ê°•ë„ë³„ ë§ì¶¤ ë©”ì‹œì§€ ì¶”ê°€
                if (intensity === 'light') {
                    description = `${selectedNoteNames} ê³„ì—´ì˜ ì€ì€í•˜ê³  ë¶€ë“œëŸ¬ìš´ í–¥ìˆ˜ë“¤ë¡œ ì¼ìƒì—ì„œ í¸ì•ˆí•˜ê²Œ ì‚¬ìš©í•˜ì„¸ìš”.`;
                } else if (intensity === 'strong') {
                    description = `${selectedNoteNames} ê³„ì—´ì˜ ì§„í•˜ê³  ì˜¤ë˜ê°€ëŠ” í–¥ìˆ˜ë“¤ë¡œ íŠ¹ë³„í•œ ìˆœê°„ì„ ë”ìš± ì¸ìƒê¹Šê²Œ ë§Œë“œì„¸ìš”.`;
                }

                if (mood === 'romantic' && notes === 'floral') {
                    title = "ë¡œë§¨í‹± í”Œë¡œëŸ´ì˜ ì—¬ì‹ ";
                    description = `${selectedNoteNames} ê³„ì—´ì˜ ${intensityText} ë‹¬ì½¤í•˜ê³  ìš°ì•„í•œ í–¥ìˆ˜ë“¤ì„ ì¶”ì²œí•´ë“œë ¤ìš”.`;
                } else if (personality === 'confident' && notes === 'spicy') {
                    title = "ê°•ë ¬í•œ ì¹´ë¦¬ìŠ¤ë§ˆ";
                    description = `${selectedNoteNames} ê³„ì—´ì˜ ${intensityText} íŒŒì›Œí’€í•œ í–¥ìˆ˜ë¡œ ë‹¹ì‹ ì˜ ìì‹ ê°ì„ í‘œí˜„í•´ë³´ì„¸ìš”.`;
                } else if (mood === 'casual' && notes === 'citrus') {
                    title = "ìƒì¾Œí•œ ì¼ìƒì˜ ë™ë°˜ì";
                    description = `${selectedNoteNames} ê³„ì—´ì˜ ${intensityText} ìƒì¾Œí•œ í–¥ìˆ˜ë“¤ë¡œ ë§¤ì¼ì„ íŠ¹ë³„í•˜ê²Œ ë§Œë“¤ì–´ë³´ì„¸ìš”.`;
                } else if (season === 'winter' && notes === 'gourmand') {
                    title = "ê²¨ìš¸ë°¤ì˜ ë‹¬ì½¤í•œ ìœ í˜¹";
                    description = `${selectedNoteNames} ê³„ì—´ì˜ ${intensityText} ë”°ëœ»í•˜ê³  ë‹¬ì½¤í•œ í–¥ìˆ˜ë¡œ ì¶”ìš´ ê²¨ìš¸ì„ í¬ê·¼í•˜ê²Œ.`;
                } else if (demographics === 'male' && notes === 'woody') {
                    title = "ë‚¨ì„±ì  ë§¤ë ¥ì˜ ì™„ì„±";
                    description = `${selectedNoteNames} ê³„ì—´ì˜ ${intensityText} ê¹Šì´ ìˆëŠ” í–¥ìˆ˜ë¡œ ë‹¹ì‹ ë§Œì˜ ë‚¨ì„±ë¯¸ë¥¼ ì—°ì¶œí•˜ì„¸ìš”.`;
                } else if (demographics === 'female' && mood === 'luxurious') {
                    title = "ìš°ì•„í•œ ì—¬ì„±ì˜ í’ˆê²©";
                    description = `${selectedNoteNames} ê³„ì—´ì˜ ${intensityText} ê³ ê¸‰ìŠ¤ëŸ¬ìš´ í–¥ìˆ˜ë¡œ íŠ¹ë³„í•œ ë§¤ë ¥ì„ ë°œì‚°í•˜ì„¸ìš”.`;
                } else if (notes === 'vanilla') {
                    title = "ë‹¬ì½¤í•œ ë°”ë‹ë¼ì˜ ë§¤ë ¥";
                    description = `${selectedNoteNames} ê³„ì—´ì˜ ${intensityText} ë¶€ë“œëŸ½ê³  ë”°ëœ»í•œ í–¥ìˆ˜ë¡œ í¬ê·¼í•¨ì„ í‘œí˜„í•˜ì„¸ìš”.`;
                } else if (notes === 'herbal') {
                    title = "ìì—°ì˜ ìƒì¾Œí•¨";
                    description = `${selectedNoteNames} ê³„ì—´ì˜ ${intensityText} ì²­ëŸ‰í•œ í–¥ìˆ˜ë¡œ ìì—°ìŠ¤ëŸ¬ìš´ ë§¤ë ¥ì„ ì—°ì¶œí•˜ì„¸ìš”.`;
                } else if (notes === 'fruity') {
                    title = "ìƒí¼í•œ ê³¼ì¼ í–¥ì—°";
                    description = `${selectedNoteNames} ê³„ì—´ì˜ ${intensityText} ë‹¬ì½¤í•˜ê³  ìƒí¼í•œ í–¥ìˆ˜ë¡œ í™œê¸°ì°¬ ë§¤ë ¥ì„ í‘œí˜„í•˜ì„¸ìš”.`;
                }

                const categoryLinks = [
                    {
                        id: "list",
                        name: `${mainNoteNames[recommendedMainNotes[0]]} ê³„ì—´ í–¥ìˆ˜`,
                        brand: "22Â°C ì¶”ì²œ",
                        icon: this.getIconByNote(recommendedMainNotes[0]),
                        notes: `${selectedNoteNames} í–¥ìˆ˜ ëª¨ìŒ`,
                        isCategory: true,
                        mainNoteId: recommendedMainNotes[0]
                    },
                    {
                        id: "list", 
                        name: `${mainNoteNames[recommendedMainNotes[1] || recommendedMainNotes[0]]} ë² ìŠ¤íŠ¸`,
                        brand: "22Â°C ì¶”ì²œ",
                        icon: this.getIconByNote(recommendedMainNotes[1] || recommendedMainNotes[0]),
                        notes: "ì¸ê¸° ìƒí’ˆ ëª¨ìŒ",
                        isCategory: true,
                        mainNoteId: recommendedMainNotes[1] || recommendedMainNotes[0]
                    },
                    {
                        id: "list",
                        name: "ì „ì²´ ì¶”ì²œ ìƒí’ˆ",
                        brand: "22Â°C",
                        icon: "ğŸ’«",
                        notes: "ë‹¹ì‹ ì„ ìœ„í•œ íŠ¹ë³„í•œ ì„ íƒ",
                        isCategory: true,
                        mainNoteId: recommendedMainNotes.join(',')
                    }
                ];

                return {
                    title,
                    description,
                    perfumes: categoryLinks,
                    mainNoteIds: recommendedMainNotes
                };
            }
        }

        function restartSurvey() {
            location.reload();
        }

        document.addEventListener('DOMContentLoaded', () => {
            new PerfumeSurvey();
        });
    </script>
</body>
</html>