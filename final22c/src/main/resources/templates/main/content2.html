<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
	xmlns:sec="https://www.thymeleaf.org/extras/spring-security" layout:decorate="~{layout/layout}">

<head>
	<title>ìƒí’ˆ ìƒì„¸</title>
	<!-- ê°œì¸ì ìœ¼ë¡œ ë„£ì„ css ë¶€ë¶„ ì¶”ê°€ ì‹œì‘ -->
	<th:block layout:fragment="css">
		<link rel="stylesheet" href="/css/content.css">

		<!-- í•„ìš” í´ë˜ìŠ¤ë§Œ ìµœì†Œì¹˜ë¡œ ë³´ê°•(ì›í•˜ì‹œë©´ content.cssë¡œ ì´ë™í•˜ì„¸ìš”) -->
		<style>
			/* ai ìª½ css */
			.ai-enhanced-description {
				background: linear-gradient(135deg, #f8f9ff 0%, #fff5f5 100%);
				border-radius: 12px;
				padding: 20px;
				margin-top: 20px;
			}

			.ai-enhanced-description h3 {
				color: #2d3748;
				font-weight: 600;
			}

			.ai-content {
				line-height: 1.6;
				color: #4a5568;
				font-size: 14px;
			}

			.desc .desc-title {
				margin: 1rem 0 .5rem;
				font-weight: 600;
				font-size: 1.05rem;
			}

			.desc .desc-list {
				margin: 0 0 1rem 1.2rem;
				line-height: 1.6;
			}

			.desc .desc-list li {
				margin: .35rem 0;
			}

			.desc .desc-block+.desc-block {
				margin-top: .5rem;
			}

			/* ë¸”ë¡ ê°„ ê°„ê²© */

			/* ìš°ì¸¡ ë‚ ì§œ/ì•¡ì…˜ ì»¬ëŸ¼: ì¤„ë°”ê¿ˆ ìµœì†Œí™”ìš© í­ */
			.review-right {
				display: flex;
				flex-direction: column;
				align-items: flex-end;
				min-width: 116px;
			}

			/* ì•¡ì…˜ ê³µí†µ(í¬ê¸°/ê°„ê²©) - ìš”ì²­ëŒ€ë¡œ ì‘ê²Œ(11px) */
			.review-actions {
				line-height: 1;
			}

			.review-actions .ra-link,
			.review-actions .ra-box {
				font-size: 11px;
				margin-left: 8px;
			}

			/* ì–¸ë”ë¼ì¸ í˜¸ë²„í˜•(í‘/ë°±/íšŒìƒ‰ë§Œ) */
			.ra-link {
				appearance: none;
				background: none;
				border: 0;
				padding: 0;
				color: #666;
				text-decoration: none;
				cursor: pointer;
				background-image: linear-gradient(currentColor, currentColor);
				background-position: 0 100%;
				background-size: 0% 1px;
				background-repeat: no-repeat;
				transition: background-size .18s ease, color .18s ease;
			}

			.ra-link:hover {
				color: #111;
				background-size: 100% 1px;
			}

			.ra-danger {
				color: #b55;
			}

			.ra-danger:hover {
				color: #922;
				background-size: 100% 1px;
			}

			/* ì¢‹ì•„ìš” UI(ë¬´ì±„ìƒ‰) */
			.like-wrap {
				display: inline-flex;
				align-items: center;
				gap: 6px;
				color: #666;
			}

			.like-wrap .btn-like {
				appearance: none;
				border: 0;
				background: none;
				padding: 0 2px;
				cursor: pointer;
				line-height: 1;
				color: inherit;
				background-image: linear-gradient(currentColor, currentColor);
				background-position: 0 100%;
				background-size: 0% 1px;
				background-repeat: no-repeat;
				transition: background-size .18s ease, color .18s ease, transform .06s ease;
				font-size: 12px;
			}

			.like-wrap .btn-like:hover {
				color: #111;
				background-size: 100% 1px;
			}

			.like-wrap .btn-like:active {
				transform: scale(0.96);
			}

			.like-wrap .like-count {
				font-size: 12px;
				color: #444;
			}

			.like-wrap.is-liked {
				color: #111;
			}

			.like-wrap.is-liked .btn-like i {
				font-weight: 900;
			}

			/* ì¬ê³  ì œí•œ ì•ˆë‚´ ë¬¸êµ¬ */
			.stock-hint {
				margin-top: 6px;
				font-size: 12px;
				color: #922;
				/* ì‚´ì§ ê²½ê³  í†¤ */
			}

			.stock-hint[data-pop="1"] {
				animation: stock-pop .18s ease;
			}

			@keyframes stock-pop {
				from {
					opacity: 0;
					transform: translateY(-2px);
				}

				to {
					opacity: 1;
					transform: translateY(0);
				}
			}

			/* ì—°ê´€ ìƒí’ˆ ì¹´ë“œ */
			.rel-card {
				text-decoration: none;
				color: inherit;
			}

			.rel-card:hover .rel-title {
				text-decoration: underline;
			}

			.rel-thumb {
				border-radius: 10px;
				overflow: hidden;
				background: #f7f7f7;
			}

			.rel-thumb img {
				object-fit: cover;
				width: 100%;
				height: 100%;
			}

			.rel-title {
				font-size: 0.95rem;
				line-height: 1.2;
				min-height: 1.2em;
			}

			.rel-price {
				font-size: 0.95rem;
			}

			.rel-price .original {
				font-size: 0.85rem;
			}

			.rec-carousel {
				display: flex;
				align-items: center;
				gap: 16px;
			}

			.rec-carousel .rec-track {
				flex: 1 1 auto;
			}

			/* ê°€ìš´ë° ìºëŸ¬ì…€ ì˜ì—­ */
			/* 1) ì–‘ì˜† < / > ë²„íŠ¼: ë™ê·¸ë¼ë¯¸/í…Œë‘ë¦¬ ì œê±° â†’ ë¬¸ìë§Œ ë³´ì´ê²Œ */
			.rec-nav {
				all: unset;
				/* ë²„íŠ¼ ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì‹¹ ì œê±° */
				display: inline-flex;
				align-items: center;
				justify-content: center;
				padding: 0 8px;
				min-width: 24px;
				/* í„°ì¹˜ ì˜ì—­ í™•ë³´ */
				line-height: 1;
				font-size: 28px;
				color: #111;
				cursor: pointer;
			}

			.rec-nav:hover {
				color: #000;
			}

			.rec-nav:disabled {
				opacity: .35;
				cursor: not-allowed;
			}

			/* í˜¹ì‹œ ë‚¨ì•„ìˆëŠ” ì›í˜•/ê·¸ë¦¼ì ê°•ì œ ì œê±° */
			.rec-nav,
			.rec-nav:hover {
				background: none !important;
				border: 0 !important;
				border-radius: 0 !important;
				box-shadow: none !important;
				width: auto !important;
				height: auto !important;
			}

			/* 2) ì¹´ë“œ a:hover ë°‘ì¤„ ì œê±° (ì™„ì „ ë¹„í™œì„±) */
			a.rel-card {
				text-decoration: none !important;
				color: inherit;
			}

			a.rel-card:hover,
			a.rel-card:focus {
				text-decoration: none !important;
			}

			.rel-card .rel-title {
				text-decoration: none !important;
			}

			/* 3) ìºëŸ¬ì…€ ì „í™˜ ì‹œ ì´ë¯¸ì§€ â€˜í™•ëŒ€â€™ íš¨ê³¼ ì œê±° */
			.rec-carousel .carousel-item .rel-thumb img {
				transform: none !important;
				transition: none !important;
				animation: none !important;
			}

			.rec-carousel .carousel-item.active .rel-thumb img {
				transform: none !important;
			}

			/* ìºëŸ¬ì…€ ì¢Œ/ìš° ì´ë™ ì• ë‹ˆë©”ì´ì…˜ ë³µêµ¬ */
			.rec-carousel .carousel-item {
				transition: transform .5s ease-in-out !important;
			}

			/* ëª¨ì…˜ ìµœì†Œí™” í™˜ê²½ ì¡´ì¤‘ */
			@media (prefers-reduced-motion: reduce) {
				.rec-carousel .carousel-item {
					transition: none !important;
				}
			}

			/* â”€â”€ ìºëŸ¬ì…€ ì¸ë””ì¼€ì´í„°: ì•„ë˜ ì‘ì€ ì  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
			.rec-carousel .carousel-indicators {
				position: static !important;
				/* ì˜¤ë²„ë ˆì´ ë§ê³  ì•„ë˜ë¡œ */
				margin-top: 10px;
				display: flex;
				gap: 8px;
				justify-content: center;
			}

			.rec-carousel .carousel-indicators button {
				width: 8px;
				height: 8px;
				border-radius: 9999px;
				border: 0;
				background: #d1d5db;
				/* íšŒìƒ‰ ì  */
				opacity: 1;
				/* ë¶€íŠ¸ìŠ¤íŠ¸ë© ê¸°ë³¸ íˆ¬ëª…ë„ ì œê±° */
			}

			.rec-carousel .carousel-indicators button.active {
				background: #111;
				/* í˜„ì¬ í˜ì´ì§€ ì  */
			}

			.rec-carousel .carousel-indicators button:focus-visible {
				outline: 2px solid #111;
				outline-offset: 2px;
			}

			/* â”€â”€ ìºëŸ¬ì…€ ì¹´ë“œ hover íš¨ê³¼: ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ì¹´ë“œ ëŠë‚Œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
			.rec-carousel .rel-card {
				display: block;
				background: #fff;
				border: 1px solid #e5e7eb;
				/* ê¸°ë³¸ í…Œë‘ë¦¬ */
				border-radius: 16px;
				padding: 12px;
				transition: border-color .18s ease, background-color .18s ease, transform .18s ease;
			}

			@media (hover:hover) and (pointer:fine) {
				.rec-carousel .rel-card:hover {
					/* border-color: #c7d2fe; */
					/* ì‚´ì§ ê°•ì¡° */
					background: #f8fafc;
					/* transform: translateY(-1px); */
					box-shadow: none !important;
					/* â† ê·¸ë¦¼ì ì œê±° */
				}
			}

			.rec-carousel .rel-card:active {
				transform: translateY(0);
			}

			/* .rec-carousel .rel-card:focus-visible {
        outline: 2px solid #c7d2fe;
        outline-offset: 2px;
      } */

			/* ì¹´ë“œ ì•ˆ ì¸ë„¤ì¼ë„ ëª¨ì„œë¦¬ ë§ì¶¤ */
			.rec-carousel .rel-thumb {
				border-radius: 12px;
				overflow: hidden;
				background: #f9fafb;
			}

			/* ê°œìˆ˜: ê³ ì •í­ + ìš°ì¸¡ ì •ë ¬ â†’ 1, 12, 123 ëª¨ë‘ ê°™ì€ ëì„  */
			.rating-dist .value .count {
				display: inline-block;
				width: 3ch;
				/* 0ì˜ í­ ê¸°ì¤€ 3ê¸€ì(0~999 ëŒ€ì‘). ë” í•„ìš”í•˜ë©´ 4ch/5chë¡œ */
				text-align: right;
			}

			/* í¼ì„¼íŠ¸: ê°€ë²¼ìš´ í†¤ + ìµœì†Œí­(ì„ íƒ) */
			.rating-dist .value .pct {
				display: inline-block;
				min-width: 6ch;
				/* '(100%)'ê¹Œì§€ ì—¬ìœ . í•„ìš” ì—†ìœ¼ë©´ ì‚­ì œ ê°€ëŠ¥ */
				text-align: left;
				color: #9aa3af;
			}

			/* === ë¦¬ë·° ìƒë‹¨ ìš”ì•½ ë ˆì´ì•„ì›ƒ: ì¤‘ì•™ ì •ë ¬ + ê· í˜• ì»¬ëŸ¼ === */
			/* ê¸°ì¡´ .review-head ë¥¼ ì´ë ‡ê²Œ ì¡°ì • */
			.review-head {
				max-width: 1120px;
				/* ì „ì²´ í­ ì¡°ê¸ˆ ë„“í˜€ ë³´ê¸° ì‹œì›í•˜ê²Œ */
				margin: 8px auto 0;
				display: grid;
				grid-template-columns: minmax(280px, 1fr) 1px 1.5fr;
				/* â† ìš°ì¸¡ 1.5ë°° */
				column-gap: 20px;
				/* ê°„ê²© ì•½ê°„ë§Œ */
				align-items: center;
			}

			/* ì¢Œì¸¡ ìš”ì•½ ë¸”ë¡ì„ ê°€ìš´ë° ìª½ìœ¼ë¡œ ë¶™ì´ë˜, ë‚´ë¶€ í…ìŠ¤íŠ¸ëŠ” ì¢Œì¸¡ ì •ë ¬ ìœ ì§€ */
			.review-head .summary {
				justify-self: end;
				/* ê·¸ë¦¬ë“œ ì…€ ì•ˆì—ì„œ ì˜¤ë¥¸ìª½ ì •ë ¬ â†’ ì¤‘ì•™ìœ¼ë¡œ ëª¨ì„ */
				text-align: left;
				min-width: 280px;
				/* ë„ˆë¬´ ì¢ì•„ì§€ì§€ ì•Šê²Œ */
			}

			/* í‰ê·  ìˆ«ì/ì´ê°œìˆ˜ ë³´ì •(ë³´ê¸° ì¢‹ê²Œ ì¡°ê¸ˆ í‚¤ì›€) */
			.review-head .avg-number {
				font-size: 1.7rem;
				font-weight: 700;
				line-height: 1.1;
				margin-top: 6px;
			}

			.review-head .total {
				margin-top: 2px;
				font-size: .9rem;
				color: #94a3b8;
			}

			/* ê°€ìš´ë° ì„¸ë¡œ êµ¬ë¶„ì„  */
			.review-head .vrule {
				align-self: stretch;
				width: 1px;
				background: #e5e7eb;
			}

			/* ìš°ì¸¡ ë¶„í¬ ë§‰ëŒ€: ê·¸ë¦¬ë“œ ìš°ì¸¡ ì»¬ëŸ¼ ì „ì²´ë¥¼ ì‚¬ìš© */
			.rating-dist {
				justify-self: start;
				/* ì¤‘ì•™ ìª½ì—ì„œ ì‹œì‘ */
				width: 100%;
				max-width: none;
				/* ì»¬ëŸ¼ í­ë§Œí¼ ê½‰ ì‚¬ìš© */
				list-style: none;
				padding: 0;
				margin: 0;
				--max: 1;
				/* ê°’ ì»¬ëŸ¼ í­(ì˜¤ë¥¸ìª½) */
				--valw: 96px;
			}

			.rating-dist li {
				display: grid;
				grid-template-columns: 32px 1fr var(--valw);
				align-items: center;
				gap: 8px;
				margin: 8px 0;
			}

			.rating-dist .label {
				width: 28px;
				color: #4b5563;
				text-align: right;
			}

			.rating-dist .bar {
				flex: 1;
				height: 12px;
				background: #f2f4f7;
				border-radius: 9999px;
				overflow: hidden;
			}

			.rating-dist .fill {
				height: 100%;
				background: #555;
				width: calc((var(--cnt, 0) / var(--max, 1)) * 100%);
			}

			.rating-dist .value {
				width: auto !important;
				display: inline-flex;
				justify-content: flex-end;
				gap: 6px;
				white-space: nowrap;
				font-variant-numeric: tabular-nums;
			}

			/* ëª¨ë°”ì¼ì—ì„œëŠ” ìˆ˜ì§ ìŠ¤íƒ */
			@media (max-width: 768px) {
				.review-head {
					grid-template-columns: 1fr;
					row-gap: 12px;
				}

				.review-head .vrule {
					display: none;
				}

				.review-head .summary {
					justify-self: stretch;
				}

				.rating-dist {
					--valw: 100px;
				}
			}

			:root {
				--hair: #eceff1;
				/* í—¤ì–´ë¼ì¸ */
				--ink: #111;
				/* ë³¸ë¬¸ìƒ‰ */
				--mute: #64748b;
				/* ë³´ì¡°í…ìŠ¤íŠ¸ */
				--accent: #111;
				/* í¬ì¸íŠ¸(ê²€ì • ìœ ì§€) */
				--cs-radius: 10px;
				/* form-selectì™€ ë™ì¼í•˜ê²Œ */
				--cs-gap: 6px;
				--cs-hover: #f3f4f6;
				/* íŒŒë€ hover í†¤ ì œê±° â†’ ì¤‘ë¦½ íšŒìƒ‰ */
			}

			/* === ì»¤ìŠ¤í…€ ì…€ë ‰íŠ¸ ê³µí†µ === */
			.cs {
				position: relative;
				display: inline-block;
				width: 400px;
				/* ğŸ”¹ ì›í•˜ëŠ” í¬ê¸°ë¡œ ì¤„ì„ */
				font-size: 14px;
			}

			/* ë²„íŠ¼ ì˜ì—­ */
			.cs-btn {
				width: 100%;
				padding: 6px 10px;
				border: 1px solid #ccc;
				/* ğŸ”¹ í…Œë‘ë¦¬ ì¶”ê°€ */
				border-radius: 6px;
				background: #fff;
				text-align: left;
				cursor: pointer;
			}

			.cs-btn::after {
				content: "â–¾";
				/* ë“œë¡­ë‹¤ìš´ í‘œì‹œ */
				float: right;
				font-size: 12px;
				color: #666;
			}

			/* ë©”ë‰´ ì˜ì—­ */
			.cs-menu {
				position: absolute;
				top: 100%;
				left: 0;
				right: 0;
				margin: 4px 0 0;
				padding: 0;
				list-style: none;
				background: #fff;
				border: 1px solid #ccc;
				/* ğŸ”¹ í…Œë‘ë¦¬ */
				border-radius: 6px;
				max-height: 200px;
				overflow-y: auto;
				display: none;
				/* ê¸°ë³¸ ë‹«í˜ */
				z-index: 1000;
			}

			/* ì—´ë ¸ì„ ë•Œ */
			.cs.is-open .cs-menu {
				display: block;
			}

			/* í•­ëª© */
			.cs-item {
				padding: 6px 10px;
				cursor: pointer;
			}

			.cs-item:hover {
				background: #f5f5f5;
			}

			.cs-item.is-selected {
				background: #e9ecef;
				font-weight: 600;
			}

			.cs-item.is-disabled {
				color: #999;
			}

			/* ëª¨ë°”ì¼: í™”ë©´í­ì— ë§ì¶° ìë™ ì¶•ì†Œ */
			@media (max-width:768px) {
				.cs {
					--cs-menu-w: min(92vw, 520px);
				}
			}


			.scent-kv {
				margin: 40px 0
			}

			.kv-title {
				font-size: 1.25rem;
				font-weight: 700;
				margin-bottom: 14px
			}

			.scent-kv .kv-item {
				display: grid;
				grid-template-columns: 120px 1fr;
				gap: 16px;
				padding: 14px 0;
				border-top: 1px solid var(--hair)
			}

			.scent-kv .kv-item:last-child {
				border-bottom: 1px solid var(--hair)
			}

			.scent-kv dt {
				color: var(--mute);
				letter-spacing: .02em
			}

			.scent-kv dd {
				margin: 0;
				color: var(--ink);
				line-height: 1.7
			}

			.note-pill {
				display: inline-block;
				min-width: 44px;
				text-align: center;
				padding: 2px 8px;
				margin-right: 8px;
				border: 1px solid var(--hair);
				border-radius: 999px;
				font-size: .85rem;
				color: #333;
				background: #fafafa
			}

			.note-rows>div {
				margin: .2rem 0
			}

			.desc-clamp {
				display: -webkit-box;
				-webkit-line-clamp: 3;
				-webkit-box-orient: vertical;
				overflow: hidden;
				white-space: pre-line
			}

			.scent-kv .note-rows .note-pill {
				min-width: 0;
				/* â† ì´ ì¤„ì´ í•µì‹¬ */
				width: 56px;
				/* ë¼ë²¨ ê³ ì •í­ */
				text-align: center;
				margin-right: 8px;
			}

			@media (max-width:768px) {
				.scent-kv .kv-item {
					grid-template-columns: 92px 1fr
				}
			}

			.productContentsWrap {
				max-width: 1000px;
				margin-inline: auto;
			}

			.productInfoWrap {
				max-width: 1000px;
				margin-inline: auto;
			}

			.productTabWrap {
				max-width: 1000px;
				margin-inline: auto;
			}

			/* ===== í–¥ ì†Œê°œ Aì•ˆ (guideHtml ê·¸ëŒ€ë¡œ ì‚¬ìš©) ===== */
			.scent-guide {
				margin: 40px 0;
			}

			/* ì œëª© ë¼ì¸ + ì–‡ì€ ë°” */
			.scent-guide .sg-title {
				font-size: 1.5rem;
				font-weight: 700;
				color: #111;
				margin: 0 0 5px;
			}

			.scent-guide .sg-title::after {
				content: "";
				display: block;
				width: 70px;
				height: 4px;
				background: #111;
				margin-top: 10px;
			}

			/* ì²« ë¬¸ë‹¨ì„ ë¦¬ë“œë¡œ */
			.scent-guide .sg-body>p:first-of-type {
				color: #4a5568;
				line-height: 1.85;
				font-size: 1.05rem;
				margin: 12px 0 18px;
			}

			/* guideHtml ë‚´ë¶€ ë¦¬ìŠ¤íŠ¸ ê³µí†µ ê¾¸ë¯¸ê¸° */
			.scent-guide .sg-body ul {
				list-style: none;
				padding-left: 10px;
				margin: 12px 0 0;
			}

			.scent-guide .sg-body ul>li {
				position: relative;
				padding-left: 1.2rem;
				margin: .45rem 0;
				line-height: 1.7;
				color: #2d3748;
			}

			.scent-guide .sg-body ul>li::before {
				content: "";
				position: absolute;
				left: 0;
				top: .78em;
				width: 6px;
				height: 6px;
				border-radius: 999px;
				background: #111;
			}

			/* ===== AI ì¶”ì²œ - ë¦¬ë³¸í˜• (ê°œì„ ) ===== */
			/* === AI ì¶”ì²œ(ìˆ˜ì§ ë ˆì´ì•„ì›ƒ) ì •ë¦¬ === */
			.ai-vert {
				margin-top: 18px;
			}

			/* íƒ€ì´í‹€ í¬ê¸°/ìœ„ê³„ ê°•í™” */
			.ai-head {
				display: flex;
				align-items: baseline;
				gap: 12px;
				margin-bottom: 12px;
			}

			.ai-head .title {
				font-weight: 800;
				font-size: 1.5rem;
				line-height: 1.2;
			}

			/* â¬… í¬ê²Œ */
			.ai-head .hint {
				color: #6b7280;
				font-size: .95rem;
			}

			.ai-row {
				display: grid;
				grid-template-columns: 1fr 1fr auto;
				gap: 10px;
				align-items: end;
			}

			.ai-row .form-label {
				display: block;
				margin-bottom: 6px;
				font-weight: 600;
				font-size: .9rem;
				color: #111;
			}

			.ai-row .form-select {
				height: 42px;
				border-radius: 10px;
			}

			.ai-row .btn-cta {
				height: 42px;
				padding-inline: 18px;
			}

			.ai-summary {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin: 14px 2px 8px;
			}

			/* ì¹© ë¦¬ë””ìì¸: [ë¼ë²¨] ê°’  */
			.ai-chips {
				display: flex;
				gap: 8px;
				flex-wrap: wrap;
			}

			.ai-chip {
				display: inline-flex;
				align-items: center;
				gap: 6px;
				padding: 6px 10px;
				border: 1px solid #e5e7eb;
				border-radius: 999px;
				background: #f8fafc;
				font-size: .88rem;
			}

			.ai-chip .k {
				color: #6b7280;
				font-weight: 700;
				font-size: .78rem;
				letter-spacing: .02em;
			}

			.ai-chip .v {
				color: #111;
				font-weight: 700;
				font-size: 16px;
			}

			/* ì„ íƒì¹©(ì„±ë³„/ë‚˜ì´ëŒ€)ì€ ì‚´ì§ ê°•ì¡° */
			.ai-chip--sel {
				background: #eceff1;
			}

			/* ê³ ì • ë©”íƒ€ì¹©(ë¶€í–¥ë¥ /ë©”ì¸ë…¸íŠ¸)ì€ ë‹´ë°±í•˜ê²Œ */
			.ai-chip--meta {
				background: #eceff1;
			}

			/* ëª¨ë°”ì¼ ëŒ€ì‘(ê¸°ì¡´ ê·¸ëŒ€ë¡œ) */
			@media (max-width:768px) {
				.ai-head .title {
					font-size: 1.25rem;
				}
			}

			.ai-reset {
				border: 0;
				background: none;
				color: #6b7280;
				text-decoration: underline;
				font-size: .9rem;
			}

			.ai-result {
				border: 1px solid #e5e7eb;
				border-radius: 12px;
				background: #fff;
				padding: 16px 18px;
				white-space: pre-line;
				line-height: 1.85;
				font-size: 1.02rem;
			}

			.ai-skel {
				height: 12px;
				margin: 6px 0;
				border-radius: 6px;
				background: #e5e7eb;
				overflow: hidden;
			}

			.ai-skel::after {
				content: "";
				display: block;
				height: 100%;
				transform: translateX(-100%);
				background: linear-gradient(90deg, transparent, rgba(255, 255, 255, .55), transparent);
				animation: aiSk 1.1s infinite;
			}

			@keyframes aiSk {
				to {
					transform: translateX(100%);
				}
			}

			@media (max-width: 768px) {
				.ai-row {
					grid-template-columns: 1fr;
				}

				.ai-row .btn-cta {
					width: 100%;
				}

				.ai-summary {
					align-items: flex-start;
					gap: 10px;
				}
			}

			/* ë„“ì´ ë³€ìˆ˜: ë“œë¡­ë‹¤ìš´ í­ ê¸¸~ê²Œ (ì›í•˜ë©´ ìˆ˜ì¹˜ë§Œ ë°”ê¾¸ë©´ ë¨) */
			.cs {
				--cs-menu-w: clamp(420px, 56vw, 640px) !important;
			}

			@media (max-width:768px) {
				.cs {
					--cs-menu-w: min(92vw, 520px) !important;
				}
			}

			/* AI í–‰: ì ì ˆí•œ ìµœì†Œí­ê³¼ gap */
			.ai-row {
				grid-template-columns: minmax(220px, 1fr) minmax(220px, 1fr) auto;
				gap: 12px;
			}

			/* ====== AI ê°€ì´ë“œ ë“œë¡­ë‹¤ìš´ ë°˜ì‘í˜• ë³´ê°• ====== */

			/* ê¸°ë³¸: ì»¨í…Œì´ë„ˆì— ê½‰ ì°¨ê²Œ, ìµœëŒ€í­ë§Œ ì œí•œ */
			.ai-vert .cs {
				width: 100%;
				max-width: 560px;
				/* ë°ìŠ¤í¬í†±ì—ì„œ ë„ˆë¬´ ê¸¸ì–´ì§€ì§€ ì•Šê²Œ ìƒí•œì„  */
			}

			/* ë©”ë‰´ëŠ” ë¶€ëª¨ í­ì„ ë”°ë¼ê°€ë˜, ë„˜ì¹  ê²½ìš° ìŠ¤í¬ë¡¤ */
			.ai-vert .cs-menu {
				left: 0;
				right: 0;
				max-width: 100%;
				max-height: 260px;
				overflow-y: auto;
				z-index: 1000;
			}

			/* ê·¸ë¦¬ë“œ í•œ ì¤„ì¼ ë•Œ(dropdown 2ê°œ+ë²„íŠ¼) ê°„ê²© í™•ë³´ */
			.ai-vert .ai-row {
				grid-template-columns: minmax(220px, 1fr) minmax(220px, 1fr) auto;
				gap: 12px;
			}

			/* â”€â”€ ë¸Œë ˆì´í¬í¬ì¸íŠ¸: íƒœë¸”ë¦¿ ì´í•˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
			@media (max-width: 992px) {
				.ai-vert .cs {
					max-width: 480px;
				}
			}

			/* â”€â”€ ëª¨ë°”ì¼(ì‘ì€ í™”ë©´/ì‘ì€ ì°½) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
			@media (max-width: 768px) {

				/* í–‰ì„ ì„¸ë¡œ ìŠ¤íƒ */
				.ai-vert .ai-row {
					grid-template-columns: 1fr;
					gap: 10px;
				}

				/* ë“œë¡­ë‹¤ìš´/ë©”ë‰´ëŠ” ì¹´ë“œ í­ì— ë§ì¶° 100% */
				.ai-vert .cs {
					max-width: none;
					width: 100%;
				}

				/* ë©”ë‰´ í­: í™”ë©´ ê¸°ì¤€ 92vwë¡œ ì•ˆì „í•˜ê²Œ (ì¢Œìš° 4vw ì—¬ë°±) */
				.ai-vert .cs-menu {
					width: 92vw;
					left: 4vw;
					right: 4vw;
				}

				/* ë²„íŠ¼ì€ ì „ì²´í­ */
				.ai-vert .btn-cta {
					width: 100%;
				}
			}

			/* ì´ˆì†Œí˜• í™”ë©´(â‰¤ 420px)ì—ì„œ ìµœì†Œ í­ ê°•ì œ ê¸ˆì§€ */
			@media (max-width: 420px) {
				.ai-vert .cs {
					max-width: none;
				}

				.ai-vert .cs-menu {
					width: 94vw;
					left: 3vw;
					right: 3vw;
				}
			}

			/* ë¦¬ë·° ì •ë ¬ ë“œë¡­ë‹¤ìš´ë§Œ ë” ì§§ê²Œ */
			#cs-reviewSort.cs {
				width: 140px;
			}

			#cs-reviewSort .cs-btn {
				padding: 6px 10px;
			}
		</style>
	</th:block>
</head>

<body>
	<div layout:fragment="content">
		<div class="productInfoWrap">
			<!-- ì¢Œì¸¡ì˜ í–¥ìˆ˜ ì´ë¯¸ì§€ -->
			<div class="slideWrap" th:classappend="${product.count == 0} ? ' soldout'">
				<img th:src="@{|${product.imgPath}${product.imgName}|}" alt="ìƒí’ˆ ì´ë¯¸ì§€">
				<div class="overlay" aria-hidden="true"></div>
			</div>

			<!-- ìš°ì¸¡ ìƒí’ˆ ì •ë³´ -->
			<div class="productInfo">
				<div id="product-detail">
					<div class="mb-3 py-3 border-bottom pd-head">
						<div class="brand-row bm-wrap">
							<a class="brand-link" th:href="@{|/main/brand/${product.brand.id}|}">
								<span th:text="${product.brand.brandName}"></span>
							</a>
							<button type="button" class="bm-btn" th:attr="aria-pressed=${zzimedByMe} ? 'true' : 'false',
                data-logged-in=${loggedIn}" th:title="${zzimedByMe} ? 'ê´€ì‹¬ í•´ì œ' : 'ê´€ì‹¬ ë“±ë¡'">
								<svg class="bm-icon" viewBox="0 0 24 24" aria-hidden="true">
									<!-- â†“ í”í•œ ë¶ë§ˆí¬ ì‹¤ë£¨ì—£(ì•„ë˜ê°€ ë¾°ì¡±) -->
									<path class="bm-shape" d="M6 3h12a1 1 0 0 1 1 1v16l-7-4-7 4V4a1 1 0 0 1 1-1z" />
								</svg>
							</button>
						</div>
						<div>
							<strong class="title" th:text="${product.name}"></strong>
						</div>

						<div class="mb-3 pt-3 price-area">
							<div>
								<strong class="rate"
									th:text="${#numbers.formatDecimal(T(java.lang.Math).floor(product.discount), 0, 0)} + '%'"></strong>
								<span class="sale"
									th:text="${#numbers.formatInteger(product.sellPrice, 3,'COMMA')} + 'ì›'"></span>
							</div>
							<div>
								<del class="list" th:if="${product.price > product.sellPrice}"
									th:text="${#numbers.formatInteger(product.price, 3,'COMMA')} + 'ì›'"></del>
							</div>
						</div>
					</div>

					<div class="mb-3 pb-3 border-bottom">
						<div>ë°°ì†¡ ì •ë³´</div>
						<div>
							<h5>ë°°ì†¡ë¹„ 3,000 ì›</h5>
						</div>
						<div>
							<h5>ì˜ˆìƒ ë°°ì†¡ì¼ 3 ì¼</h5>
						</div>
					</div>

					<div class="my-3 py-3">
						<div class="mb-3">êµ¬ë§¤ í™•ì • ì‹œ, ê²°ì œê¸ˆì•¡ì˜ 5% ì ë¦½</div>
						<form id="buy-form" method="post">
							<input type="hidden" name="id" th:value="${product.id}">

							<!-- ìˆ˜ëŸ‰ / í•©ê³„ ì˜ì—­ -->
							<div class="d-flex align-items-center gap-2" id="buy-qty-wrap">
								<button type="button" class="btn btn-outline-secondary btn-sm btn-minus">-</button>

								<!-- ìˆ˜ëŸ‰ ì…ë ¥: min=1, max=ì¬ê³  -->
								<input type="number" class="form-control text-center qty-input" style="width:80px;"
									name="quantity" th:attr="max=${product.count}" min="1" value="1">

								<button type="button" class="btn btn-outline-secondary btn-sm btn-plus">+</button>

								<div class="ms-3">
									<div class="fw-semibold">í•©ê³„: <span class="total-amount">0</span> ì›</div>
									<div class="text-muted small">ì ë¦½ ì˜ˆì •(5%): <span class="reward-amount">0</span> P
									</div>
								</div>
							</div>
							<!-- ìˆ˜ëŸ‰ / í•©ê³„ ë -->

							<!-- ì¬ê³  ì œí•œ ì•ˆë‚´ -->
							<p id="stockHint" class="stock-hint" aria-live="polite" aria-atomic="true" hidden></p>

							<div class="my-3 d-flex gap-2">
								<!-- ì¥ë°”êµ¬ë‹ˆ: í’ˆì ˆì¼ ë•Œë„ í´ë¦­ ê°€ëŠ¥(ì•Œë¦¼ ìœ ë„ìš©) -->
								<button type="button" class="btn btn-outline-secondary" id="btn-add-cart"
									th:attr="data-oos=${product.count == 0} ? 'true' : 'false'">
									ì¥ë°”êµ¬ë‹ˆ
								</button>

								<!-- ì¬ê³  ìˆì„ ë•Œë§Œ ë°”ë¡œê²°ì œ -->
								<button type="submit" class="btn btn-secondary" formaction="/checkout/order"
									formmethod="post" id="btn-buy-now" th:if="${product.count > 0}">
									ë°”ë¡œ ê²°ì œ
								</button>

								<!-- ì¬ê³  ì—†ì„ ë•Œ ì…ê³  ì•Œë¦¼ -->
								<button type="button" class="btn btn-secondary" id="btn-restock"
									th:if="${product.count == 0}">
									ì…ê³  ì•Œë¦¼ ì‹ ì²­
								</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>

		<!-- ê³µìš© ë¡œê·¸ì¸ ëª¨ë‹¬ -->
		<div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="loginModalTitle">ë¡œê·¸ì¸ í•„ìš”</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ë‹«ê¸°"></button>
					</div>
					<div class="modal-body" id="loginModalBody">
						ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. <br>
						ë¡œê·¸ì¸ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
					</div>
					<div class="modal-footer">
						<button class="btn btn-outline-secondary" data-bs-dismiss="modal">ë‚˜ì¤‘ì— í•˜ê¸°</button>
						<a id="loginModalCta" class="btn btn-secondary" href="/user/login">ë¡œê·¸ì¸í•˜ê¸°</a>
					</div>
				</div>
			</div>
		</div>

		<!-- ì¥ë°”êµ¬ë‹ˆ ëª¨ë‹¬ -->
		<div class="modal fade" id="cartModal" tabindex="-1" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ë‹«ê¸°"></button>
					</div>
					<div class="modal-body">
						<div id="cartModalMsg">ì¥ë°”êµ¬ë‹ˆì— ì œí’ˆì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.</div>
					</div>
					<div class="modal-footer">
						<button class="btn btn-outline-secondary" data-bs-dismiss="modal">ê³„ì† ì‡¼í•‘</button>
						<span sec:authorize="isAuthenticated()">
							<a th:href="@{/cart/list}" class="btn btn-secondary" id="goCartBtn">ì¥ë°”êµ¬ë‹ˆë¡œ ì´ë™</a>
						</span>
						<span sec:authorize="isAnonymous()">
							<a th:href="@{/user/login}" class="btn btn-secondary" id="goCartBtn">ë¡œê·¸ì¸í•˜ê¸°</a>
						</span>
					</div>
				</div>
			</div>
		</div>

		<!-- í’ˆì ˆ ì‹œ ì¥ë°”êµ¬ë‹ˆ í´ë¦­ â†’ ì•Œë¦¼ ìœ ë„ ëª¨ë‹¬ -->
		<div class="modal fade" id="restockPromptModal" tabindex="-1" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">ì…ê³  ì•Œë¦¼</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ë‹«ê¸°"></button>
					</div>
					<div class="modal-body">
						í’ˆì ˆëœ ìƒí’ˆì…ë‹ˆë‹¤.<br>
						ì´ ìƒí’ˆì˜ ì…ê³  ì•Œë¦¼ì„ ì‹ ì²­í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
					</div>
					<div class="modal-footer">
						<button class="btn btn-outline-secondary" data-bs-dismiss="modal">ë‚˜ì¤‘ì— í•˜ê¸°</button>
						<button class="btn btn-secondary" id="btn-restock-confirm">ì…ê³  ì•Œë¦¼ ì‹ ì²­</button>
					</div>
				</div>
			</div>
		</div>

		<!-- ì•Œë¦¼ ì‹ ì²­ ì™„ë£Œ ëª¨ë‹¬ -->
		<div class="modal fade" id="restockDoneModal" tabindex="-1" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">ì…ê³  ì•Œë¦¼</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ë‹«ê¸°"></button>
					</div>
					<div class="modal-body">ì…ê³  ì•Œë¦¼ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.</div>
					<div class="modal-footer">
						<button class="btn btn-secondary" data-bs-dismiss="modal">í™•ì¸</button>
					</div>
				</div>
			</div>
		</div>

		<!-- ì´ë¯¸ ì‹ ì²­ì ì•ˆë‚´ ëª¨ë‹¬ -->
		<div class="modal fade" id="restockAlreadyModal" tabindex="-1" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">ì…ê³  ì•Œë¦¼</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ë‹«ê¸°"></button>
					</div>
					<div class="modal-body">
						ì´ë¯¸ ì•Œë¦¼ ì‹ ì²­ì„ í•˜ì‹  ìƒí’ˆì…ë‹ˆë‹¤.<br>
						ì•Œë¦¼ ì‹ ì²­ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?
					</div>
					<div class="modal-footer">
						<button class="btn btn-outline-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
						<button class="btn btn-danger" id="btn-restock-cancel">ì•Œë¦¼ ì·¨ì†Œ</button>
					</div>
				</div>
			</div>
		</div>

		<!-- [ì‹ ê·œ] ì°œ ë¡œê·¸ì¸ ì•ˆë‚´ ëª¨ë‹¬ -->
		<div class="modal fade" id="zzimLoginModal" tabindex="-1" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">ê´€ì‹¬ë“±ë¡</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ë‹«ê¸°"></button>
					</div>
					<div class="modal-body">ë¡œê·¸ì¸ì´ ë˜ì–´ìˆì§€ ì•ŠìŠµë‹ˆë‹¤. ë¡œê·¸ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</div>
					<div class="modal-footer">
						<button class="btn btn-outline-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
						<a th:href="@{/user/login}" class="btn btn-secondary">ë¡œê·¸ì¸í•˜ê¸°</a>
					</div>
				</div>
			</div>
		</div>

		<!-- ì°œ ë“±ë¡ ì™„ë£Œ ëª¨ë‹¬(ë¬¸êµ¬ ì •ì •) -->
		<div class="modal fade" id="zzimDoneModal" tabindex="-1" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">ê´€ì‹¬ë“±ë¡</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ë‹«ê¸°"></button>
					</div>
					<div class="modal-body">ê´€ì‹¬ë“±ë¡ì´ ë˜ì—ˆìŠµë‹ˆë‹¤.</div>
					<div class="modal-footer">
						<button class="btn btn-secondary" data-bs-dismiss="modal">í™•ì¸</button>
					</div>
				</div>
			</div>
		</div>

		<!-- ì°œ í•´ì œ í™•ì¸ ëª¨ë‹¬(ê¸°ì¡´ ë¬¸êµ¬ ìœ ì§€) -->
		<div class="modal fade" id="zzimConfirmModal" tabindex="-1" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">ê´€ì‹¬ë“±ë¡ í•´ì œ</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ë‹«ê¸°"></button>
					</div>
					<div class="modal-body">
						ì´ë¯¸ ê´€ì‹¬ë“±ë¡ì´ ëœ ìƒí’ˆì…ë‹ˆë‹¤.<br>ê´€ì‹¬ë“±ë¡ì„ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?
					</div>
					<div class="modal-footer">
						<button class="btn btn-outline-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
						<button class="btn btn-danger btn-confirm">í™•ì¸</button>
					</div>
				</div>
			</div>
		</div>

		<!-- ë¹„ë¡œê·¸ì¸ ì „ìš©: ë°”ë¡œê²°ì œ ë¡œê·¸ì¸ ì•ˆë‚´ ëª¨ë‹¬ -->
		<div class="modal fade" id="loginRequiredModal" tabindex="-1" aria-hidden="true" sec:authorize="isAnonymous()">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">ë°”ë¡œê²°ì œ</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ë‹«ê¸°"></button>
					</div>
					<div class="modal-body">ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</div>
					<div class="modal-footer">
						<button class="btn btn-outline-secondary" data-bs-dismiss="modal">ê³„ì† ì‡¼í•‘</button>
						<a th:href="@{/user/login}" class="btn btn-secondary">ë¡œê·¸ì¸í•˜ê¸°</a>
					</div>
				</div>
			</div>
		</div>

		<!-- ê³µìš© ì•ˆë‚´ ëª¨ë‹¬ -->
		<div class="modal fade" id="noticeModal" tabindex="-1" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="noticeModalTitle">ì•ˆë‚´</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ë‹«ê¸°"></button>
					</div>
					<div class="modal-body" id="noticeModalBody">ë©”ì‹œì§€</div>
					<div class="modal-footer">
						<button class="btn btn-secondary" data-bs-dismiss="modal" id="noticeModalOk">í™•ì¸</button>
					</div>
				</div>
			</div>
		</div>

		<!-- ì—¬ê¸°ì— íƒ­ ë„¤ë¹„ê²Œì´ì…˜ì„ ì¶”ê°€ -->
		<nav class="productTabWrap">
			<div class="productTab">
				<button data-target="#product-desc">ìƒí’ˆ ìƒì„¸ì •ë³´</button>
				<button data-target="#buyer-stats">êµ¬ë§¤ì í†µê³„</button>
				<button data-target="#review-section">ë¦¬ë·° <span th:text="${reviewCount}"></span></button>
				<button data-target="#similar-products">ê´€ë ¨ ìƒí’ˆ</button>
			</div>
		</nav>

		<!-- í•˜ë‹¨ì˜ í–¥ ì†Œê°œ -->
		<div class="productContentsWrap">
			<section id="product-desc">
				<div class="my-5">
					<div class="my-5">
						<section class="scent-kv">
							<h2 class="kv-title">í–¥ ì •ë³´</h2>

							<div class="kv-item" th:if="${product.grade != null}">
								<dt>ë¶€í–¥ë¥ </dt>
								<dd th:text="${product.grade.gradeName}">ì˜¤ ë“œ í¼í“¸</dd>
							</div>

							<div class="kv-item" th:if="${product.mainNote != null}">
								<dt>ë©”ì¸ ì–´ì½”ë“œ</dt>
								<dd th:text="${product.mainNote.mainNoteName}">ìš°ë””</dd>
							</div>

							<!-- ì‹±ê¸€/í”¼ë¼ë¯¸ë“œ ìë™ ë¶„ê¸° -->
							<div class="kv-item"
								th:if="${product.singleNote != null or product.topNote != null or product.middleNote != null or product.baseNote != null}">
								<dt>ë©”ì¸ ë…¸íŠ¸</dt>
								<dd>
									<div th:if="${product.singleNote != null}">
										<span class="note-pill">ì‹±ê¸€</span>
										<span th:text="${product.singleNote}">ììŠ¤ë¯¼</span>
									</div>
									<div class="note-rows" th:if="${product.singleNote == null}">
										<div th:if="${product.topNote != null}"><span class="note-pill">íƒ‘</span> <span
												th:text="${product.topNote}"></span></div>
										<div th:if="${product.middleNote != null}"><span class="note-pill">ë¯¸ë“¤</span>
											<span th:text="${product.middleNote}"></span>
										</div>
										<div th:if="${product.baseNote != null}"><span class="note-pill">ë² ì´ìŠ¤</span>
											<span th:text="${product.baseNote}"></span>
										</div>
									</div>
								</dd>
							</div>

							<div class="kv-item" th:if="${product.description != null}">
								<dt>í–¥ ì„¤ëª…</dt>
								<dd>
									<div id="scentDesc" class="desc-clamp" th:text="${product.description}">ì„¤ëª…</div>
								</dd>
							</div>
						</section>
					</div>

					<div class="scent-guide scent-guide--a">
						<h2 class="sg-title">í–¥ ì†Œê°œ</h2>
						<div class="desc sg-body" th:utext="${guideHtml}"></div>
					</div>

					<!-- AI ê°œì¸í™” ì¶”ì²œ - ë¦¬ë³¸í˜• -->
					<div class="card">
						<div class="card-body ai-vert">
							<!-- ìƒë‹¨ íƒ€ì´í‹€ -->
							<div class="ai-head">
								<div class="title">AI ê°€ì´ë“œ</div>
								<div class="hint">ê°„ë‹¨íˆ ì„ íƒí•œ ë’¤ â€œë§ì¶¤ ì¶”ì²œ ë³´ê¸°â€ë¥¼ ëˆ„ë¥´ì„¸ìš”.</div>
							</div>

							<!-- ì„ íƒ í–‰: ë“œë¡­ë‹¤ìš´ 2ê°œ + ë²„íŠ¼(ìš°ì¸¡) -->
							<form id="personaRecommendationForm">
								<div class="ai-row">
									<div>
										<label class="form-label">ì„±ë³„</label>
										<div class="cs" id="cs-gender">
											<button type="button" class="cs-btn" aria-haspopup="listbox"
												aria-expanded="false">ì„ íƒ</button>
											<ul class="cs-menu" role="listbox">
												<!-- <li class="cs-item is-disabled" aria-disabled="true" data-value="">ì„ íƒ</li> -->
												<li class="cs-item" data-value="M">ë‚¨ì„±</li>
												<li class="cs-item" data-value="F">ì—¬ì„±</li>
											</ul>
											<!-- í¼ ì œì¶œìš© -->
											<input type="hidden" id="gender" name="gender" value="">
										</div>
									</div>

									<div>
										<label class="form-label">ë‚˜ì´ëŒ€</label>
										<div class="cs" id="cs-ageGroup">
											<button type="button" class="cs-btn" aria-haspopup="listbox"
												aria-expanded="false">ì„ íƒ</button>
											<ul class="cs-menu" role="listbox">
												<!-- <li class="cs-item is-disabled" aria-disabled="true" data-value="">ì„ íƒ</li> -->
												<li class="cs-item" data-value="10s">10ëŒ€</li>
												<li class="cs-item" data-value="20s">20ëŒ€</li>
												<li class="cs-item" data-value="30s">30ëŒ€</li>
												<li class="cs-item" data-value="40s">40ëŒ€</li>
												<li class="cs-item" data-value="50plus">50ëŒ€ ì´ìƒ</li>
											</ul>
											<!-- í¼ ì œì¶œìš© -->
											<input type="hidden" id="ageGroup" name="ageGroup" value="">
										</div>
									</div>

									<div class="text-end">
										<button type="submit" class="btn btn-dark btn-cta" id="getRecommendationBtn">
											<span class="btn-text">ë§ì¶¤ ì¶”ì²œ ë³´ê¸°</span>
											<span class="spinner-border spinner-border-sm ms-2 d-none"
												role="status"></span>
										</button>
									</div>
								</div>
							</form>

							<!-- ì„ íƒ ìš”ì•½ + ë‹¤ì‹œ ì„ íƒ -->
							<div class="ai-summary d-none" id="aiSummaryRow">
								<div class="ai-chips">
									<!-- â¬‡ JSê°€ ì±„ìš°ëŠ” ì„ íƒì¹© ì»¨í…Œì´ë„ˆ(ì„±ë³„/ë‚˜ì´ëŒ€) -->
									<span id="aiChips"></span>

									<!-- â¬‡ ê³ ì • ë©”íƒ€ì¹©: ì œí’ˆ ì •ë³´ì—ì„œ ë°”ë¡œ ì¶œë ¥ -->
									<span class="ai-chip ai-chip--meta" th:if="${product.grade != null}">
										<span class="k">ë¶€í–¥ë¥ </span>
										<span class="v" th:text="${product.grade.gradeName}">ì˜¤ ë“œ í¼í“¸</span>
									</span>

									<span class="ai-chip ai-chip--meta" th:if="${product.mainNote != null}">
										<span class="k">ë©”ì¸ë…¸íŠ¸</span>
										<span class="v" th:text="${product.mainNote.mainNoteName}">í”Œë¡œë„</span>
									</span>

									<span class="ai-chip ai-chip--meta" th:if="${product.brand != null}">
										<span class="k">ë¸Œëœë“œ</span>
										<span class="v" th:text="${product.brand.brandName}">ë°”ì´ë ˆë„</span>
									</span>
								</div>

								<!-- <button class="ai-reset" id="resetAnalysisBtn" type="button">ë‹¤ì‹œ ì„ íƒ</button> -->
							</div>

							<!-- ê²°ê³¼ -->
							<div id="aiRecommendationResult" class="ai-result d-none"></div>
						</div>
					</div>
				</div>
			</section>

			<section id="buyer-stats">
				<!-- êµ¬ë§¤ì í†µê³„ (ëª…ìˆ˜, ì¸êµ¬í”¼ë¼ë¯¸ë“œ) -->
				<div class="mt-5">
					<div class="d-flex justify-content-between align-items-center mb-3">
						<h2 class="mb-0">êµ¬ë§¤ì í†µê³„</h2>
						<div class="text-muted small">êµ¬ë§¤ì ìˆ˜(ëª…) Â· í™•ì • ìˆ˜ëŸ‰ ì¡´ì¬ ê¸°ì¤€</div>
					</div>

					<div class="card p-3">
						<div class="d-flex justify-content-between small text-muted mb-1">
							<span>WOMAN</span>
							<span>MAN</span>
						</div>
						<div style="height:300px;">
							<canvas id="buyerStatChart" aria-label="ë‚˜ì´/ì„±ë³„ë³„ êµ¬ë§¤ì ìˆ˜ í”¼ë¼ë¯¸ë“œ ì°¨íŠ¸"></canvas>
						</div>
						<div id="buyerStatEmpty" class="text-muted small mt-2" style="display:none;">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
					</div>
				</div>
			</section>

			<section id="review-section">
				<!-- ë¦¬ë·° ì„¹ì…˜ -->
				<div class="mt-5">
					<div class="d-flex justify-content-between align-items-center mb-3">
						<h2 class="mb-0">Review</h2>
					</div>

					<!-- ì ìˆ˜ ë¶„í¬ -->
					<!-- ë¦¬ë·° ìƒë‹¨ ìš”ì•½ (ì¢Œ: í‰ê· /ê°œìˆ˜, ìš°: ë¶„í¬) -->
					<div class="review-head mb-4" th:if="${reviewCount >= 0}">
						<!-- ì¢Œì¸¡ ìš”ì•½ -->
						<div class="summary">
							<!-- â‘  í‰ê·  í‰ì : ê·¸ë¦¼(ë³„/ì‚¬ê°í˜•) í•œ ì¤„ -->
							<div class="rating-bars my-3" th:with="filled=${T(java.lang.Math).round(reviewAvg)}">
								<div th:each="i : ${#numbers.sequence(1,5)}"
									th:class="'cell' + (${i} <= ${filled} ? ' filled' : '')">
								</div>
							</div>
							<!-- â‘¡ í‰ê·  í‰ì : ìˆ«ì í•œ ì¤„ -->
							<span class="avg-number" th:text="${#numbers.formatDecimal(reviewAvg,1,1)}">0.0</span>
							<!-- â‘¢ í›„ê¸° ê°œìˆ˜: ì‘ê²Œ í•œ ì¤„ -->
							<span class="total"> (í›„ê¸° <span th:text="${reviewCount}">0</span>ê°œ)</span>
						</div>

						<!-- ê°€ìš´ë° ì„¸ë¡œ êµ¬ë¶„ì„ ìœ¼ë¡œ ì‹œê°ì  ê²°ì† -->
						<div class="vrule"></div>

						<!-- ìš°ì¸¡: 5~1ì  ë¶„í¬ (í¼ì„¼íŠ¸ ì œê±°, ê°œìˆ˜ë§Œ í‘œì‹œ) -->
						<ul id="ratingDist" class="rating-dist">
							<li th:each="i : ${#numbers.sequence(1,5)}" th:with="s=${6 - i}, cnt=${reviewCounts[s]},
                 share=${reviewCount > 0 ? (cnt * 100.0 / reviewCount) : 0}" th:style="|--cnt:${cnt};|">
								<span class="label" th:text="|${s}ì |">5ì </span>
								<div class="bar" aria-hidden="true">
									<div class="fill"></div>
								</div>
								<span class="value">
									<span class="count" th:text="${cnt}">0</span>
									<span class="pct" th:text="|(${#numbers.formatDecimal(share,0,0)}%)|">(0%)</span>
								</span>
							</li>
						</ul>
					</div>
				</div>

				<hr class="my-4">

				<!-- ì „ì²´ ê°œìˆ˜ + ì •ë ¬ -->
				<div class="d-flex justify-content-between align-items-center mb-3">
					<div class="fw-semibold">ì „ì²´ ë¦¬ë·° <span th:text="${reviewCount}">0</span>ê°œ</div>
					<form method="get" th:action="@{|/main/content/${product.id}|}">
						<!-- ì»¤ìŠ¤í…€ ì…€ë ‰íŠ¸ -->
						<div class="cs" id="cs-reviewSort">
							<button type="button" class="cs-btn" aria-haspopup="listbox" aria-expanded="false"
								th:text="${sort=='best'} ? 'ì¶”ì²œìˆœ' : (${sort=='recent'} ? 'ìµœì‹ ìˆœ' : 'í‰ì ìˆœ')">ì„ íƒ</button>

							<ul class="cs-menu" role="listbox">
								<li class="cs-item" data-value="best" th:classappend="${sort=='best'} ? ' is-selected'">
									ì¶”ì²œìˆœ</li>
								<li class="cs-item" data-value="recent"
									th:classappend="${sort=='recent'} ? ' is-selected'">ìµœì‹ ìˆœ</li>
								<li class="cs-item" data-value="rating"
									th:classappend="${sort=='rating'} ? ' is-selected'">í‰ì ìˆœ</li>
							</ul>

							<!-- í¼ ì œì¶œìš© ê°’ -->
							<input type="hidden" name="sort" id="reviewSortVal" th:value="${sort}">
						</div>
					</form>
				</div>

				<!-- ë¦¬ìŠ¤íŠ¸ -> ì •ë ¬ì„ ìœ„í•´ ë¬¶ìŒ -->
				<div id="reviewList" th:fragment="reviewList(reviews, likedReviewIds, productId, sort)"
					th:with="productId=${productId} ?: ${product?.id}" class="mt-2">

					<div th:if="${#lists.isEmpty(reviews)}" class="text-muted py-4">ì‘ì„±ëœ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>

					<div th:each="rv : ${reviews}" class="py-4 border-top">
						<div class="d-flex align-items-start justify-content-between">
							<!-- ì¢Œì¸¡: ë©”íƒ€ + ë³¸ë¬¸ -->
							<div class="d-flex align-items-start gap-3 flex-grow-1">
								<div class="review-meta">
									<div class="user-mask fw-semibold" th:with="len=${#strings.length(rv.userName)}"
										th:text="${len <= 3} ? ${rv.userName} : ${#strings.substring(rv.userName,0,2)} + ${'*'.repeat(len-2)}">
										kv**
									</div>

									<div class="rating-bars rating-bars--item mt-1" th:with="filled=${rv.rating}">
										<div th:each="i : ${#numbers.sequence(1,5)}"
											th:class="'cell' + (${i} <= ${filled} ? ' filled' : '')">
										</div>
									</div>
								</div>

								<!-- ë³¸ë¬¸ ì˜ì—­ -->
								<div class="flex-grow-1">
									<!-- ë¦¬ë·° -->
									<div class="mb-2 text-break" th:if="${rv.status == 'ACTIVE'}"
										th:text="${rv.content}" style="white-space:pre-line;">ë‚´ìš©</div>

									<!-- ì¢‹ì•„ìš” -->
									<div class="like-wrap" th:attr="data-id=${rv.reviewId}"
										th:classappend="${likedReviewIds.contains(rv.reviewId)} ? ' is-liked'">
										<button type="button" class="btn-like" aria-label="ê³µê°" title="ê³µê°"
											sec:authorize="isAuthenticated()" th:if="${rv.status == 'ACTIVE'}">
											<i class="fa-regular fa-thumbs-up"></i>
										</button>
										<button type="button" class="btn-like need-login" aria-label="ë¡œê·¸ì¸ í•„ìš”"
											sec:authorize="isAnonymous()" th:if="${rv.status == 'ACTIVE'}">
											<i class="fa-regular fa-thumbs-up"></i>
										</button>
										<span class="like-count" th:text="${#lists.size(rv.likers)}"
											th:if="${rv.status == 'ACTIVE'}">0</span>
									</div>
								</div>
							</div>

							<!-- ìš°ì¸¡: ë‚ ì§œ + ì•¡ì…˜(ë‚ ì§œ ë°”ë¡œ ì•„ë˜) â€” ë‚ ì§œ ìœ„ì¹˜ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€ -->
							<div class="review-right ms-3">
								<div class="review-date text-muted small text-nowrap"
									th:text="${#temporals.format(rv.createDate, 'yy/MM/dd HH:mm')}">25/08/22 14:00</div>

								<!-- ë¡œê·¸ì¸ + (ì†Œìœ ì ë˜ëŠ” ê´€ë¦¬ì)ë§Œ ë…¸ì¶œ -->
								<div class="review-actions mt-1" sec:authorize="isAuthenticated()"
									th:with="isOwner=${#authentication.name == rv.userName}">
									<div th:if="${isOwner or #authorization.expression('hasRole(''ADMIN'')')}">
										<a class="ra-link"
											th:href="@{|/main/etc/review/${rv.reviewId}/edit?productId=${productId}|}">ìˆ˜ì •</a>

										<form th:action="@{|/main/etc/review/${rv.reviewId}/delete|}" method="post"
											class="d-inline" onsubmit="return confirm('í›„ê¸°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
											<input type="hidden" name="productId" th:value="${productId}">
											<button type="submit" class="ra-link ra-danger">ì‚­ì œ</button>
										</form>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</section>

			<section id="similar-products" class="mt-5">
				<h2 class="mb-3">ê´€ë ¨ ìƒí’ˆ</h2>

				<!-- ê°™ì€ ë¸Œëœë“œì˜ ë‹¤ë¥¸ ìƒí’ˆ -->
				<div class="mb-5">
					<div class="d-flex justify-content-between align-items-center mb-2">
						<h3 class="h5 mb-0">ê°™ì€ ë¸Œëœë“œì˜ ë‹¤ë¥¸ ìƒí’ˆ</h3>
						<span class="small text-muted">íŒë§¤ëŸ‰ ìˆœ</span>
					</div>

					<!-- ë°ì´í„° ìˆì„ ë•Œ: ìºëŸ¬ì…€ -->
					<div th:if="${brandRecs != null and !#lists.isEmpty(brandRecs)}" class="rec-carousel">
						<button class="rec-nav" type="button" aria-label="ì´ì „"
							th:disabled="${#lists.size(brandRecs) <= 4}" data-bs-target="#brandRecCarousel"
							data-bs-slide="prev">&lsaquo;</button>

						<div class="rec-track">
							<div id="brandRecCarousel" class="carousel slide" data-bs-ride="false"
								aria-label="ê°™ì€ ë¸Œëœë“œ ì¶”ì²œ ìºëŸ¬ì…€" th:with="size=${#lists.size(brandRecs)},
									pages=${(size + 3) / 4}">

								<div class="carousel-inner" th:with="size=${#lists.size(brandRecs)}">
									<div th:each="start : ${#numbers.sequence(0, size - 1, 4)}"
										th:with="endIdx=${T(java.lang.Math).min(start + 3, size - 1)}"
										th:class="'carousel-item' + (${start} == 0 ? ' active' : '')">
										<div class="row g-3">
											<div class="col-6 col-md-3"
												th:each="i : ${#numbers.sequence(start, endIdx)}" th:with="r=${brandRecs[i]}, path=${r[3]}, name=${r[4]},
																	img=${#strings.isEmpty(path) ? name : (path.endsWith('/') ? path + name : path + '/' + name)}">
												<a class="rel-card d-block" th:href="@{|/main/content/${r[0]}|}">
													<div class="rel-thumb ratio ratio-1x1 mb-2"><img th:src="${img}"
															alt="" loading="lazy"></div>
													<div class="rel-brand small text-muted text-truncate"
														th:text="${r[2]}">
														ë¸Œëœë“œëª…</div>
													<div class="rel-title text-truncate" th:text="${r[1]}">ìƒí’ˆëª…</div>
													<br>
													<div class="rel-price text-muted">
														<strong class="sell"
															th:text="${#numbers.formatInteger(r[6],1,'COMMA')} + 'ì›'">0ì›</strong>
														<del class="original" th:if="${r[5] != null && r[5] > r[6]}"
															th:text="${#numbers.formatInteger(r[5],1,'COMMA')} + 'ì›'">0ì›</del>
													</div>
												</a>
											</div>
										</div>
									</div>
								</div>

								<!-- â–¼ ì¸ë””ì¼€ì´í„°: ìŠ¬ë¼ì´ë“œê°€ 2í˜ì´ì§€ ì´ìƒì¼ ë•Œë§Œ ë…¸ì¶œ -->
								<div class="carousel-indicators rec-indicators" th:if="${pages > 1}">
									<button type="button" th:each="p : ${#numbers.sequence(0, pages-1)}"
										th:classappend="${p} == 0 ? ' active' : ''"
										th:attr="data-bs-target='#brandRecCarousel', data-bs-slide-to=${p}, aria-label='í˜ì´ì§€ ' + (${p}+1)">
									</button>
								</div>
							</div>
						</div>

						<button class="rec-nav" type="button" aria-label="ë‹¤ìŒ"
							th:disabled="${#lists.size(brandRecs) <= 4}" data-bs-target="#brandRecCarousel"
							data-bs-slide="next">&rsaquo;</button>
					</div>

					<!-- ë°ì´í„° ì—†ì„ ë•Œ: ì•ˆë‚´ -->
					<div th:if="${brandRecs == null or #lists.isEmpty(brandRecs)}"
						class="text-muted small py-3 text-center border rounded-2">
						ê°™ì€ ë¸Œëœë“œì˜ ì¶”ì²œ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.
					</div>
				</div>

				<!-- ìµœê·¼/ëˆ„ì  ë² ìŠ¤íŠ¸ 8 -->
				<div class="mt-4" th:with="isFallback=${(recentTopIsFallback) ?: false}">
					<div class="d-flex justify-content-between align-items-center mb-2">
						<h3 class="h5 mb-0" th:text="${isFallback} ? 'ëˆ„ì  BEST 8' : 'ì£¼ê°„ BEST 8'">ì£¼ê°„ BEST 8</h3>
						<span class="small text-muted" th:text="${isFallback} ? 'ëˆ„ì  íŒë§¤ëŸ‰ ê¸°ì¤€' : 'ì£¼ê°„ íŒë§¤ëŸ‰ ê¸°ì¤€'">ì£¼ê°„ íŒë§¤ëŸ‰
							ê¸°ì¤€</span>
					</div>

					<!-- ë°ì´í„° ìˆì„ ë•Œ: ìºëŸ¬ì…€ -->
					<div th:if="${recentTop8 != null and !#lists.isEmpty(recentTop8)}" class="rec-carousel">
						<button class="rec-nav" type="button" aria-label="ì´ì „"
							th:disabled="${#lists.size(recentTop8) <= 4}" data-bs-target="#recentTopCarousel"
							data-bs-slide="prev">&lsaquo;</button>

						<div class="rec-track">
							<div id="recentTopCarousel" class="carousel slide" data-bs-ride="false"
								aria-label="ì´ë²ˆ ì£¼ ë² ìŠ¤íŠ¸ ìºëŸ¬ì…€" th:with="size=${#lists.size(recentTop8)},
									pages=${(size + 3) / 4}">

								<div class="carousel-inner" th:with="size=${#lists.size(recentTop8)}">
									<div th:each="start : ${#numbers.sequence(0, size - 1, 4)}"
										th:with="endIdx=${T(java.lang.Math).min(start + 3, size - 1)}"
										th:class="'carousel-item' + (${start} == 0 ? ' active' : '')">
										<div class="row g-3">
											<div class="col-6 col-md-3"
												th:each="i : ${#numbers.sequence(start, endIdx)}" th:with="r=${recentTop8[i]}, path=${r[3]}, name=${r[4]},
																	img=${#strings.isEmpty(path) ? name : (path.endsWith('/') ? path + name : path + '/' + name)}">
												<a class="rel-card d-block" th:href="@{|/main/content/${r[0]}|}">
													<div class="rel-thumb ratio ratio-1x1 mb-2"><img th:src="${img}"
															alt="" loading="lazy"></div>
													<div class="rel-brand small text-muted text-truncate"
														th:text="${r[2]}">
														ë¸Œëœë“œëª…</div>
													<div class="rel-title text-truncate" th:text="${r[1]}">ìƒí’ˆëª…</div>
													<br>
													<div class="rel-price text-muted">
														<strong class="sell"
															th:text="${#numbers.formatInteger(r[6],1,'COMMA')} + 'ì›'">0ì›</strong>
														<del class="original" th:if="${r[5] != null && r[5] > r[6]}"
															th:text="${#numbers.formatInteger(r[5],1,'COMMA')} + 'ì›'">0ì›</del>
													</div>
												</a>
											</div>
										</div>
									</div>
								</div>

								<!-- â–¼ ì¸ë””ì¼€ì´í„° -->
								<div class="carousel-indicators rec-indicators" th:if="${pages > 1}">
									<button type="button" th:each="p : ${#numbers.sequence(0, pages-1)}"
										th:classappend="${p} == 0 ? ' active' : ''"
										th:attr="data-bs-target='#recentTopCarousel', data-bs-slide-to=${p}, aria-label='í˜ì´ì§€ ' + (${p}+1)">
									</button>
								</div>
							</div>
						</div>

						<button class="rec-nav" type="button" aria-label="ë‹¤ìŒ"
							th:disabled="${#lists.size(recentTop8) <= 4}" data-bs-target="#recentTopCarousel"
							data-bs-slide="next">&rsaquo;</button>
					</div>

					<!-- ë°ì´í„° ì—†ì„ ë•Œ: ì•ˆë‚´ -->
					<div th:if="${recentTop8 == null or #lists.isEmpty(recentTop8)}"
						class="text-muted small py-3 text-center border rounded-2">
						ìµœê·¼ 7ì¼ íŒë§¤ ë°ì´í„°ê°€ ì—†ì–´ í‘œì‹œí•  ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.
					</div>
				</div>
			</section>
		</div> <!-- productContentsWrap ë -->
	</div>

	<!-- ìŠ¤í¬ë¦½íŠ¸ -->
	<th:block layout:fragment="script">
		<script th:inline="javascript">
			// === CSRF: ë©”íƒ€ íƒœê·¸ ë˜ëŠ” Thymeleaf ì¸ë¼ì¸ ê°’ ë‘˜ ë‹¤ ì§€ì› ===
			function getCsrfPair() {
				const metaToken = document.querySelector('meta[name="_csrf"]')?.getAttribute('content');
				const metaHeader = document.querySelector('meta[name="_csrf_header"]')?.getAttribute('content');
				const inlineHeader = /*[[${_csrf?.headerName}]]*/ 'X-CSRF-TOKEN';
				const inlineToken = /*[[${_csrf?.token}]]*/ '';
				return {
					header: metaHeader || inlineHeader || 'X-CSRF-TOKEN',
					token: metaToken || inlineToken || ''
				};
			}

			// ê°„ë‹¨ ì•ˆë‚´ ëª¨ë‹¬ ì—´ê¸°
			function showNoticeModal({ title = 'ì•ˆë‚´', message = '' } = {}) {
				const el = document.getElementById('noticeModal');
				if (!el || typeof bootstrap === 'undefined') {
					// ë¶€íŠ¸ìŠ¤íŠ¸ë© ë¡œë”©ì´ ì•ˆ ëœ ë¹„ìƒ ìƒí™© í´ë°±
					window.alert((title ? `[${title}] ` : '') + (message || ''));
					return;
				}
				document.getElementById('noticeModalTitle').textContent = title;
				document.getElementById('noticeModalBody').innerHTML = message; // ì¤„ë°”ê¿ˆ/êµµê²Œ í—ˆìš©
				const modal = new bootstrap.Modal(el);
				modal.show();
				return modal;
			}

			// ê³µìš© ë¡œê·¸ì¸ ëª¨ë‹¬ ì˜¤í”ˆ í—¬í¼
			function showLoginModal({
				title = 'ë¡œê·¸ì¸ í•„ìš”',
				message = 'ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.',
				redirectTo = (location.pathname + location.search)
			} = {}) {
				const el = document.getElementById('loginModal');
				// í´ë°±: ëª¨ë‹¬ì´ ì—†ê±°ë‚˜ bootstrap ë¯¸ë¡œë”© ì‹œ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ
				if (!el || typeof bootstrap === 'undefined') {
					const url = new URL('/user/login', location.origin);
					url.searchParams.set('redirect', redirectTo);
					location.href = url.pathname + url.search;
					return;
				}
				document.getElementById('loginModalTitle').textContent = title;
				// ì¤„ë°”ê¿ˆ í—ˆìš©
				document.getElementById('loginModalBody').innerHTML = message;

				const cta = document.getElementById('loginModalCta');
				const url = new URL('/user/login', location.origin);
				url.searchParams.set('redirect', redirectTo);
				cta.setAttribute('href', url.pathname + url.search);

				new bootstrap.Modal(el).show();
			}

			// Bootstrap Modal ì¤€ë¹„
			const cartModalEl = document.getElementById('cartModal');
			const cartModal = cartModalEl ? new bootstrap.Modal(cartModalEl) : null;

			// ê³µí†µ DOM
			const btnAddCart = document.getElementById('btn-add-cart');
			const buyForm = document.getElementById('buy-form');
			const qtyInput = document.querySelector('.qty-input');
			const msgBox = document.getElementById('cartModalMsg');
			const badgeEl = document.getElementById('cart-count');

			// ìƒí’ˆ ì •ë³´(í…œí”Œë¦¿ ê°’ ì£¼ì…)
			const PRODUCT_ID = /*[[${product.id}]]*/ 0;
			const PRODUCT_NAME = /*[[${product.name}]]*/ '';
			const MAX_STOCK = parseInt(qtyInput?.getAttribute('max') || '0', 10);

			// ë¡œê·¸ì¸ ìƒíƒœ(ì„œë²„ì—ì„œ true/falseë¡œ ë Œë”ë¨)
			const LOGGED_IN = /*[[${#authorization.expression('isAuthenticated()')}]]*/ false;

			// ë”ë¸”í´ë¦­ ë°©ì§€
			function withButtonLock(btn, fn) {
				if (!btn || btn.disabled) return;
				btn.disabled = true;
				Promise.resolve(fn()).finally(() => setTimeout(() => btn.disabled = false, 800));
			}

			// ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€
			btnAddCart?.addEventListener('click', () => withButtonLock(btnAddCart, async () => {

				// â¬‡ï¸ ì¶”ê°€: í’ˆì ˆì´ë©´ /cart/add í˜¸ì¶œ ëŒ€ì‹  ì•Œë¦¼ ìœ ë„ ëª¨ë‹¬
				const isOOS = (MAX_STOCK <= 0) || btnAddCart.getAttribute('data-oos') === 'true';
				if (isOOS) {
					if (!LOGGED_IN) {
						// ê³µìš© ë¡œê·¸ì¸ ëª¨ë‹¬ ì‚¬ìš©
						showLoginModal({
							title: 'ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°',
							message: 'ì¥ë°”êµ¬ë‹ˆëŠ” ë¡œê·¸ì¸ í›„ ì‚¬ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
						});
					} else {
						// ë¡œê·¸ì¸ â†’ ì…ê³  ì•Œë¦¼ ìœ ë„ ëª¨ë‹¬ ìœ ì§€
						const promptEl = document.getElementById('restockPromptModal');
						if (promptEl && typeof bootstrap !== 'undefined') new bootstrap.Modal(promptEl).show();
					}
					return;
				}

				let qty = parseInt(qtyInput.value, 10);
				if (isNaN(qty) || qty < 1) qty = 1;
				if (MAX_STOCK > 0) qty = Math.min(qty, MAX_STOCK);

				// 1) ì‚¬ì „ ì¹´ìš´íŠ¸ ì²´í¬ (UX)
				try {
					const cRes = await fetch('/cart/count', { credentials: 'same-origin' });
					const cData = await cRes.json().catch(() => ({}));
					if (Number(cData.count) >= 20) {
						if (msgBox) msgBox.textContent = 'ì¥ë°”êµ¬ë‹ˆì— ë‹´ì„ ìˆ˜ ìˆëŠ” ìµœëŒ€ ìˆ˜ëŸ‰ì€ 20ê°œ ì…ë‹ˆë‹¤.';
						cartModal?.show();
						return;
					}
				} catch (_) {
					// ì‚¬ì „ ì²´í¬ ì‹¤íŒ¨í•´ë„ /cart/add ë‹¨ê³„ì—ì„œ ë‹¤ì‹œ ë§‰í˜
				}

				try {
					const res = await fetch('/cart/add', {
						method: 'POST',
						headers: { 'Content-Type': 'application/json' },
						credentials: 'same-origin',
						body: JSON.stringify({ productId: PRODUCT_ID, qty })        // /cart/add ë¼ëŠ” URI ë¥¼ ìš”ì²­í•  ë•Œ, product ì˜ id ê°’ê³¼ ì„ íƒí•œ ìˆ˜ëŸ‰(qty)ì„ POST ë°©ì‹ìœ¼ë¡œ ì „ì†¡
					});

					const data = await res.json().catch(() => ({}));

					if (res.ok) {
						if (badgeEl && typeof data.count === 'number') {
							badgeEl.textContent = String(data.count);
						}
						if (msgBox) msgBox.textContent = `â€œ${PRODUCT_NAME}â€ ${qty}ê°œê°€ ì¥ë°”êµ¬ë‹ˆì— ë‹´ê²¼ìŠµë‹ˆë‹¤.`;
						cartModal?.show();
					} else {
						if (msgBox) msgBox.textContent = (data && data.message) ? data.message : 'ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
						cartModal?.show();
					}
				} catch (e) {
					if (msgBox) msgBox.textContent = 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
					cartModal?.show();
				}
			}));

			// ë°”ë¡œê²°ì œ ë”ë¸”í´ë¦­ ë°©ì§€
			document.getElementById('buy-form')?.addEventListener('submit', (e) => {
				const btn = e.submitter;
				if (!btn) return;
				btn.disabled = true;
				setTimeout(() => btn.disabled = false, 2000);
			});

			// ë¹„ë¡œê·¸ì¸ì¼ ë•Œ buy-form ì œì¶œ ë§‰ê³  ëª¨ë‹¬ ì˜¤í”ˆ
		</script>

		<script sec:authorize="isAnonymous()">
			(function () {
				const form = document.getElementById('buy-form');
				const modalEl = document.getElementById('loginRequiredModal');
				if (!form || !modalEl || typeof bootstrap === 'undefined') return;
				const modal = new bootstrap.Modal(modalEl);

				form.addEventListener('submit', function (e) {
					e.preventDefault();
					const btn = e.submitter;
					if (btn) { btn.disabled = true; setTimeout(() => btn.disabled = false, 1200); }
					modal.show();
				});
			})();
		</script>

		<script th:inline="javascript">
			// ìˆ˜ëŸ‰/í•©ê³„ ê³„ì‚° (ì…ë ¥ UX ê°œì„ íŒ)
			document.querySelectorAll('#buy-qty-wrap').forEach(container => {
				const minusBtn = container.querySelector('.btn-minus');
				const plusBtn = container.querySelector('.btn-plus');
				const input = container.querySelector('.qty-input');
				const totalEl = container.querySelector('.total-amount');
				const rewardEl = container.querySelector('.reward-amount');

				const MIN = parseInt(input.getAttribute('min')) || 1;
				const MAX = parseInt(input.getAttribute('max')) || 0; // ì¬ê³ 
				const SELLPRICE = /*[[${product.sellPrice}]]*/ 0;
				const RATE = 0.05;
				const fmt = n => Number(n || 0).toLocaleString('ko-KR');

				const hintEl = document.getElementById('stockHint');
				let hintTimer = null;

				function showMaxHint(max) {
					if (!hintEl) return;
					const n = Number(max || 0).toLocaleString('ko-KR');
					hintEl.textContent = `í˜„ì¬ ì¬ê³ ê°€ ${n}ê°œ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì— ìˆ˜ëŸ‰ì´ ${n}ê°œë¡œ ì œí•œë©ë‹ˆë‹¤.`;
					hintEl.hidden = false;
					hintEl.dataset.pop = '1';
					// clearTimeout(hintTimer);
					// hintTimer = setTimeout(() => {
					// 	hintEl.hidden = true;
					// 	delete hintEl.dataset.pop;
					// }, 3000);
				}

				function hideMaxHint() {
					if (!hintEl) return;
					hintEl.hidden = true;
					delete hintEl.dataset.pop;
				}

				function clamp(v) {
					if (isNaN(v)) v = MIN;
					v = Math.floor(v);
					if (v < MIN) v = MIN;
					if (MAX > 0 && v > MAX) v = MAX;
					return v;
				}

				function recalcAndRender(qty) {
					const total = SELLPRICE * qty;
					const point = Math.floor(total * RATE);
					totalEl.textContent = fmt(total);
					rewardEl.textContent = fmt(point);
				}

				function applyDisabledByStock() {
					if (MAX < 1) {
						input.value = 0;
						input.disabled = true;
						minusBtn.disabled = true;
						plusBtn.disabled = true;
						document.getElementById('btn-buy-now')?.setAttribute('disabled', 'true');
						document.getElementById('btn-add-cart')?.removeAttribute('disabled');
						recalcAndRender(0);
						return true;
					}
					document.getElementById('btn-buy-now')?.removeAttribute('disabled');
					document.getElementById('btn-add-cart')?.removeAttribute('disabled');
					return false;
				}

				// â–¼ ì´ˆê¸° ìƒíƒœ ë°˜ì˜
				if (!applyDisabledByStock()) {
					const init = clamp(parseInt(input.value, 10) || MIN);
					input.value = init;
					minusBtn.disabled = (init <= MIN);
					plusBtn.disabled = (init >= MAX && MAX > 0);
					recalcAndRender(init);
				}

				// í¬ì»¤ìŠ¤ë˜ë©´ ì»¤ì„œë¥¼ ë§¨ ëìœ¼ë¡œë§Œ ì´ë™(ì „ì²´ì„ íƒ ê¸ˆì§€)
				input.addEventListener('focus', () => {
					const L = input.value.length;
					input.setSelectionRange?.(L, L);
				});

				// ====== ì…ë ¥ ì¦‰ì‹œ ì œí•œ + '1' ë®ì–´ì“°ê¸° ê·œì¹™ ìˆ˜ì • ======
				const ENFORCE_ON_INPUT = true;

				// ë‹¤ìŒ ê°’ ì‹œë®¬ë ˆì´ì…˜
				function nextNumericValue(current, insert, start, end) {
					return (current.slice(0, start) + insert + current.slice(end)).replace(/\D+/g, '');
				}

				// 1) beforeinput: ë‹¤ìŒ ê°’ ë¯¸ë¦¬ ê³„ì‚°í•´ ì œì–´
				input.addEventListener('beforeinput', (e) => {
					const t = e.inputType;
					const inserting =
						t === 'insertText' ||
						t === 'insertCompositionText' ||
						t === 'insertFromPaste' ||
						t === 'insertFromDrop';
					if (!inserting) return;

					// ì…ë ¥ë  í…ìŠ¤íŠ¸
					let ins = e.data ?? '';
					if (t === 'insertFromPaste' && e.clipboardData) {
						ins = e.clipboardData.getData('text') ?? '';
					}
					// ìˆ«ìë§Œ í—ˆìš©
					if (!/^\d*$/.test(ins)) { e.preventDefault(); return; }

					const start = input.selectionStart ?? 0;
					const end = input.selectionEnd ?? input.value.length;

					// â˜… ì¦‰ì‹œ MAX ì œí•œ: ì´ˆê³¼ ì…ë ¥ ìì²´ ì°¨ë‹¨ + ë°”ë¡œ MAXë¡œ ë³´ì •
					if (ENFORCE_ON_INPUT) {
						const next = nextNumericValue(input.value, ins, start, end);
						if (next !== '' && MAX > 0 && parseInt(next, 10) > MAX) {
							e.preventDefault();
							input.value = String(MAX);
							recalcAndRender(MAX);
							showMaxHint(MAX);
							const L = input.value.length; input.setSelectionRange?.(L, L);
						}
					}
				});

				// 2) input: ìˆ«ìë§Œ ìœ ì§€ + ì¦‰ì‹œ MAX ë³´ì •, MIN ë³´ì •ì€ blurì—ì„œ
				input.addEventListener('input', function () {
					// ìˆ«ì ì™¸ ì œê±°
					let only = this.value.replace(/\D+/g, '');

					// ì„ í–‰ 0 ì œê±° (ëª¨ë‘ 0ì´ë©´ ''ê°€ ë¨)
					if (only.length > 1) {
						only = only.replace(/^0+/, '');
					}
					// í¸ì§‘ ì¤‘ì—” ë¹ˆê°’ í—ˆìš©
					this.value = only;

					// í¸ì§‘ ì¤‘(ë¹ˆê°’/0)ì—ëŠ” ê³„ì‚°ë§Œ 0ìœ¼ë¡œ, MIN ë³´ì •ì€ blurì—ì„œ ì²˜ë¦¬
					if (only === '' || only === '0') {
						recalcAndRender(0);
						// ë²„íŠ¼ ìƒíƒœ: minus ë¹„í™œì„±, plusëŠ” ì¬ê³  ìˆìœ¼ë©´ í™œì„±
						minusBtn.disabled = true;
						plusBtn.disabled = (MAX > 0 ? false : true);
						// ì¬ê³  ì•ˆë‚´ ìˆ¨ê¹€
						if (hintEl) { hintEl.hidden = true; delete hintEl.dataset.pop; }
						return;
					}

					// ìˆ«ì í™•ì •
					let num = parseInt(only, 10);

					// MAXëŠ” ì…ë ¥ ìˆœê°„ ì¦‰ì‹œ ë³´ì •
					if (ENFORCE_ON_INPUT && MAX > 0 && num > MAX) {
						num = MAX;
						this.value = String(num);
						showMaxHint(MAX);
					}

					recalcAndRender(num);
					minusBtn.disabled = (num <= MIN);
					plusBtn.disabled = (MAX > 0) ? (num >= MAX) : false;

					if (MAX > 0 && num === MAX) {
						showMaxHint(MAX);
					} else {
						// MAXê°€ ì•„ë‹ˆë©´ ìˆ¨ê¹€
						if (hintEl) { hintEl.hidden = true; delete hintEl.dataset.pop; }
					}
				});

				// --- blur: ì—¬ê¸°ì„œë§Œ ìµœì¢… í´ë¨í”„/ì •ê·œí™” ---
				input.addEventListener('blur', function () {
					let v = parseInt(this.value, 10);
					if (isNaN(v)) v = MIN;
					const c = clamp(v);

					this.value = c;
					recalcAndRender(c);
					minusBtn.disabled = (c <= MIN);
					plusBtn.disabled = (MAX > 0) ? (c >= MAX) : false;

					// MAXë©´ í‘œì‹œ, ì•„ë‹ˆë©´ ìˆ¨ê¹€
					if (MAX > 0 && c === MAX) showMaxHint(MAX);
					else hideMaxHint();
				});

				minusBtn.addEventListener('click', function () {
					if (applyDisabledByStock()) return;
					let v = parseInt(input.value, 10) || MIN;
					v = clamp(v - 1);
					input.value = v;
					recalcAndRender(v);
					minusBtn.disabled = (v <= MIN);
					plusBtn.disabled = (MAX > 0) ? (v >= MAX) : false;

					// MAXë©´ í‘œì‹œ, ì•„ë‹ˆë©´ ìˆ¨ê¹€
					if (MAX > 0 && v === MAX) showMaxHint(MAX);
					else hideMaxHint();
				});

				plusBtn.addEventListener('click', function () {
					if (applyDisabledByStock()) return;
					let v = parseInt(input.value, 10) || MIN;
					v = clamp(v + 1);
					input.value = v;
					recalcAndRender(v);
					minusBtn.disabled = (v <= MIN);
					plusBtn.disabled = (MAX > 0) ? (v >= MAX) : false;

					// MAXë©´ í‘œì‹œ, ì•„ë‹ˆë©´ ìˆ¨ê¹€
					if (MAX > 0 && v === MAX) showMaxHint(MAX);
					else hideMaxHint();
				});
			});
		</script>

		<script th:inline="javascript">
			(function () {
				const bmBtn = document.querySelector('.bm-btn');
				if (!bmBtn) return;

				const PRODUCT_ID = /*[[${product.id}]]*/ 0;

				const zzimLoginModal = document.getElementById('zzimLoginModal');
				const confirmModalEl = document.getElementById('zzimConfirmModal');
				const doneModalEl = document.getElementById('zzimDoneModal');

				const loginModal = zzimLoginModal ? new bootstrap.Modal(zzimLoginModal) : null;
				const confirmModal = confirmModalEl ? new bootstrap.Modal(confirmModalEl) : null;
				const doneModal = doneModalEl ? new bootstrap.Modal(doneModalEl) : null;

				function withLock(btn, fn) {
					if (!btn || btn.disabled) return;
					btn.disabled = true;
					return Promise.resolve(fn()).finally(() => setTimeout(() => btn.disabled = false, 600));
				}

				// ê³µí†µ fetch(JSON) + CSRF
				async function fetchJSON(url, opt = {}) {
					const { header, token } = getCsrfPair();
					const base = {
						credentials: 'same-origin',
						headers: { 'Accept': 'application/json', ...(opt.body ? { 'Content-Type': 'application/json' } : {}), ...(token ? { [header]: token } : {}) }
					};
					const res = await fetch(url, { ...base, ...opt });
					if (res.status === 401 || res.status === 403) { throw { auth: true }; }
					const ct = res.headers.get('content-type') || '';
					const data = ct.includes('application/json') ? await res.json() : {};
					if (!res.ok) throw { status: res.status, data };
					return data;
				}

				// ì„œë²„ì—ì„œ ì‹¤ì‹œê°„ ìƒíƒœ í™•ì¸(= product_zzimers í…Œì´ë¸” ì¡°íšŒ ë°˜ì˜)
				const checkState = () => fetchJSON(`/zzim/state?productId=${PRODUCT_ID}`, { method: 'GET' })
					.then(d => !!d.zzimed);

				const addZzim = () => fetchJSON(`/zzim/add`, { method: 'POST', body: JSON.stringify({ productId: PRODUCT_ID }) });
				const removeZzim = () => fetchJSON(`/zzim/remove?productId=${PRODUCT_ID}`, { method: 'POST' });

				bmBtn.addEventListener('click', () => withLock(bmBtn, async () => {
					try {
						// ì„œë²„ì— ì‹¤ì œ ìƒíƒœ ì§ˆì˜ (ë¹„ë¡œê·¸ì¸ ì‹œ 401 â†’ catchì—ì„œ ì²˜ë¦¬)
						const already = await checkState();

						if (already) {
							confirmModal?.show();
							const okBtn = confirmModalEl?.querySelector('.btn-confirm');
							const handler = async () => {
								await withLock(okBtn, async () => {
									await removeZzim();
									bmBtn.setAttribute('aria-pressed', 'false');
									bmBtn.title = 'ê´€ì‹¬ ë“±ë¡';
									confirmModal?.hide();
								});
							};
							okBtn?.addEventListener('click', handler, { once: true });
						} else {
							await addZzim();
							bmBtn.setAttribute('aria-pressed', 'true');
							bmBtn.title = 'ê´€ì‹¬ í•´ì œ';
							doneModal?.show();
						}
					} catch (e) {
						if (e && e.auth) { loginModal?.show(); return; }  // 401/403
						alert('ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
					}
				}));
			})();
		</script>

		<!-- Chart.js + êµ¬ë§¤ì í”¼ë¼ë¯¸ë“œ ë Œë” -->
		<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
		<script th:inline="javascript">
			(function () {
				const productId = /*[[${product.id}]]*/ 0;
				const api = `/main/api/product/${productId}/buyer-stats`;
				const $canvas = document.getElementById('buyerStatChart');
				const $empty = document.getElementById('buyerStatEmpty');
				if (!$canvas) return;

				// CSS ë³€ìˆ˜ ì½ê¸°(ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ì‚¬ìš©)
				const root = document.querySelector('#buyer-stats') || document.documentElement;
				const css = getComputedStyle(root);
				const C = (name, fallback) => (css.getPropertyValue(name).trim() || fallback);

				// ë§‰ëŒ€ ë‘ê»˜/ê°„ê²© & ì¤‘ì•™ ë¼ë²¨ í°íŠ¸ (ì›í•˜ë©´ CSS ë³€ìˆ˜ë¡œ ì¡°ì ˆ)
				const BAR_THICKNESS = parseFloat(C('--buyer-bar-thickness', '20')) || 12; // px
				const CAT_PCT = parseFloat(C('--buyer-category-pct', '0.55')) || 0.55; // ì¹´í…Œê³ ë¦¬ ë†’ì´ ì‚¬ìš© ë¹„ìœ¨
				const BAR_PCT = parseFloat(C('--buyer-bar-pct', '0.9')) || 0.9;       // ë™ì¼ ê·¸ë£¹ ë‚´ ì‚¬ìš© ë¹„ìœ¨
				const CENTER_FS = C('--buyer-center-font-size', '14px');                // ì¤‘ì•™ ë¼ë²¨ ê¸€ì í¬ê¸°
				const CENTER_FW = C('--buyer-center-font-weight', '500');               // ì¤‘ì•™ ë¼ë²¨ êµµê¸°

				// ì¤‘ì•™ ë¼ë²¨ + ì¤‘ì•™ ì—¬ë°±(ë§‰ëŒ€ ì˜ë¼ë‚´ê¸°)
				const centerPlugin = {
					id: 'pyramidCenter',
					beforeDatasetsDraw(chart) {
						const { ctx, chartArea } = chart;
						if (!chartArea) return;
						const gutter = 64;
						const midX = (chartArea.left + chartArea.right) / 2;
						const leftW = midX - gutter / 2 - chartArea.left;
						const rightW = chartArea.right - (midX + gutter / 2);

						ctx.save();
						ctx.beginPath();
						ctx.rect(chartArea.left, chartArea.top, Math.max(0, leftW), chartArea.bottom - chartArea.top);
						ctx.rect(midX + gutter / 2, chartArea.top, Math.max(0, rightW), chartArea.bottom - chartArea.top);
						ctx.clip();
					},
					afterDatasetsDraw(chart) {
						const { ctx, chartArea, scales } = chart;
						if (!chartArea || !scales?.y) return;
						const y = scales.y;
						const midX = (chartArea.left + chartArea.right) / 2;

						ctx.restore(); // í´ë¦¬í•‘ í•´ì œ

						// ê°€ìš´ë° ì¶• ë¼ë²¨(10ëŒ€/20ëŒ€â€¦)
						const labels = chart.data.labels || [];
						ctx.save();
						ctx.textAlign = 'center';
						ctx.textBaseline = 'middle';
						ctx.fillStyle = C('--buyer-label', '#2c2f34');
						ctx.font = `${CENTER_FW} ${CENTER_FS} system-ui`; // â† ë” ì‘ê³  ê°€ë²¼ìš´ í°íŠ¸
						labels.forEach((lab, i) => ctx.fillText(lab, midX, y.getPixelForTick(i)));
						ctx.restore();
					}
				};

				fetch(api, { credentials: 'same-origin' })
					.then(r => r.ok ? r.json() : Promise.reject())
					.then(data => {
						const labels = Array.isArray(data?.labels) ? data.labels : [];
						const ds = Array.isArray(data?.datasets) ? data.datasets : [];

						const male = (ds.find(v => v.label === 'ë‚¨ì„±')?.data || []).map(Number);
						const female = (ds.find(v => v.label === 'ì—¬ì„±')?.data || []).map(Number);

						const hasData = [...male, ...female].some(v => Number.isFinite(v) && v > 0);
						if (!hasData) { if ($empty) $empty.style.display = 'block'; return; }

						const femaleNeg = female.map(v => -Math.abs(v));
						const maxAbs = Math.max(1, ...male.map(Math.abs), ...female.map(Math.abs));

						new Chart($canvas.getContext('2d'), {
							type: 'bar',
							data: {
								labels,
								datasets: [
									{
										label: 'ì—¬ì„±',
										data: femaleNeg,
										stack: 'gender',
										backgroundColor: C('--buyer-female', '#e2e4e9') // ê¸°ë³¸: ë°ì€ ì¿¨ ê·¸ë ˆì´-ë¸”ë£¨
									},
									{
										label: 'ë‚¨ì„±',
										data: male,
										stack: 'gender',
										backgroundColor: C('--buyer-male', '#555')   // ê¸°ë³¸: ìŠ¬ë ˆì´íŠ¸ ê·¸ë ˆì´
									}
								]
							},
							options: {
								locale: 'ko-KR',
								indexAxis: 'y',
								responsive: true,
								maintainAspectRatio: false,
								animation: { duration: 600, easing: 'easeOutQuart' },
								elements: { bar: { borderRadius: 8, borderSkipped: false } },
								// â†“ ë§‰ëŒ€ ë‘ê»˜/ê°„ê²©ì„ ì—¬ê¸°ì„œ ì¼ê´„ ì œì–´
								datasets: {
									bar: {
										barThickness: BAR_THICKNESS,
										maxBarThickness: BAR_THICKNESS, // ê³¼ë‘êº¼ì›Œì§€ëŠ” ê²ƒ ë°©ì§€
										categoryPercentage: CAT_PCT,
										barPercentage: BAR_PCT
									}
								},
								plugins: {
									legend: {
										position: 'top',
										labels: {
											color: C('--buyer-muted', '#6b7280'),
											usePointStyle: true,
											pointStyle: 'rectRounded',
											padding: 12,
											boxWidth: 12
										}
									},
									tooltip: {
										backgroundColor: 'rgba(0,0,0,.75)',
										titleColor: '#fff',
										bodyColor: '#fff',
										padding: 10,
										callbacks: {
											label: (ctx) => {
												const v = Math.abs(ctx.raw ?? 0);
												return `${ctx.dataset.label}: ${v.toLocaleString('ko-KR')}ëª…`;
											}
										}
									}
								},
								scales: {
									y: {
										stacked: true,
										ticks: { display: false },
										grid: { display: false, drawBorder: false }
									},
									x: {
										stacked: true,
										min: -maxAbs,
										max: maxAbs,
										grid: {
											drawBorder: true,
											drawOnChartArea: false,
											color: C('--buyer-grid', '#E2E7EE')
										},
										border: { color: C('--buyer-grid', '#E2E7EE') },
										ticks: {
											color: C('--buyer-tick', '#7B8592'),
											padding: 6,
											callback: (v) => Math.abs(v).toLocaleString('ko-KR')
										}
									}
								}
							},
							plugins: [centerPlugin]
						});
					})
					.catch(() => { if ($empty) $empty.style.display = 'block'; });
			})();
		</script>

		<script th:inline="javascript">
			(function () {
				const PRODUCT_ID = /*[[${product.id}]]*/ 0;

				// ì´ë¯¸ ìˆëŠ” ìœ í‹¸: getCsrfPair(), showLoginModal(), fetchJSON() ì¬ì‚¬ìš©
				async function fetchJSON(url, opt = {}) {
					const { header, token } = getCsrfPair();
					const base = {
						credentials: 'same-origin',
						headers: {
							'Accept': 'application/json',
							...(opt.body ? { 'Content-Type': 'application/json' } : {}),
							...(token ? { [header]: token } : {})
						}
					};
					const res = await fetch(url, { ...base, ...opt });
					const ct = res.headers.get('content-type') || '';
					const data = ct.includes('application/json') ? await res.json() : {};
					if (!res.ok) throw { status: res.status, data };
					return data;
				}

				// ìƒíƒœ ì¡°íšŒ: ì´ë¯¸ ì‹ ì²­í–ˆëŠ”ì§€(true/false)
				async function isSubscribed() {
					const d = await fetchJSON(`/restockAlert/state?productId=${PRODUCT_ID}`);
					return !!d.subscribed;
				}

				// ì‹ ì²­
				async function subscribeRestock() {
					return fetchJSON('/restockAlert/subscribe', {
						method: 'POST',
						body: JSON.stringify({ productId: PRODUCT_ID })
					});
				}

				// ì·¨ì†Œ
				async function cancelRestock() {
					return fetchJSON('/restockAlert/cancel', {
						method: 'POST',
						body: JSON.stringify({ productId: PRODUCT_ID })
					});
				}

				// ìƒë‹¨ ë²„íŠ¼ í…ìŠ¤íŠ¸/ìŠ¤íƒ€ì¼ í† ê¸€
				function markSubscribed(btn, on) {
					if (!btn) return;
					if (on) {
						btn.textContent = 'ì•Œë¦¼ ì‹ ì²­ë¨';
						btn.classList.remove('btn-secondary');
						btn.classList.add('btn-outline-secondary');
					} else {
						btn.textContent = 'ì…ê³  ì•Œë¦¼ ì‹ ì²­';
						btn.classList.remove('btn-outline-secondary');
						btn.classList.add('btn-secondary');
					}
				}

				const topBtn = document.getElementById('btn-restock');
				const alreadyEl = document.getElementById('restockAlreadyModal');
				const alreadyModal = (alreadyEl && typeof bootstrap !== 'undefined') ? new bootstrap.Modal(alreadyEl) : null;

				// â‘  ìƒë‹¨ "ì…ê³  ì•Œë¦¼ ì‹ ì²­" ë²„íŠ¼ í´ë¦­
				topBtn?.addEventListener('click', async () => {
					if (!LOGGED_IN) {
						showLoginModal({ title: 'ì…ê³  ì•Œë¦¼', message: 'ì…ê³  ì•Œë¦¼ ì‹ ì²­ì€ ë¡œê·¸ì¸ í›„ ì´ìš©í•  ìˆ˜ ìˆì–´ìš”.' });
						return;
					}
					topBtn.disabled = true;
					try {
						if (await isSubscribed()) {
							// ì´ë¯¸ ì‹ ì²­ì â†’ ì·¨ì†Œ ëª¨ë‹¬
							alreadyModal?.show();
						} else {
							await subscribeRestock();
							markSubscribed(topBtn, true);
							const doneEl = document.getElementById('restockDoneModal');
							if (doneEl && typeof bootstrap !== 'undefined') new bootstrap.Modal(doneEl).show();
						}
					} catch (err) {
						if (err?.status === 401 || err?.status === 403) {
							showLoginModal({ title: 'ì…ê³  ì•Œë¦¼', message: 'ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆê±°ë‚˜ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.<br>ë‹¤ì‹œ ë¡œê·¸ì¸í•´ ì£¼ì„¸ìš”.' });
						} else {
							alert(err?.data?.message || 'ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
						}
					} finally {
						setTimeout(() => topBtn.disabled = false, 600);
					}
				});

				// â‘¡ OOS ìœ ë„ ëª¨ë‹¬ì—ì„œ "ì…ê³  ì•Œë¦¼ ì‹ ì²­" í´ë¦­ ì‹œì—ë„ ìƒíƒœ í™•ì¸ í›„ ë¶„ê¸°
				document.getElementById('btn-restock-confirm')?.addEventListener('click', async (e) => {
					const b = e.currentTarget;
					if (b.disabled) return;
					b.disabled = true;
					try {
						if (await isSubscribed()) {
							// ìœ ë„ ëª¨ë‹¬ ë‹«ê³  â†’ ì´ë¯¸ ì‹ ì²­ ëª¨ë‹¬ ì—´ê¸°
							const promptEl = document.getElementById('restockPromptModal');
							if (promptEl && typeof bootstrap !== 'undefined') new bootstrap.Modal(promptEl).hide?.();
							alreadyModal?.show();
							return;
						}
						await subscribeRestock();
						// ìœ ë„ ëª¨ë‹¬ ë‹«ê³  ì™„ë£Œ ëª¨ë‹¬
						const promptEl = document.getElementById('restockPromptModal');
						const doneEl = document.getElementById('restockDoneModal');
						if (promptEl && typeof bootstrap !== 'undefined') new bootstrap.Modal(promptEl).hide?.();
						if (doneEl && typeof bootstrap !== 'undefined') new bootstrap.Modal(doneEl).show();
						markSubscribed(topBtn, true);
					} catch (err) {
						if (err?.status === 401 || err?.status === 403) {
							const promptEl = document.getElementById('restockPromptModal');
							if (promptEl && typeof bootstrap !== 'undefined') new bootstrap.Modal(promptEl).hide?.();
							showLoginModal({ title: 'ì…ê³  ì•Œë¦¼', message: 'ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆê±°ë‚˜ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.<br>ë‹¤ì‹œ ë¡œê·¸ì¸í•´ ì£¼ì„¸ìš”.' });
						} else {
							alert(err?.data?.message || 'ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
						}
					} finally {
						setTimeout(() => b.disabled = false, 600);
					}
				});

				// â‘¢ "ì•Œë¦¼ ì·¨ì†Œ" ë²„íŠ¼ â†’ ì·¨ì†Œ í˜¸ì¶œ í›„ ìƒíƒœ/ë²„íŠ¼ ë°˜ì˜
				document.getElementById('btn-restock-cancel')?.addEventListener('click', async (e) => {
					const b = e.currentTarget;
					if (b.disabled) return;
					b.disabled = true;
					try {
						await cancelRestock();
						alreadyModal?.hide();
						markSubscribed(topBtn, false);
					} catch (err) {
						if (err?.status === 401 || err?.status === 403) {
							alreadyModal?.hide();
							showLoginModal({ title: 'ì…ê³  ì•Œë¦¼', message: 'ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆê±°ë‚˜ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.<br>ë‹¤ì‹œ ë¡œê·¸ì¸í•´ ì£¼ì„¸ìš”.' });
						} else {
							alert(err?.data?.message || 'ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
						}
					} finally {
						setTimeout(() => b.disabled = false, 600);
					}
				});
			})();
		</script>

		<script th:inline="javascript">
			(function () {
				const PRODUCT_ID = /*[[${product.id}]]*/ 0;

				// âœ… ì¢‹ì•„ìš” ë°”ì¸ë”© í•¨ìˆ˜ (disabled ì œì™¸)
				function bindReviewLikeHandlers(root = document) {
					// ë¹„ë¡œê·¸ì¸ â†’ ë¡œê·¸ì¸ ëª¨ë‹¬
					root.querySelectorAll('.like-wrap .need-login:not([disabled])')?.forEach(b => {
						b.addEventListener('click', () => {
							showLoginModal({ title: 'ë¦¬ë·° ê³µê°', message: 'ë¡œê·¸ì¸ í›„ ê³µê°í•  ìˆ˜ ìˆì–´ìš”.' });
						});
					});

					// ë¡œê·¸ì¸ â†’ Ajax í† ê¸€
					root.querySelectorAll('.like-wrap .btn-like:not(.need-login):not([disabled])')?.forEach(btn => {
						btn.addEventListener('click', async (e) => {
							const wrap = e.currentTarget.closest('.like-wrap');
							if (!wrap) return;
							const id = wrap.getAttribute('data-id');
							const { header, token } = getCsrfPair();

							// ë”ë¸”í´ë¦­ ì ê¸ˆ
							if (btn.dataset.lock === '1') return;
							btn.dataset.lock = '1';

							try {
								const res = await fetch(`/main/etc/review/${id}/like`, {
									method: 'POST',
									headers: { 'Content-Type': 'application/json', ...(token ? { [header]: token } : {}) },
									credentials: 'same-origin'
								});

								const ct = res.headers.get('content-type') || '';
								if (res.status === 401 || res.status === 403 || !ct.includes('application/json')) {
									showLoginModal({ title: 'ë¦¬ë·° ê³µê°', message: 'ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆê±°ë‚˜ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.<br>ë‹¤ì‹œ ë¡œê·¸ì¸í•´ ì£¼ì„¸ìš”.' });
									return;
								}

								const data = await res.json();
								wrap.classList.toggle('is-liked', !!data.liked);
								const cnt = wrap.querySelector('.like-count');
								if (cnt) cnt.textContent = String(data.count ?? 0);
							} catch {
								alert('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
							} finally {
								setTimeout(() => delete btn.dataset.lock, 300);
							}
						});
					});
				}

				// ìµœì´ˆ SSR DOMì—ë„ í•œ ë²ˆ ë°”ì¸ë”©
				bindReviewLikeHandlers(document);

				// âœ… ì •ë ¬ Ajax
				const form = document.querySelector('#review-section form');
				const select = form?.querySelector('[name="sort"]'); // selectë“  hiddenì´ë“  ì¡íˆê²Œ
				let listHost = document.getElementById('reviewList'); // replace í›„ ì¬í• ë‹¹ í•„ìš”í•˜ë¯€ë¡œ let

				async function loadReviews(sort) {
					if (select) select.disabled = true;
					try {
						const res = await fetch(`/main/content/${PRODUCT_ID}/reviews?sort=${encodeURIComponent(sort)}`, {
							credentials: 'same-origin',
							headers: { 'X-Requested-With': 'XMLHttpRequest' }
						});
						const html = await res.text();

						const temp = document.createElement('div');
						temp.innerHTML = html.trim();
						const newFrag = temp.querySelector('#reviewList');
						if (!newFrag) return;

						// â–¶ ë¦¬ìŠ¤íŠ¸ êµì²´
						listHost.replaceWith(newFrag);
						listHost = newFrag;

						// â–¶ ìƒˆ DOMì— ì¢‹ì•„ìš” ì¬ë°”ì¸ë”©
						bindReviewLikeHandlers(newFrag);

						// â–¶ URL/ì…€ë ‰íŠ¸ ë™ê¸°í™”
						const u = new URL(location.href);
						u.searchParams.set('sort', sort);
						history.replaceState(null, '', u.pathname + u.search);
						if (select) select.value = sort;
					} catch {
						alert('ë¦¬ë·°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
					} finally {
						if (select) select.disabled = false;
					}
				}

				// ì´ë¯¸ ì•„ë˜ìª½ì— ìˆëŠ” mountCS ì¬ì‚¬ìš© (ì„±ë³„/ë‚˜ì´ëŒ€ì™€ ë™ì¼)
				(function () {
					// ë§ˆìš´íŠ¸
					if (typeof mountSimpleCS === 'function') {
						mountSimpleCS('cs-reviewSort');
					}

					// ì„ íƒë˜ë©´ í¼ ìë™ ì œì¶œ (Ajax ë¡œë“œ ë¡œì§ì´ ì´ë¯¸ form.submit/RequestSubmitì— ì—°ê²°ë¼ ìˆìŒ)
					const host = document.getElementById('cs-reviewSort');
					const form = host?.closest('form');
					const hidden = host?.querySelector('input[name="sort"]');
					if (host && form && hidden) {
						hidden.addEventListener('change', () => form.requestSubmit());
					}
				})();

				// í¼ submit ê°€ë¡œì±„ê¸° + change ì—°ë™
				form?.addEventListener('submit', (e) => {
					e.preventDefault();
					loadReviews(select?.value || 'best');
				});
				select?.addEventListener('change', () => form.requestSubmit());
			})();

			document.addEventListener('DOMContentLoaded', function () {
				const form = document.getElementById('personaRecommendationForm');
				const submitBtn = document.getElementById('getRecommendationBtn');
				const btnText = submitBtn.querySelector('.btn-text');
				const spinner = submitBtn.querySelector('.spinner-border');

				const chipsRow = document.getElementById('aiSummaryRow');
				const resultDiv = document.getElementById('aiRecommendationResult');

				const productId = /*[[${product.id}]]*/ 0;

				function renderChips(g, a) {
					const gMap = { M: 'ë‚¨ì„±', F: 'ì—¬ì„±' };
					const aMap = { '10s': '10ëŒ€', '20s': '20ëŒ€', '30s': '30ëŒ€', '40s': '40ëŒ€', '50plus': '50ëŒ€ ì´ìƒ' };
					document.getElementById('aiChips').innerHTML = `
        <span class="ai-chip ai-chip--sel"><span class="k">ì„±ë³„</span><span class="v">${gMap[g] || ''}</span></span>
        <span class="ai-chip ai-chip--sel"><span class="k">ë‚˜ì´ëŒ€</span><span class="v">${aMap[a] || ''}</span></span>
    `;
					chipsRow.classList.remove('d-none');
				}

				function showSkeleton() {
					resultDiv.classList.remove('d-none');
					resultDiv.innerHTML = `
        <div class="ai-skel" style="width:82%"></div>
        <div class="ai-skel" style="width:96%"></div>
        <div class="ai-skel" style="width:88%"></div>
        <div class="ai-skel" style="width:72%"></div>
    `;
				}

				// âœ… ì—¬ê¸°ë¶€í„°: ê²€ì¦ ì‹¤íŒ¨ ì‹œ ëª¨ë‹¬ ì¶œë ¥
				form.addEventListener('submit', async function (e) {
					e.preventDefault();

					const gender = document.getElementById('gender').value;
					const ageGroup = document.getElementById('ageGroup').value;

					// ì–´ëŠ ìª½ì´ ë¹„ì—ˆëŠ”ì§€ì— ë”°ë¼ ë©”ì‹œì§€ êµ¬ë¶„
					let message = '';
					let focusTargetBtn = null;
					if (!gender && !ageGroup) {
						message = 'ì„±ë³„ê³¼ ë‚˜ì´ëŒ€ë¥¼ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.';
						focusTargetBtn = document.querySelector('#cs-gender .cs-btn') || document.querySelector('#cs-ageGroup .cs-btn');
					} else if (!gender) {
						message = 'ì„±ë³„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.';
						focusTargetBtn = document.querySelector('#cs-gender .cs-btn');
					} else if (!ageGroup) {
						message = 'ë‚˜ì´ëŒ€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.';
						focusTargetBtn = document.querySelector('#cs-ageGroup .cs-btn');
					}

					if (message) {
						const modal = showNoticeModal({ title: 'AI ê°€ì´ë“œ', message });
						// ëª¨ë‹¬ì´ ë‹«íŒ í›„ í¬ì»¤ìŠ¤ ë³µêµ¬
						const okBtn = document.getElementById('noticeModalOk');
						const handler = () => {
							if (focusTargetBtn) focusTargetBtn.focus();
							okBtn.removeEventListener('click', handler);
						};
						okBtn.addEventListener('click', handler, { once: true });
						return;
					}

					// ì´í•˜ ê¸°ì¡´ ì„±ê³µ íë¦„ ìœ ì§€
					submitBtn.disabled = true;
					btnText.textContent = 'ë¶„ì„ ì¤‘...';
					spinner.classList.remove('d-none');

					renderChips(gender, ageGroup);
					showSkeleton();

					try {
						const res = await fetch('/main/ai/persona-recommendation', {
							method: 'POST',
							headers: { 'Content-Type': 'application/json' },
							body: JSON.stringify({ productId, gender, ageGroup })
						});
						const data = await res.json();
						if (data.success) {
							resultDiv.textContent = data.recommendation || '';
						} else {
							showNoticeModal({ title: 'AI ê°€ì´ë“œ', message: 'ë¶„ì„ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.' });
							// í•„ìš”í•˜ë©´ ì—¬ê¸°ì„œ ì„ íƒ ì´ˆê¸°í™” ë¡œì§ í˜¸ì¶œ
						}
					} catch (err) {
						showNoticeModal({ title: 'AI ê°€ì´ë“œ', message: 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.' });
					} finally {
						submitBtn.disabled = false;
						btnText.textContent = 'ë§ì¶¤ ì¶”ì²œ ë³´ê¸°';
						spinner.classList.add('d-none');
					}
				});
			});

			/* ---- ì»¤ìŠ¤í…€ ì…€ë ‰íŠ¸: ë‹¨ì¼ ë²„ì „(ì§€ì—° ë¡œë“œ/ë™ì  ì‚½ì… ëŒ€ì‘ + ë°©ì–´/ì •ë¦¬ í¬í•¨) ---- */
			(function () {
				// ì „ì—­ ê°€ë“œ: íŒŒì¼ì´ ë‘ ë²ˆ í¬í•¨ë¼ë„ í•œ ë²ˆë§Œ ë¶€íŒ…
				if (window.__CS_BOOTED__) return;
				window.__CS_BOOTED__ = true;

				function unwrapIfWrapped(sel) {
					const p = sel.parentElement;
					if (p && p.classList.contains('cs')) {
						p.before(sel);
						p.remove();
					}
					sel.classList.remove('cs-hidden');
					delete sel.dataset.csInit;
				}

				function enhanceSelect(sel) {
					if (!sel || sel.dataset.csInit === '1') return;
					sel.dataset.csInit = '1';

					const wrap = document.createElement('div'); wrap.className = 'cs';
					const btn = document.createElement('button'); btn.type = 'button'; btn.className = 'cs-btn';
					const menu = document.createElement('ul'); menu.className = 'cs-menu'; menu.setAttribute('role', 'listbox');

					const textOf = o => (o && (o.textContent || o.label)) || '';
					btn.textContent = textOf(sel.selectedOptions?.[0] || sel.options?.[0]);

					[...sel.options].forEach(opt => {
						const li = document.createElement('li');
						const disabled = opt.disabled || opt.value === "";
						li.className = 'cs-item' + (opt.selected ? ' is-selected' : '') + (disabled ? ' is-disabled' : '');
						if (disabled) li.setAttribute('aria-disabled', 'true');
						li.dataset.value = opt.value;
						li.textContent = opt.textContent || opt.label || '';
						menu.appendChild(li);
					});

					sel.after(wrap); wrap.appendChild(sel); wrap.appendChild(btn); wrap.appendChild(menu);
					sel.classList.add('cs-hidden');

					function open() { wrap.classList.add('is-open'); }
					function close() { wrap.classList.remove('is-open'); }
					btn.addEventListener('click', () => wrap.classList.toggle('is-open'));
					document.addEventListener('click', e => { if (!wrap.contains(e.target)) close(); });

					menu.addEventListener('click', e => {
						const li = e.target.closest('.cs-item');
						if (!li || li.classList.contains('is-disabled')) return;
						menu.querySelectorAll('.cs-item').forEach(n => n.classList.remove('is-selected'));
						li.classList.add('is-selected');
						btn.textContent = li.textContent;
						sel.value = li.dataset.value;
						sel.dispatchEvent(new Event('change', { bubbles: true }));
						close();
					});

					btn.addEventListener('keydown', e => {
						if (e.key === 'ArrowDown' || e.key === 'Enter' || e.key === ' ') { e.preventDefault(); open(); }
						if (e.key === 'Escape') close();
					});
				}

				function scan(root) {
					if (!root || typeof root.querySelectorAll !== 'function') root = document;
					root.querySelectorAll('select[data-cs].cs-hidden').forEach(unwrapIfWrapped);
					const targets = root.querySelectorAll('select[data-cs]:not(.cs-hidden):not([data-cs-init="1"])');
					targets.forEach(enhanceSelect);
					if (targets.length) console.log('[CS] mounted:', targets.length); // â† í•œ ë²ˆë§Œ ë¡œê·¸
				}

				// ìµœì´ˆ 1íšŒë§Œ ì •í™•íˆ ì‹¤í–‰
				if (document.readyState === 'loading') {
					document.addEventListener('DOMContentLoaded', () => requestAnimationFrame(() => scan()), { once: true });
				} else {
					requestAnimationFrame(() => scan());
				}

				// ë™ì  ì‚½ì… ëŒ€ì‘
				const mo = new MutationObserver(muts => {
					for (const m of muts) for (const n of m.addedNodes) {
						if (!(n instanceof Element)) continue;
						if (n.matches?.('select[data-cs]')) { unwrapIfWrapped(n); scan(n); }
						n.querySelectorAll?.('select[data-cs]')?.forEach(el => { unwrapIfWrapped(el); enhanceSelect(el); });
					}
				});
				mo.observe(document.body, { childList: true, subtree: true });

				// ìˆ˜ë™ ì¬ìŠ¤ìº” ë””ë²„ê·¸
				window.csScan = scan;
			})();
		</script>

		<!-- ìƒì„¸ í˜ì´ì§€ ì¤‘ê°„ì— ìˆëŠ” ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
		<script>
			// ê³ ì •ëœ í—¤ë”/íƒ­ì˜ ì‹¤ì œ ë†’ì´ í•©ê³„ë¥¼ ê³„ì‚°
			function getStickyOffset() {
				const header = document.querySelector('header');           // ì‚¬ì´íŠ¸ ê³µí†µ í—¤ë”
				const tab = document.querySelector('.productTabWrap');  // sticky íƒ­
				return (header?.offsetHeight || 0) + (tab?.offsetHeight || 0);
			}

			// CSS ë³€ìˆ˜ë¡œë„ ë‚´ë ¤ì„œ CSS scroll-padding/scroll-marginì— ì¬ì‚¬ìš©
			function setStickyCSSVar() {
				const v = getStickyOffset();
				document.documentElement.style.setProperty('--sticky-offset', `${v}px`);
			}
			setStickyCSSVar();
			window.addEventListener('resize', setStickyCSSVar);

			// íƒ­ í´ë¦­ â†’ í•´ë‹¹ ì„¹ì…˜ìœ¼ë¡œ ë¶€ë“œëŸ½ê²Œ ìŠ¤í¬ë¡¤(ì •í™•í•œ ë³´ì •)
			document.querySelectorAll('.productTab button').forEach(btn => {
				btn.addEventListener('click', () => {
					const target = document.querySelector(btn.dataset.target);
					if (!target) return;
					const y = target.getBoundingClientRect().top + window.pageYOffset - getStickyOffset() - 8; // ì‚´ì§ ì—¬ìœ 
					window.scrollTo({ top: y, behavior: 'smooth' });
				});
			});

			// ğŸ”§ ë²„ê·¸ í”½ìŠ¤: ì‹¤ì œ DOMì€ sectionì´ë¯€ë¡œ ì„ íƒìë¥¼ ë°”ê¿”ì•¼ active ê°±ì‹ ì´ ë¨
			const sections = document.querySelectorAll('section[id]');
			const navBtns = document.querySelectorAll('.productTab button');

			// ìŠ¤í¬ë¡¤ ìœ„ì¹˜ì— ë”°ë¼ active íƒ­ í† ê¸€
			window.addEventListener('scroll', () => {
				const offset = getStickyOffset() + 20;
				let current = '';
				sections.forEach(sec => {
					const rect = sec.getBoundingClientRect();
					if (rect.top <= offset && rect.bottom > offset) current = `#${sec.id}`;
				});
				navBtns.forEach(btn => btn.classList.toggle('active', btn.dataset.target === current));
			});
		</script>

		<script>
			(function () {
				const list = document.getElementById('ratingDist');
				if (!list) return;
				let max = 0;
				list.querySelectorAll('li').forEach(li => {
					const n = Number(li.style.getPropertyValue('--cnt') || 0);
					if (n > max) max = n;
				});
				list.style.setProperty('--max', Math.max(max, 1));
			})();
		</script>

		<script>
			(function () {
				function mountSimpleCS(rootId) {
					const root = document.getElementById(rootId);
					if (!root) return;

					const btn = root.querySelector('.cs-btn');
					const menu = root.querySelector('.cs-menu');
					const input = root.querySelector('input[type="hidden"]');

					const open = () => { root.classList.add('is-open'); btn.setAttribute('aria-expanded', 'true'); };
					const close = () => { root.classList.remove('is-open'); btn.setAttribute('aria-expanded', 'false'); };

					btn.addEventListener('click', (e) => {
						e.preventDefault();
						e.stopPropagation(); // ì „ì—­ í´ë¦­ í•¸ë“¤ëŸ¬ì™€ ì¶©ëŒ ë°©ì§€
						root.classList.toggle('is-open');
						btn.setAttribute('aria-expanded', root.classList.contains('is-open') ? 'true' : 'false');
					});

					document.addEventListener('click', (e) => {
						if (!root.contains(e.target)) close();
					});

					menu.addEventListener('click', (e) => {
						const li = e.target.closest('.cs-item');
						if (!li || li.classList.contains('is-disabled')) return;

						menu.querySelectorAll('.cs-item').forEach(n => n.classList.remove('is-selected'));
						li.classList.add('is-selected');

						input.value = li.dataset.value || '';
						btn.textContent = li.textContent || 'ì„ íƒ';

						input.dispatchEvent(new Event('change', { bubbles: true }));
						close();
					});
				}

				// í˜ì´ì§€ ì¤€ë¹„ í›„ ë§ˆìš´íŠ¸
				document.addEventListener('DOMContentLoaded', function () {
					mountSimpleCS('cs-gender');
					mountSimpleCS('cs-ageGroup');
					mountSimpleCS('cs-reviewSort'); // â† ë¦¬ë·° ì •ë ¬ ë“œë¡­ë‹¤ìš´ë„ ê°™ì´ ì´ˆê¸°í™”
				});
			})();
		</script>
	</th:block>
</body>

</html>