<!-- src/main/resources/mappers/PaymentMapper.xml -->
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ex.final22c.repository.payment.PaymentMapper">

  <resultMap id="PaymentMap" type="com.ex.final22c.data.payment.Payment">
    <id     property="paymentId"  column="paymentId"/>
    <result property="orderId"    column="orderId"/>
    <result property="amount"     column="amount"/>
    <result property="status"     column="status"/>
    <result property="tid"        column="tid"/>
    <result property="aid"        column="aid"/>
    <result property="approvedAt" column="approvedAt"/>
    <result property="reg"        column="reg"/>
  </resultMap>

  <!-- READY 저장 -->
  <insert id="insertReady">
    INSERT INTO payment
      (paymentId, orderId, amount, status, tid, reg)
    VALUES
      (payment_seq.NEXTVAL, #{orderId}, #{amount}, #{status}, #{tid}, SYSDATE)
  </insert>

  <!-- 승인 성공 업데이트 -->
  <update id="updateSuccess">
    UPDATE payment
       SET aid = #{aid},
           status = #{status},
           approvedAt = #{approvedAt}
     WHERE tid = #{tid}
  </update>

  <select id="findByTid" resultMap="PaymentMap">
    SELECT paymentId, orderId, amount, status, tid, aid, approvedAt, reg
      FROM payment
     WHERE tid = #{tid}
  </select>

</mapper>
