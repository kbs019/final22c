<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ex.final22c.repository.productMapper.ProductMapper">

  <select id="search" resultType="com.ex.final22c.data.product.Product">
    SELECT
        p.id,
        b.brandName,
        p.name,
        g.gradeName,
        m.mainNoteName,
        v.volumeName,
        p.price,
        p.imgPath,
        p.imgName
    FROM product p
      LEFT JOIN brand    b ON p.brand_brandNo    = b.brandNo
      LEFT JOIN grade    g ON p.grade_gradeNo    = g.gradeNo
      LEFT JOIN mainNote m ON p.mainnote_mainNoteNo = m.mainNoteNo
      LEFT JOIN volume   v ON p.volume_volumeNo   = v.volumeNo
    WHERE 1=1

    <!-- 검색어 -->
    <if test="q != null and q != ''">
      AND (
           p.name      LIKE '%' || #{q} || '%'
        OR b.brandName LIKE '%' || #{q} || '%'
      )
    </if>

    <!-- 그레이드 -->
    <if test="grades != null and grades.size() > 0">
      AND g.gradeName IN
      <foreach collection="grades" item="g" open="(" separator="," close=")">
        #{g}
      </foreach>
    </if>

    <!-- 메인 어코드 -->
    <if test="accords != null and accords.size() > 0">
      AND m.mainNoteName IN
      <foreach collection="accords" item="a" open="(" separator="," close=")">
        #{a}
      </foreach>
    </if>

    <!-- 브랜드 -->
    <if test="brands != null and brands.size() > 0">
      AND b.brandName IN
      <foreach collection="brands" item="bname" open="(" separator="," close=")">
        #{bname}
      </foreach>
    </if>

    <!-- 용량 -->
    <if test="volumes != null and volumes.size() > 0">
      AND v.volumeName IN
      <foreach collection="volumes" item="vname" open="(" separator="," close=")">
        #{vname}
      </foreach>
    </if>

    ORDER BY p.id DESC
  </select>

</mapper>
